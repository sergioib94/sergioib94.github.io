<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="es"><generator uri="https://jekyllrb.com/" version="3.10.0">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="es" /><updated>2025-10-23T17:04:26+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Blog de Sergio Ibáñez</title><subtitle>Blog técnico sobre sistemas, DevOps y automatización</subtitle><author><name>Sergio Ibáñez Núñez</name></author><entry><title type="html">Instalación, configuración y monitorización usando Zabbix</title><link href="http://localhost:4000/sistemas/monitorizaci%C3%B3n/2025/05/01/Instalacion-configuracion-y-monitoreo-zabbix.html" rel="alternate" type="text/html" title="Instalación, configuración y monitorización usando Zabbix" /><published>2025-05-01T13:19:00+02:00</published><updated>2025-05-01T13:19:00+02:00</updated><id>http://localhost:4000/sistemas/monitorizaci%C3%B3n/2025/05/01/Instalacion-configuracion-y-monitoreo-zabbix</id><content type="html" xml:base="http://localhost:4000/sistemas/monitorizaci%C3%B3n/2025/05/01/Instalacion-configuracion-y-monitoreo-zabbix.html"><![CDATA[<h2 id="que-es-zabbix"><strong>¿Que es Zabbix?</strong></h2>

<p>Zabbix es una plataforma de monitorización de infraestructura de TI de código abierto que permite supervisar el estado y rendimiento de servidores, redes, aplicaciones, servicios y otros recursos tecnológicos en tiempo real.</p>

<h2 id="requisitos-previos"><strong>Requisitos previos</strong></h2>

<p>Para este post se han usado los siguientes elementos para realizar instalación, configuración y monitorización haciendo uso de Zabbix:</p>

<ul>
  <li>Maquina virtual con sistema operativo Debían 12 (Zabbix server)</li>
  <li>Al menos 1 GB de RAM, 2 CPU y 10 GB de disco duro</li>
  <li>Acceso a red y tener privilegios de superusuario (root)</li>
</ul>

<p>Lo primero que haremos al arrancar nuestro servidor Debian sera actualizar el sistema en el caso de que no lo este.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt update &amp;&amp; sudo apt upgrade -y
</code></pre></div></div>

<p>Una vez se tenga actualizado el sistema lo primero que haremos sera instalar LAMP en nuestra maquina (Apache, Mariadb y Php), inicialmente lo que necesitaremos sera solo mariadb, pero como mas adelante necesitaremos también Apache y php evitaremos problemas a la hora de usar Zabbix.</p>

<p><strong>Instalación de Apache</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install apache2 -y
</code></pre></div></div>

<p>Apache lo usara Zabbix para incluir una interfaz web que necesita un servidor web.</p>

<p><strong>Instalación de Mariadb</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install mariadb-server mariadb-client -y
</code></pre></div></div>

<p>Zabbix almacena todos sus datos (eventos, hosts, métricas, configuración, etc.) en una base de datos.</p>

<p><strong>Aseguramos Mariadb</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mysql_secure_installation
</code></pre></div></div>

<p>A la hora de asegurar mariadb tendremos que indicar las siguientes opciones:</p>

<ul>
  <li>Set root password: si</li>
  <li>Remove anonymous users: si</li>
  <li>Disallow root login remotely: sí</li>
  <li>Remove test database: sí</li>
  <li>Reload privilege tables: sí</li>
</ul>

<p><strong>Instalación de PHP y extensiones necesarias</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install php php-mysql php-bcmath php-mbstring php-gd php-xml php-ldap php-json php-zip php-snmp php-curl libapache2-mod-php -y
</code></pre></div></div>

<p>La interfaz web de Zabbix está hecha en PHP, por lo que se necesita tenerlo instalado con ciertas extensiones.</p>

<h2 id="instalación-de-zabbix"><strong>Instalación de Zabbix</strong></h2>

<p>A la hora de instalar Zabbix en nuestro sistema lo primero sera añadir el repositorio oficial de Zabbix.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://repo.zabbix.com/zabbix/6.0/debian/pool/main/z/zabbix-release/zabbix-release_6.0-5+debian12_all.deb
sudo dpkg -i zabbix-release_6.0-5+debian12_all.deb
sudo apt update
</code></pre></div></div>

<p><em>Nota: Es posible que dependiendo de la distribución del sistema operativo que se este usando o de la version escogida de Zabbix de error al instalar el paquete con dpkg, en caso de error ejecutar el comando “sudo apt –fix-broken install -y” para reparar las dependencias que falten</em></p>

<p>Una vez hayamos añadido el repositorio y hayamos descargado e instalado el paquete Zabbix, pasamos a instalar servidor, frontend, agente y base de datos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install zabbix-server-mysql zabbix-frontend-php zabbix-apache-conf zabbix-sql-scripts zabbix-agent -y
</code></pre></div></div>

<p>Después crearemos la base de datos de zabbix en mariadb previamente instalada:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo mysql -u root -p
</code></pre></div></div>

<p>Dentro del prompt de mariadb, añadiremos los siguientes códigos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>CREATE DATABASE zabbix CHARACTER SET utf8mb4 COLLATE utf8mb4_bin;
CREATE USER sergioib@localhost IDENTIFIED BY 'contraseña';
GRANT ALL PRIVILEGES ON zabbix.* TO sergioib@localhost;
FLUSH PRIVILEGES;
EXIT;
</code></pre></div></div>

<ul>
  <li>
    <p>Con la primera linea lo que haremos sera crear una base de datos llamada zabbix, a parte de eso con “CHARACTER SET utf8mb4”: Especificamos que se usará el conjunto de caracteres UTF-8 de 4 bytes, compatible con emojis y otros símbolos especiales. Es el más recomendado hoy en día y con “COLLATE utf8mb4_bin” Define la forma en que se comparan y ordenan los datos. utf8mb4_bin hace que las comparaciones sean sensibles a mayúsculas/minúsculas y a acentos (comparación binaria).</p>
  </li>
  <li>
    <p>Con la segunda linea creamos un usuario de base de datos con el nombre que especifiquemos (en mi caso sergioib) que solo puede conectarse desde el servidor local (localhost), con una contraseña personalizada (indicándola donde pone ‘contraseña’).</p>
  </li>
  <li>
    <p>Con la tercera linea concedemos todos los permisos (lectura, escritura, modificación, etc.) al usuario creado anteriormente sobre todas las tablas (*) dentro de la base de datos zabbix.</p>
  </li>
  <li>
    <p>Por ultimo con la cuarta linea recargamos las tablas de privilegios de MariaDB para asegurarse de que los cambios (como la creación de usuarios o la asignación de permisos) se apliquen de inmediato.</p>
  </li>
</ul>

<p>Cuando ya tengamos la base de datos creada, ya podremos importar el esquema de la base de datos</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>zcat /usr/share/zabbix-sql-scripts/mysql/server.sql.gz | mysql -u sergioib -p zabbix
</code></pre></div></div>

<p>Introducimos la contraseña especificada anteriormente para completar la importación y en cuanto a la instalación de zabbix ya estaría todo listo.</p>

<h2 id="configuración-de-zabbix"><strong>Configuración de Zabbix</strong></h2>

<p>Para la configuración empezamos abriendo el fichero zabbix-server.conf para editarlo</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nano /etc/zabbix/zabbix_server.conf
</code></pre></div></div>

<p>En este fichero tendremos que buscar la linea en la que se indique el parámetro DBpassword y primero descomentar la linea y después sustituir la password por defecto por la que hayamos puesto en pasos anteriores para la base de datos mariadb</p>

<p>Después de eso reiniciamos y habilitamos el servicio</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl restart zabbix-server zabbix-agent apache2
sudo systemctl enable zabbix-server zabbix-agent apache2
</code></pre></div></div>
<p>Ya con todo configurado y habilitado podemos acceder al frontend web y empezar a usar zabbix.</p>

<h2 id="frontend-web"><strong>Frontend web</strong></h2>

<p>Para acceder al frontend de zabbix abrimos un navegador y realizamos una búsqueda indicando la ip de la maquina en la que se haya instalado zabbix, en mi caso seria “https://192.168.149.129/zabbix/”.</p>

<p>La primera vez que accedamos a zabbix tendremos que indicar una serie de configuraciones previas, por ejemplo el tema del idioma, por defecto zabbix solo trae instalados los paquetes de español e ingles (al menos en mi caso) por lo que para otros idiomas se tendrá que descargar el paquete de idiomas a parte.</p>

<p><img src="/images/Zabbix/zabbix1.PNG" alt="inicio en zabbix" /></p>

<p>En la siguiente pantalla se realizara una comprobación de los requisitos previos para el uso de zabbix, en este caso como al inicio del post se instalaron tanto apache como php no debería haber ningún problema, en caso de que falte algún paquete en concreto seria solo cuestión de instalarlo, el caso es que todo tiene que estar “OK”.</p>

<p><img src="/images/Zabbix/zbbix_requisitos.PNG" alt="requisitos previos" /></p>

<p>Después introducimos la información de la base de datos que hemos configurado en mariadb</p>

<p><img src="/images/Zabbix/zabbix_bbdd.PNG" alt="BBDD" /></p>

<p>Por ultimo le pondremos nombre a nuestro servidor zabbix y con esto completaremos la instalación para poder acceder. El acceso lo realizaremos con el usuario por defecto “Admin” y la contraseña “zabbix”.</p>

<p><img src="/images/Zabbix/zabbix_server.PNG" alt="zabbix server" /></p>

<p>Una vez que tienes tu entorno Zabbix completamente funcional, puedes comenzar a realizar prácticas para familiarizarte con sus principales funcionalidades. Aquí tienes una serie de ejercicios recomendados:</p>

<h2 id="ejemplos-de-practicas-de-monitorización-en-zabbix"><strong>Ejemplos de practicas de monitorización en zabbix</strong></h2>

<p>Previamente para poder practicar la monitorización con zabbix en el frontend debemos configurar primero el equipo ya que cada métrica, trigger o gráfico debe estar vinculado a un host específico (físico, virtual o lógico). La creación del equipo es bastante simple, en el menu de opciones de la izquierda buscaremos la opción configuración → equipos.</p>

<ol>
  <li>Crear un trigger de alerta simple</li>
</ol>

<p>En este caso podemos crear un trigger que nos alerte cuando un parámetro (%CPU, uso de RAM, espacio en disco, etc…) de nuestro servidor sobrepase cierto valor. En este caso se creara un trigger que nos alerte cuando nuestro servidor supere el 80% de uso de CPU para ello en el frontend de zabbix buscaremos la opción configuración -&gt; Equipos -&gt; (host creado) -&gt; crear iniciador.</p>

<p>En la pantalla que tendremos para rellenar los datos de configuración del iniciándolos campos mas importantes a rellenar serian: Nombre (dado que es obligatorio), la gravedad ya sera util para clasificar como de grave sera el problema de nuestra maquina y la expresión (evalúa el valor de un ítem (métrica) y si se cumple una condición, dispara una alerta). Para este caso en concreto en el que la alerta aparecerá cuando la CPU supere el 80%, la configuración quedaría de la siguiente forma:</p>

<p><img src="/images/Zabbix/trigger_CPU.PNG" alt="Trigger CPU" /></p>

<p>Para poner a prueba el trigger instalaremos el comando “stress” en nuestra maquina servidor. El comando stress lo que hará sera lanzar procesos que consumirán los recursos que se le vayan indicando como parámetro, en este caso la CPU.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install stress
stress --cpu 2 --timeout 60
</code></pre></div></div>

<ul>
  <li>–cpu 2: lanza procesos que hacen cálculos intensivos (usa 2 núcleos).</li>
  <li>–timeout 60: ejecuta la carga durante el tiempo establecido (en segundos) y después se detiene.</li>
</ul>

<p>Una vez ejecutado el comando stress, volveremos al frontend de Zabbix y para comprobar si realmente funciona el trigger abrimos la opción Monitorización → Problemas. Si el trigger esta funcionando correctamente nos debería aparecer algo como esto:</p>

<p><img src="/images/Zabbix/prueba_trigguer_CPU.PNG" alt="Prueba CPU" /></p>

<p><em>Nota: los datos que llegan del servidor tardar unos segundos en actualizarse en el frontend por lo que es posible que aunque el comando funcione, no aparezca el trigger inmediatamente</em></p>

<ol>
  <li>Configuración de notificaciones por email</li>
</ol>

<p>Este tipo de notificaciones pueden ser útiles si se combinan con triggers como el creado anteriormente, por ejemplo en el caso anterior, una vez que el uso de CPU sobrepasara o llegara al 80% mandaría una notificación al correo especificado para la alerta. Para configurar este tipo de alertas haremos lo siguiente:</p>

<p>Ir a Administración → Medios → Tipos de medios donde añadir o editar Email.</p>

<p>Ponemos los datos SMTP (puedes usar Gmail, Outlook, o un servidor propio)</p>

<p>Luego ir a Administración → Usuarios y añadir el medio de contacto al usuario (correo, horario, severidad)</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Sistemas" /><category term="Monitorización" /><summary type="html"><![CDATA[Este post describe paso a paso cómo instalar y configurar Zabbix 6.0 LTS en una máquina virtual con Debian 12. Está pensado para crear un entorno de prácticas de monitorización que incluya carga simulada, agentes remotos, monitorización de logs, SNMP y dashboards personalizados.]]></summary></entry><entry><title type="html">Monitorización de servidores con Grafana</title><link href="http://localhost:4000/sistemas/monitorizaci%C3%B3n/2024/04/11/Monitorizaci%C3%B3n-de-servidores-con-grafana.html" rel="alternate" type="text/html" title="Monitorización de servidores con Grafana" /><published>2024-04-11T13:14:06+02:00</published><updated>2024-04-11T13:14:06+02:00</updated><id>http://localhost:4000/sistemas/monitorizaci%C3%B3n/2024/04/11/Monitorizaci%C3%B3n-de-servidores-con-grafana</id><content type="html" xml:base="http://localhost:4000/sistemas/monitorizaci%C3%B3n/2024/04/11/Monitorizaci%C3%B3n-de-servidores-con-grafana.html"><![CDATA[<h3 id="requisitos-previos"><strong>Requisitos previos</strong></h3>

<ul>
  <li>Tener acceso a una máquina debian (máquina virtual o física) con permisos de root</li>
  <li>Conocimientos básicos de administración de sistemas Linux</li>
  <li>Conexión a internet para descargar paquetes</li>
  <li>Herramientas necesarias instaladas: wget, curl, net-tools (si no están, instálalas con sudo apt install -y wget curl net-tools).</li>
</ul>

<h3 id="que-es-grafana"><strong>¿Que es grafana?</strong></h3>

<p>Grafana open source es un software de análisis y visualización de código abierto. Le permite consultar, visualizar, alertar y explorar sus métricas, registros y seguimientos sin importar dónde estén almacenados. Le proporciona herramientas para convertir los datos de su base de datos de series temporales (TSDB) en gráficos y visualizaciones interesantes.</p>

<h3 id="instalación-de-grafana-en-debian"><strong>Instalación de Grafana en debian</strong></h3>

<p>Empezaremos instalando Grafana en nuestro sistema debian haciendo uso del repositorio oficial de grafana, pero antes necesitaremos instalar el software necesario que necesita grafana para poder funcionar ejecutando los siguientes comandos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install -y apt-transport-https
sudo apt install -y software-properties-common wget
</code></pre></div></div>

<p>El siguiente paso es descargar la llave GPG, para poder firmar los paquetes instalado</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo wget -q -O /usr/share/keyrings/grafana.key https://apt.grafana.com/gpg.key
</code></pre></div></div>

<p>Ahora es necesario crear el fichero /etc/apt/sources.list.d/grafana.list para añadir los repositorios de Grafana.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo "deb [signed-by=/usr/share/keyrings/grafana.key] https://apt.grafana.com stable main" | sudo tee -a /etc/apt/sources.list.d/grafana.list
</code></pre></div></div>

<p>Actualizamos la lista de paquetes de nuestro sistema</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt update
</code></pre></div></div>

<p>Una vez actualizado los paquetes del sistema ya podemos empezar a instalar grafana</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install grafana
</code></pre></div></div>

<p>Cuando ya tengamos grafana instalado, podremos iniciarlo y añadirlo al arranque de nuestra maquina</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl start grafana-server
</code></pre></div></div>

<p>Para poder asegurarnos de que el servidor se inicia correctamente (debe aparecer con estado active (running)) podemos ejecutar el comando usado anteriormente haciendo uso de la opción “status”.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl status grafana-server
</code></pre></div></div>

<p>Finalmente habilitamos grafana en el inicio de servidor para que inicie en el arranque</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo systemctl enable grafana-server.service
</code></pre></div></div>

<p>Con esto ya estaría completa la instalación de grafana y ya podríamos acceder a la web de grafana para poder logearnos, para ello hay que indicar en la barra de búsqueda de cualquier navegador la ip de nuestra maquina (o su dominio), indicando el puerto 3000 que es el usado por grafana por defecto. en mi caso se accede con la dirección 192.168.110.129:3000</p>

<p><img src="/images/Grafana/grafana_login.png" alt="Grafana login" /></p>

<p>NOTA: por defecto la primera vez que se accede a grafana las credenciales siempre van a ser admin/admin, una vez se acceda por primera vez pedirá un cambio de contraseña y podremos empezar a trabajar con grafana.</p>

<p>Al acceder a grafana, en el menú de la izquierda encontraremos varias opciones interesantes para trabajar como pueden ser los dashboards que podremos configurar para revisar las métricas y monitorizar las maquinas de nuestro sistema, explorar Si su fuente de datos admite datos de gráficos y tablas, Explore muestra los resultados tanto en forma de gráfico como de tabla, alertas que nos permitirá conocer los problemas en sus sistemas momentos después de que ocurren o data sources que proporciona instrucciones paso a paso sobre cómo agregar una fuente de datos de Prometheus, InfluxDB o MS SQL Server.</p>

<h3 id="instalación-de-prometheus"><strong>Instalación de Prometheus</strong></h3>

<p>Grafana necesitas añadir un nuevo data source, que es la base de datos que guarda las métricas que muestra Grafana, en este caso se hará uso de prometheus por lo que empezaremos con la instalación de prometheus en nuestra maquina. Prometheus en un sistema open-source de monitorización y alerta.</p>

<p>Comenzamos instalando prometheus</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install prometheus prometheus-node-exporter
</code></pre></div></div>

<p>Tras la instalación de prometheus tenemos que comprobar tanto que tenemos dos conexiones TCP escuchando en los puertos 9090 y 9100, esto lo comprobamos con el siguiente comando</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -plunt
</code></pre></div></div>

<p>Nota: para poder hacer uso del comando netstat tendremos que tener instalado en el sistema el paquete net-tools</p>

<p>Como la version de prometheus que usemos tiene que ser compatible con la de grafana, es recomendable revisar nuestra version de prometheus</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>prometheus-node-exporter --version
</code></pre></div></div>

<p>En mi caso la version de prometheus usada es la siguiente</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_exporter, version 1.5.1 (branch: debian/sid, revision: 1.5.0-1)
</code></pre></div></div>

<h3 id="configuración-de-prometheus-en-grafana"><strong>Configuración de prometheus en grafana</strong></h3>

<p>Grafana necesita una base de datos que guarde las métricas guardadas por grafana, en este caso se hará uso de prometheus, otras opciones pueden ser graphite, influxDB u openTSDB entre otros.</p>

<p>Para añadir la base de datos de prometheus a grafana accedemos primero al sitio web de nuestro grafana como se ha indicado anteriormente, buscando en nuestro navegador la ip o dominio de nuestra maquina e indicando el puerto 3000.</p>

<p>En el menú de la izquierda vamos a la opción “connections” y después a la opción “data sources”, donde nos aparecerá la opción para añadir nuestra base de datos, en este caso prometheus, para ello será necesario añadir la URL http://localhost:9090.</p>

<p><img src="/images/Grafana/data-source.png" alt="Data source" /></p>

<h3 id="creación-de-dashboards"><strong>Creación de dashboards</strong></h3>

<p>Con grafana tenemos la opción tanto de crear nuestro propio dashboard dependiendo de las necesidades de monitorización que tenga nuestro sistema así como también la opción de importar dashboards creados por la comunidad en <a href="https://grafana.com/grafana/dashboards/">Grafana dashboards</a></p>

<p>En este caso para importar los dashboards en el menú de la izquierda buscamos la opción de “dashboards”, abrimos la opción “create dashboard” y después entre las tres opciones que nos ofrece grafana seleccionamos la opción “import dashboard”. Una vez ahi para importar el dashboard podemos indicar tanto la url del dashboard como la ID,</p>

<p>A modo de ejemplo se ha usado el dashboard Node exporter siendo el mas descargado por lo que para su uso indicamos la ID de node-exportes (1860) y ya podremos empezar a usar el dashboard.</p>

<p><img src="/images/Grafana/metrica.png" alt="Dashboard" /></p>

<p>Si por el contrario en lugar de importar dashboards creados por la comunidad queremos crear nuestros propios dashboards personalizados dependiendo de las necesidades que tengamos a la hora de monitorizar tendríamos que realizar los siguientes pasos:</p>

<p>Al igual que se ha hecho anteriormente, en el menú de la izquierda buscamos la opción de “dashboards” y abrimos la opción “create dashboard” pero esta vez en lugar de seleccionar la opción “import dashboard”, elegimos la opción “+ add visualization”.</p>

<p>Al acceder a “add visualization” lo primero que nos pedirá grafana será que elijamos un data source que será desde donde grafana obtenga los datos de las métricas. Al tratarse de una maquina recién creada en mi caso el único data source que da la opción de seleccionar será el de prometheus pero según las necesidades que tengamos podemos instalar cualquier otro para poder usarlo.</p>

<p><img src="/images/Grafana/prometheus.png" alt="Prometheus" /></p>

<p>Al crear un dashboard vacío, lo primero que haremos será crear los paneles. Un panel es el bloque básico para la visualización de los datos. Grafana provee diferentes tipos de paneles y cada uno de ellos provee un editor de consulta (query) dependiendo del tipo de Data Source seleccionado.</p>

<p><img src="/images/Grafana/panel.png" alt="Panel vacío" /></p>

<p>Vamos a crear un panel de tipo gráfico en el que por ejemplo consultaremos la tasa promedio de solicitudes HTTP en los últimos 5 minutos, para ello en la parte de abajo donde visualizamos los paneles encontraremos la opción “query” donde podremos realizar diversas consultas de datos en el apartado “metrics”. Como por ejemplo lo que queremos consultar es la tasa promedio de solicitudes http la métrica que necesitamos seria la de “prometheus_http_request_total”.</p>

<p>También podemos agregar un rango de tiempo para que los datos estén lo mas actualizados posibles, en este caso como rango de tiempo se ha puesto de 5 min, para ello bajo el apartado métrica nos aparecerá una opción llamada “hint: add rate” donde tendremos para elegir distintos rangos de actualización, desde 1 min a 24h.</p>

<p>Cuando tengamos claro el tipo de consulta que haremos, en el apartado derecho seleccionaremos el tipo de gráfica para mostrar los datos ademas de poder seleccionar diversas opciones para que esos datos se muestren lo mejor y mas claramente posible.</p>

<p>La consulta nos quedaria de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rate(prometheus_http_request_total[5m])
</code></pre></div></div>

<h3 id="configuraciones-de-paneles"><strong>Configuraciones de paneles</strong></h3>

<p>A la hora de configurar y editar nuestros paneles en el menú de la derecha contamos con varias opciones que nos pueden ser útiles para poder diferenciar los datos que mostrara dicho panel en el dashboard. La primera opción que veremos será la que nos permitirá seleccionar la forma gráfica en la que los datos se nos mostraran.</p>

<ul>
  <li>Panel options</li>
</ul>

<p>En este apartado podremos ponerle un nombre y descripción (si fuese necesario) al panel que se haya creado. Ademas de indicar un nombre y descripción también contaremos con una opción que puede ser muy util que seria la opción “panel links” lo que nos permitirá compartir paneles entre distintos miembros de un equipo o distintos usuarios compartiendo la url que genere el panel.</p>

<h3 id="personalización-avanzada-de-dashboards-y-alertas-en-grafana"><strong>Personalización avanzada de dashboards y alertas en grafana</strong></h3>

<ul>
  <li>
    <p>Dashboards avanzados
Los dashboards en Grafana permiten visualizar métricas de manera clara y personalizada. Para optimizar su uso, puedes aplicar las siguientes técnicas avanzadas:</p>
  </li>
  <li>
    <p>Uso de variables en dashboards
Las variables en Grafana permiten cambiar dinámicamente los datos mostrados en los paneles sin modificar las consultas manualmente. Esto es útil cuando deseas filtrar información en tiempo real.</p>
  </li>
</ul>

<p>Ejemplo práctico:</p>

<p>Si estás monitoreando múltiples servidores, puedes crear una variable $server con la lista de servidores disponibles.
En tu consulta PromQL, en lugar de escribir manualmente cada servidor, usas:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_cpu_seconds_total{instance="$server"}
</code></pre></div></div>

<p>Al cambiar la variable $server, los gráficos mostrarán solo los datos de ese servidor.</p>

<ul>
  <li>¿Como configurar una variable en grafana?</li>
</ul>

<p>Para dicha configuracion seguirmos los siguientes pasos:</p>

<ol>
  <li>Vamos a dashboards settings y seleccionamos la opcion “Variables”.</li>
  <li>Creamos una nueva variable.</li>
  <li>Configuramos la variable.</li>
</ol>

<p>Usando el ejemplo indicado anteriormente, se configurará la variable $server de la siguiente manera:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Nombre de la variable: Server
* Tipo: query
* Data source: Prometheus
* Query: label_values(node_cpu_seconds_total, instance)
</code></pre></div></div>

<p>Indicando label_values(métrica, etiqueta) obtendremos todos los valores únicos de la etiqueta “instance” en la métrica node_cpu_seconds_total. Esto devolverá una lista de servidores registrados en Prometheus, por ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>server1:9100
server2:9100
server3:9100
</code></pre></div></div>

<ol>
  <li>En Multi-value, activamos la opción para permitir seleccionar múltiples servidores.</li>
  <li>En Include All option, marcamos la casilla para agregar la opción All, que mostrará los datos de todos los servidores simultáneamente.</li>
  <li>Guardamos la variable y volvemos al dashboard.</li>
</ol>

<ul>
  <li>Filtros y segmentación</li>
</ul>

<p>Grafana permite filtrar datos en tiempo real sin necesidad de cambiar las consultas directamente en PromQL.</p>

<p>Ejemplo práctico:</p>

<p>Si estás monitoreando diferentes servicios en un clúster, puedes agregar filtros para ver solo las métricas de un servicio en específico, como nginx, mysql, o redis.</p>

<ul>
  <li>¿Cómo configurarlo?</li>
</ul>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Añade una variable de tipo Custom con valores como nginx</td>
          <td>mysql</td>
          <td>redis.</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>En la consulta, usamos:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>node_network_receive_bytes_total{job="$servicio"}
</code></pre></div></div>

<ol>
  <li>Ahora puedes seleccionar el servicio desde un menú desplegable y ver los datos filtrados.</li>
</ol>

<ul>
  <li>Uso de templates y dashboards reutilizables</li>
</ul>

<p>Si necesitas monitorizar múltiples entornos (Producción, Desarrollo, Testing), es recomendable crear dashboards reutilizables en lugar de duplicarlos.</p>

<ul>
  <li>¿Cómo hacer un dashboard genérico y reutilizable?</li>
</ul>

<ol>
  <li>
    <table>
      <tbody>
        <tr>
          <td>Usa variables para definir instancias o entornos ($env = prod</td>
          <td>dev</td>
          <td>test).</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>En las consultas, usa $env en lugar de nombres fijos.</li>
  <li>Guarda el dashboard como Template y reutilízalo en distintas configuraciones.</li>
</ol>

<h3 id="configuración-avanzada-de-alertas"><strong>Configuración avanzada de alertas</strong></h3>

<p>Las alertas en Grafana permiten monitorear valores críticos en los sistemas y recibir notificaciones cuando se superan ciertos umbrales.</p>

<ul>
  <li>Definir condiciones personalizadas</li>
</ul>

<p>Podemos configurar alertas para detectar problemas antes de que afecten el rendimiento del sistema.</p>

<p>Ejemplo práctico:</p>

<p>Si queremos recibir una alerta cuando el uso de CPU supera el 85% durante más de 5 minutos:</p>

<ol>
  <li>Vamos a Alerting y creamos la nueva alerta con la opcion “New Alert”.</li>
  <li>Definimos la métrica a monitorear con esta consulta en PromQL:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>100 - (avg(rate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) &gt; 85
</code></pre></div></div>

<ol>
  <li>Establecemos la condición If above 85 for 5m.</li>
  <li>Configuramos la acción (correo, stack, telegram, etc…). Grafana permite enviar alertas a traves de diferentes plataformas.</li>
</ol>

<ul>
  <li>¿Como configuramos una alerta para slack por ejemplo?</li>
</ul>

<ol>
  <li>vamos a “Alerting” y abrimos la opción llamada “notification channels”.</li>
  <li>Creamos un nuevo canal y seleccionamos Slack en este caso.</li>
  <li>Ingresamos la URL del webhook de slack (Un webhook es un mecanismo que permite que una aplicación envíe datos en tiempo real a otra aplicación cuando ocurre un evento específico.).</li>
  <li>Guardamos y asignamos este canal a las alertas configuradas.</li>
</ol>

<ul>
  <li>Grupos de alerta para una gestión eficiente</li>
</ul>

<p>Si se tienen muchas alertas configuradas, es recomendable agruparlas para evitar recibir demasiadas notificaciones.</p>

<p>Ejemplo práctico:</p>

<p>Si monitoreamos múltiples servidores, en lugar de recibir una alerta por cada uno, se pueden agrupar y recibir un solo mensaje que indique cuántos servidores están en estado crítico.</p>

<ul>
  <li>¿Como hacerlo?</li>
</ul>

<ol>
  <li>Configuramos un Grupo de alertas en Grafana.</li>
  <li>Usamos etiquetas (labels) para clasificar alertas por tipo (cpu, memoria, disco).</li>
  <li>Configuramos el envío de notificaciones con una frecuencia específica (ej. cada 10 minutos).</li>
</ol>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Sistemas" /><category term="Monitorización" /><summary type="html"><![CDATA[Aprende a instalar, configurar y personalizar Grafana para la monitorización avanzada de servidores. Descubre cómo integrar Prometheus, crear dashboards interactivos y configurar alertas para una gestión eficiente de tu infraestructura.]]></summary></entry><entry><title type="html">Introducción SoftEther VPN</title><link href="http://localhost:4000/seguridad/2021/12/21/SoftEther-VPN.html" rel="alternate" type="text/html" title="Introducción SoftEther VPN" /><published>2021-12-21T13:44:30+01:00</published><updated>2021-12-21T13:44:30+01:00</updated><id>http://localhost:4000/seguridad/2021/12/21/SoftEther-VPN</id><content type="html" xml:base="http://localhost:4000/seguridad/2021/12/21/SoftEther-VPN.html"><![CDATA[<h3 id="introducción"><strong>Introducción</strong></h3>

<p>Softether VPN es uno de los softwares VPN multiprotocolo mas potentes y rápido del mundo actualmente. Funciona en sistemas Windows, Solaris, Mac, FreeBSD y algunas distribuciones de Linux. Además de ser de software libre, también es una alternativa muy buena a openvpn y a los servidores VPN de microsoft.</p>

<p>Una de las funciones con las que cuenta este software es la de clonación de openvpn server, mediante la cual si se tiene un server openvpn, este se puede convertir rápidamente en un server Softether.</p>

<h3 id="características-de-softether">Características de SoftEther</h3>

<ul>
  <li>De código abierto.</li>
  <li>Fácil de establecer conexiones VPN tanto remotas como de sitio a sitio.</li>
  <li>Tunelización SSL-VPN en HTTPS para pasar a través de NAT y Firewalls.</li>
  <li>Funciones VPN sobre ICMP y DNS.</li>
  <li>DNS dinámico y NAT transversal integrados para que no se requiera una dirección IP fija o estática.</li>
  <li>Cifrados AES de 256 bits y RSA de 4096 bits.</li>
  <li>Rendimiento de rendimiento de alta velocidad de clase 1Gbps con bajo uso de memoria y CPU.</li>
  <li>SSL-VPN (HTTPS) y los 6 protocolos principales de VPN (OpenVPN, IPsec, L2TP, MS-SSTP, L2TPv3 y EtherIP) son compatibles como protocolos subyacentes de tunelización VPN.</li>
  <li>La función de clonación de OpenVPN  admite clientes de OpenVPN heredados.</li>
  <li>Función de autenticación de usuario de dominio RADIUS / NT</li>
  <li>Función de autenticación de certificado RSA</li>
  <li>Función de registro de paquetes de inspección profunda</li>
  <li>Función de lista de control de dirección IP de origen</li>
  <li>Función de transferencia de syslog</li>
  <li>Compatible con Azure Cloud</li>
  <li>Función de clonación openVPN lo que permite clientes heredados.</li>
</ul>

<h3 id="formas-de-autentificación">Formas de autentificación</h3>

<ul>
  <li>Anónima:</li>
</ul>

<p>Es el tipo más simple de autenticación de usuario. Si existe un usuario configurado mediante autenticación anónima para Virtual Hub, cualquier persona que conozca el nombre de usuario puede conectarse a Virtual Hub y realizar una comunicación VPN.</p>

<p>Este tipo de autentificación es la usada en los <a href="https://www.vpngate.net/en/">servidores públicos</a>.</p>

<ul>
  <li>Radius:</li>
</ul>

<p>Es un protocolo cliente-servidor mediante el cual si la maquina cliente quiere autenticarse para acceder a un servidor, manda primero un mensaje al servidor Radius, este si esta bien configurado dará o no el visto bueno al usuario, si el usuario tiene permitido el acceso se confirmara y se establecerá la conexión con el servidor mientras que si el usuario no tiene permitida la conexión se rechazara el intento de autentificación.</p>

<p>Esta opción de servidor radius también permite el uso de active directory para verificar el acceso del usuario cliente.</p>

<ul>
  <li>UserNTLMSet:</li>
</ul>

<p>Autentificación de dominio Windows NT haciendo uso de Active Directory.</p>

<ul>
  <li>Contraseña:</li>
</ul>

<p>Autentificación por contraseña de toda la vida.</p>

<ul>
  <li>Certificado:</li>
</ul>

<p>Autentificación haciendo uso de un certificado creado en el propio servidor softether a través del comando certcreate o bien haciendo uso de otras herramientas como let’s encrypt</p>

<h3 id="protocolos-que-usa-softether">Protocolos que usa Softether</h3>

<ul>
  <li>L2TP/IPsec - Internet Protocol security - Esta función es para aceptar conexiones VPN desde iPhone, iPad, Android, Windows y Mac OS X.</li>
  <li>MS-SSTP - Microsoft Secure Socket Tunneling Protocol - Implementa PPP (Protocolo Punto a Punto) sobre HTTPS (SSL). Encapsula todos los paquetes de usuario en TCP. Para que pueda pasar el cortafuegos fácilmente.</li>
  <li>L2TPv3 - puede establecer un túnel cifrado con IPsec entre el enrutador Cisco del sitio remoto y el servidor VPN SoftEther.</li>
  <li>EtherIP</li>
</ul>

<h3 id="diferencias-con-open-vpn-y-wireguard">Diferencias con Open VPN y Wireguard</h3>

<table>
  <thead>
    <tr>
      <th><strong>Característica</strong></th>
      <th><strong>OpenVPN</strong></th>
      <th><strong>WireGuard</strong></th>
      <th><strong>SoftEther</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Rendimiento</strong> (velocidad de conexión)</td>
      <td>100 Mbps</td>
      <td>900 Mbps (aprox)</td>
      <td>1 Gbps</td>
    </tr>
    <tr>
      <td><strong>Configuración</strong></td>
      <td>Sencilla</td>
      <td>Sencilla</td>
      <td>Sencilla</td>
    </tr>
    <tr>
      <td><strong>Seguridad</strong></td>
      <td>Baja</td>
      <td>Media-alta</td>
      <td>Alta</td>
    </tr>
    <tr>
      <td><strong>Estabilidad</strong></td>
      <td>Buena</td>
      <td>Buena</td>
      <td>Buena</td>
    </tr>
    <tr>
      <td><strong>Transmisión de contenido</strong></td>
      <td>Medio</td>
      <td>Alto</td>
      <td>Alto</td>
    </tr>
  </tbody>
</table>

<h3 id="casos-prácticos">Casos prácticos</h3>

<p>En este post se van a proponer un par de casos prácticos: el primero sera una conexión remota entre un servidor y un cliente en distintas redes en el que se hará uso de un servidor público remoto al que nos conectaremos a través de una maquina virtual que sera nuestro cliente local.</p>

<p>El segundo caso práctico sera un site to site en el cual tendré varias maquinas virtuales creadas en vagrant.</p>

<h3 id="caso-1-acceso-remoto-linux">Caso 1: Acceso Remoto (Linux)</h3>

<p>En este escenario contamos con un server publico remoto y un cliente creado con un sistema operativo debian por ejemplo.</p>

<p>Lo primero que hacemos en la máquina es actualizarla:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt update
apt upgrade
</code></pre></div></div>

<p>Al igual que con el servidor, instalamos lynx e instalamos SoftEther Client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Cliente-debian:/home/vagrant# lynx http://www.softether-download.com/files/softether/
</code></pre></div></div>

<p>Desempaquetamos Softether-client:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Cliente-debian:/home/vagrant# tar xzvf softether-vpnclient-v4.34-9745-rtm-2020.04.05-linux-x64-64bit.tar.gz 
vpnclient/
vpnclient/Makefile
vpnclient/.install.sh
vpnclient/ReadMeFirst_License.txt
vpnclient/Authors.txt
vpnclient/ReadMeFirst_Important_Notices_ja.txt
vpnclient/ReadMeFirst_Important_Notices_en.txt
vpnclient/ReadMeFirst_Important_Notices_cn.txt
vpnclient/code/
vpnclient/code/vpnclient.a
vpnclient/code/vpncmd.a
vpnclient/lib/
vpnclient/lib/libcharset.a
vpnclient/lib/libcrypto.a
vpnclient/lib/libedit.a
vpnclient/lib/libiconv.a
vpnclient/lib/libintelaes.a
vpnclient/lib/libncurses.a
vpnclient/lib/libssl.a
vpnclient/lib/libz.a
vpnclient/lib/License.txt
vpnclient/hamcore.se2
</code></pre></div></div>

<p>Instalamos los paquetes necesarios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install build-essential -y
</code></pre></div></div>

<p>Al igual que con el server, compilamos el programa para que pueda ser usado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Cliente-debian:/home/vagrant# cd vpnclient/
root@Cliente-debian:/home/vagrant/vpnclient# make
--------------------------------------------------------------------

SoftEther VPN Client (Ver 4.34, Build 9745, Intel x64 / AMD64) for Linux Install Utility
Copyright (c) SoftEther Project at University of Tsukuba, Japan. All Rights Reserved.

--------------------------------------------------------------------


Do you want to read the License Agreement for this software ?

 1. Yes
 2. No

Please choose one of above number: 
1

Copyright (c) all contributors on SoftEther VPN project in GitHub.
Copyright (c) Daiyuu Nobori, SoftEther Project at University of Tsukuba, and SoftEther Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.


DISCLAIMER
==========

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

THIS SOFTWARE IS DEVELOPED IN JAPAN, AND DISTRIBUTED FROM JAPAN, UNDER JAPANESE LAWS. YOU MUST AGREE IN ADVANCE TO USE, COPY, MODIFY, MERGE, PUBLISH, DISTRIBUTE, SUBLICENSE, AND/OR SELL COPIES OF THIS SOFTWARE, THAT ANY JURIDICAL DISPUTES WHICH ARE CONCERNED TO THIS SOFTWARE OR ITS CONTENTS, AGAINST US (SOFTETHER PROJECT, SOFTETHER CORPORATION, DAIYUU NOBORI OR OTHER SUPPLIERS), OR ANY JURIDICAL DISPUTES AGAINST US WHICH ARE CAUSED BY ANY KIND OF USING, COPYING, MODIFYING, MERGING, PUBLISHING, DISTRIBUTING, SUBLICENSING, AND/OR SELLING COPIES OF THIS SOFTWARE SHALL BE REGARDED AS BE CONSTRUED AND CONTROLLED BY JAPANESE LAWS, AND YOU MUST FURTHER CONSENT TO EXCLUSIVE JURISDICTION AND VENUE IN THE COURTS SITTING IN TOKYO, JAPAN. YOU MUST WAIVE ALL DEFENSES OF LACK OF PERSONAL JURISDICTION AND FORUM NON CONVENIENS. PROCESS MAY BE SERVED ON EITHER PARTY IN THE MANNER AUTHORIZED BY APPLICABLE LAW OR COURT RULE.

USE ONLY IN JAPAN. DO NOT USE THIS SOFTWARE IN ANOTHER COUNTRY UNLESS YOU HAVE A CONFIRMATION THAT THIS SOFTWARE DOES NOT VIOLATE ANY CRIMINAL LAWS OR CIVIL RIGHTS IN THAT PARTICULAR COUNTRY. USING THIS SOFTWARE IN OTHER COUNTRIES IS COMPLETELY AT YOUR OWN RISK. THE SOFTETHER VPN PROJECT HAS DEVELOPED AND DISTRIBUTED THIS SOFTWARE TO COMPLY ONLY WITH THE JAPANESE LAWS AND EXISTING CIVIL RIGHTS INCLUDING PATENTS WHICH ARE SUBJECTS APPLY IN JAPAN. OTHER COUNTRIES' LAWS OR CIVIL RIGHTS ARE NONE OF OUR CONCERNS NOR RESPONSIBILITIES. WE HAVE NEVER INVESTIGATED ANY CRIMINAL REGULATIONS, CIVIL LAWS OR INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENTS IN ANY OF OTHER 200+ COUNTRIES AND TERRITORIES. BY NATURE, THERE ARE 200+ REGIONS IN THE WORLD, WITH DIFFERENT LAWS. IT IS IMPOSSIBLE TO VERIFY EVERY COUNTRIES' LAWS, REGULATIONS AND CIVIL RIGHTS TO MAKE THE SOFTWARE COMPLY WITH ALL COUNTRIES' LAWS BY THE PROJECT. EVEN IF YOU WILL BE SUED BY A PRIVATE ENTITY OR BE DAMAGED BY A PUBLIC SERVANT IN YOUR COUNTRY, THE DEVELOPERS OF THIS SOFTWARE WILL NEVER BE LIABLE TO RECOVER OR COMPENSATE SUCH DAMAGES, CRIMINAL OR CIVIL
RESPONSIBILITIES. NOTE THAT THIS LINE IS NOT LICENSE RESTRICTION BUT JUST A STATEMENT FOR WARNING AND DISCLAIMER.

READ AND UNDERSTAND THE 'src/WARNING.TXT' FILE BEFORE USING THIS SOFTWARE. SOME SOFTWARE PROGRAMS FROM THIRD PARTIES ARE INCLUDED ON THIS SOFTWARE WITH LICENSE CONDITIONS WHICH ARE DESCRIBED ON THE 'src/THIRD_PARTY.TXT' FILE.


Did you read and understand the License Agreement ?
(If you couldn't read above text, Please read 'ReadMeFirst_License.txt'
 file with any text editor.)

 1. Yes
 2. No

Please choose one of above number: 
1


Did you agree the License Agreement ?

1. Agree
2. Do Not Agree

Please choose one of above number: 
1

make[1]: Entering directory '/home/vagrant/vpnclient'
Preparing SoftEther VPN Client...
ranlib lib/libcharset.a
ranlib lib/libcrypto.a
ranlib lib/libedit.a
ranlib lib/libiconv.a
ranlib lib/libintelaes.a
ranlib lib/libncurses.a
ranlib lib/libssl.a
ranlib lib/libz.a
ranlib code/vpnclient.a
gcc code/vpnclient.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpnclient
ranlib code/vpncmd.a
gcc code/vpncmd.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpncmd

--------------------------------------------------------------------
The preparation of SoftEther VPN Client is completed !


*** How to switch the display language of the SoftEther VPN Client Service ***
SoftEther VPN Client supports the following languages:
  - Japanese
  - English
  - Simplified Chinese

You can choose your prefered language of SoftEther VPN Client at any time.
To switch the current language, open and edit the 'lang.config' file.


Note: the administrative password is not set on the VPN Server. Please set your own administrative password as soon as possible by vpncmd or the GUI manager.


*** How to start the SoftEther VPN Client Service ***

Please execute './vpnclient start' to run the SoftEther VPN Client Background Service.
And please execute './vpncmd' to run the SoftEther VPN Command-Line Utility to configure SoftEther VPN Client.

Of course, you can use the VPN Server Manager GUI Application for Windows / Mac OS X on the other Windows / Mac OS X computers in order to configure the SoftEther VPN Client remotely.

*** For Windows users ***
You can download the SoftEther VPN Server Manager for Windows
from the http://www.softether-download.com/ web site.
This manager application helps you to completely and easily manage the VPN server services running in remote hosts.


*** For Mac OS X users ***
In April 2016 we released the SoftEther VPN Server Manager for Mac OS X.
You can download it from the http://www.softether-download.com/ web site.
VPN Server Manager for Mac OS X works perfectly as same as the traditional Windows versions. It helps you to completely and easily manage the VPN server services running in remote hosts.



*** PacketiX VPN Server HTML5 Web Administration Console (NEW) ***
This VPN Server / Bridge has the built-in HTML5 Web Administration Console.

After you start the server daemon, you can open the HTML5 Web Administration Console is available at

https://127.0.0.1:5555/
or
https://ip_address_of_the_vpn_server:5555/

This HTML5 page is obviously under construction, and your HTML5 development contribution is very appreciated.

--------------------------------------------------------------------

make[1]: Leaving directory '/home/vagrant/vpnclient'
</code></pre></div></div>

<p>Cambiamos la ubicación de vpnclient, en mi caso a /usr/local para mayor seguridad, aunque este paso no es realmente necesario y cambiamos los permisos a vpnclient y a vpncmd para que puedan ser ejecutados.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Cliente-debian:/home/vagrant/vpnclient# cd ..
root@Cliente-debian:/home/vagrant# mv vpnclient /usr/local/
root@Cliente-debian:/home/vagrant# cd /usr/local/vpnclient/
root@Cliente-debian:/usr/local/vpnclient# chmod 600 *
root@Cliente-debian:/usr/local/vpnclient# chmod 700 vpnclient
root@Cliente-debian:/usr/local/vpnclient# chmod 700 vpncmd
</code></pre></div></div>

<p>Una vez podamos ejecutar vpnclient y vpncmd, pasamos a iniciar el cliente iniciar nuestra primera conexión remota.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@Cliente-debian:/usr/local/vpnclient# ./vpnclient start
The SoftEther VPN Client service has been started.
root@Cliente-debian:/usr/local/vpnclient# ./vpncmd
vpncmd command - SoftEther VPN Command Line Management Utility
SoftEther VPN Command Line Management Utility (vpncmd command)
Version 4.34 Build 9745   (English)
Compiled 2020/04/05 23:39:56 by buildsan at crosswin
Copyright (c) SoftEther VPN Project. All Rights Reserved.

By using vpncmd program, the following can be achieved. 

1. Management of VPN Server or VPN Bridge 
2. Management of VPN Client
3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)

Select 1, 2 or 3: 2

Specify the host name or IP address of the computer that the destination VPN Client is operating on. 
If nothing is input and Enter is pressed, connection will be made to localhost (this computer).
Hostname of IP Address of Destination: 

Connected to VPN Client "localhost".

VPN Client&gt;NicCreate prueba 
NicCreate command - Create New Virtual Network Adapter
The command completed successfully.

VPN Client&gt;AccountCreate conexion_japon 
AccountCreate command - Create New VPN Connection Setting
Destination VPN Server Host Name and Port Number: 219.100.37.165:443

Destination Virtual Hub Name: vpngate

Connecting User Name: vpn

Used Virtual Network Adapter Name: prueba

The command completed successfully.

VPN Client&gt;accountlist
AccountList command - Get List of VPN Connection Settings
Item                        |Value
----------------------------+---------------------------------------------
VPN Connection Setting Name |conexion_japon
Status                      |Offline
VPN Server Hostname         |219.100.37.165:443 (Direct TCP/IP Connection)
Virtual Hub                 |vpngate
Virtual Network Adapter Name|prueba
----------------------------+---------------------------------------------
</code></pre></div></div>

<p>Para esta conexión remota hemos usado dos comandos, por un lado el comando NicCreate con el que creamos un adaptador de red virtual el cual se usará para conectarse al hub del servidor remoto y por otro lado usaremos también el comando AccountCreate para crear dicha configuración de conexión con el servidor.</p>

<p>Esta configuración de conexión incluye el virtualhub de destino al que nos conectaremos en el servidor(en este caso vpngate), la dirección y el puerto del servidor para acceder a el (tanto la dirección/IP como el puerto que usa para la conexión nos lo proporciona la página donde encontramos los servidores publicos), un nombre de usuario y una contraseña (vpn en ambos casos) y por último indicar el adaptador de red que se usara para conexión, en este caso el creado anteriormente.</p>

<p>Este servidor remoto cuenta con un usuario (vpn) con autentificación anonima por lo que cualquiera puede conectarse al servidor teniendo los datos.</p>

<p>Por último establecemos la conexión y comprobamos que realmente estamos conectados al servidor.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;accountpasswordset conexion_japon
AccountPasswordSet command - Set User Authentication Type of VPN Connection Setting to Password Authentication
Please enter the password. To cancel press the Ctrl+D key.

Password: ***
Confirm input: ***

Specify standard or radius: standard

The command completed successfully.

VPN Client&gt;AccountStatusGet conexion_japon
AccountStartupSet command - Set VPN Connection Setting as Startup Connection
The command completed successfully.

VPN Client&gt;accountconnect conexion_japon
AccountConnect command - Start Connection to VPN Server using VPN Connection Setting
The command completed successfully.

VPN Client&gt;AccountStatusGet connect 
AccountStatusGet command - Get Current VPN Connection Setting Status
Item                                    |Value
----------------------------------------+--------------------------------
VPN Connection Setting Name             |connect
Session Status                          |Connection to VPN Server Started
Connection Started at                   |2021-11-06 (Sat) 14:29:47
First Session has been Established since|-
Number of Established Sessions          |0 Times
The command completed successfully.
</code></pre></div></div>

<p>Comprobacion de VPN en servidor remoto (Japon):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;accountlist
AccountList command - Get List of VPN Connection Settings
Item                        |Value
----------------------------+---------------------------------------------
VPN Connection Setting Name |conexion_japon
Status                      |Online
VPN Server Hostname         |219.100.37.165:443 (Direct TCP/IP Connection)
Virtual Hub                 |vpngate
Virtual Network Adapter Name|prueba

root@Cliente-debian:/usr/local/vpnclient# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:8d:c0:4d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic eth0
       valid_lft 74741sec preferred_lft 74741sec
    inet6 fe80::a00:27ff:fe8d:c04d/64 scope link 
       valid_lft forever preferred_lft forever
3: eth1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:1f:1d:0d brd ff:ff:ff:ff:ff:ff
    inet 192.168.10.2/24 brd 192.168.10.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe1f:1d0d/64 scope link 
       valid_lft forever preferred_lft forever
6: vpn_conexion_japon: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether 5e:0e:ec:86:4b:24 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5c0e:ecff:fe86:4b24/64 scope link 
       valid_lft forever preferred_lft forever
root@Cliente-debian:/usr/local/vpnclient# ping 219.100.37.165
PING 219.100.37.165 (219.100.37.165) 56(84) bytes of data.
64 bytes from 219.100.37.165: icmp_seq=1 ttl=63 time=266 ms
64 bytes from 219.100.37.165: icmp_seq=2 ttl=63 time=289 ms
64 bytes from 219.100.37.165: icmp_seq=3 ttl=63 time=269 ms
64 bytes from 219.100.37.165: icmp_seq=4 ttl=63 time=271 ms
^C
--- 219.100.37.165 ping statistics ---
4 packets transmitted, 4 received, 0% packet loss, time 6ms
rtt min/avg/max/mdev = 265.728/273.468/288.916/9.097 ms
</code></pre></div></div>

<h3 id="caso-1-acceso-remoto-windows">Caso 1: Acceso Remoto (Windows)</h3>

<p>En el caso de windows (en mi caso windows 7), una vez instalado Softether-Client, lo abrimos y se nos mostrará una pantalla como la siguiente:</p>

<p><img src="/images/Softether/inicio.png" alt="inicio" /></p>

<p>Este caso en Windows se hace igual que en linux, en dos sencillos pasos: primero creamos el adaptador virtual y después configuramos la conexión remota.</p>

<p>El adaptador virtual de red lo haremos de la siguiente forma: Virtual Adapter -&gt; New Virtual Network Adapter</p>

<p><img src="/images/Softether/creacion_adaptador.png" alt="creación de adaptador" /></p>

<p>Una vez le demos un nombre al adaptador de red virtual se empezará a crear de forma automática.</p>

<p>Por otro lado la conexión la crearemos y configuraremos de la siguiente forma: Connect -&gt; New VPN Connection Setting</p>

<p><img src="/images/Softether/creacion_adaptador.png" alt="creación de conexión" /></p>

<p>Una vez ahi ponemos los datos de configuración de la conexión como el nombre de host de destino, su puerto, el hub al que se conectará, el usuario y contraseña del usuario que se conectará al servidor.</p>

<p><img src="/images/Softether/configuracion_conexion.png" alt="configuración de conexión" /></p>

<p>Por último conectamos con el servidor y comprobamos que obtenemos una direccion ip del servidor:</p>

<p>Conexión</p>

<p><img src="/images/Softether/establecer_conexion.png" alt="establecer conexión" />
<img src="/images/Softether/estableciendo_conexion.png" alt="estableciendo conexión" /></p>

<p>Comprobación</p>

<p><img src="/images/Softether/ip_publica.png" alt="ip pública antes de activar VPN" />
<img src="/images/Softether/ip_publica_vpn.png" alt="ip pública con VPN" /></p>

<p><img src="/images/Softether/ip.png" alt="ip antes de activar VPN" />
<img src="/images/Softether/ip_vpn.png" alt="ip con VPN" /></p>

<h3 id="caso-2-site-to-site">Caso 2: Site to site</h3>

<h4 id="instalación-y-configuración-de-server-vpn-ubuntu-xenial">Instalación y configuración de Server VPN (Ubuntu Xenial)</h4>

<p>Lo primero que haremos en nuestro servidor sera actualizarlo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/home/vagrant# apt update
root@server-vpn:/home/vagrant# apt upgrade
</code></pre></div></div>

<p>Instalamos los paquetes necesarios para poder compilar softether y asi hacer uso del server:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/home/vagrant# apt install build-essential
</code></pre></div></div>

<p>Una vez actualizado, pasamos a descargar softether vpn server, para hacerlo mediante comandos podemos hacer uso de los comandos lynx, wget o curl, en mi caso he usado el comando lynx. Cuando estemos en la página tendremos que elegir la versión de softether a instalar, en mi caso la versión de linux, indicamos que se descargará el server.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/home/vagrant# apt install lynx
root@server-vpn:/home/vagrant# lynx http://www.softether-download.com/files/softether/
</code></pre></div></div>

<p>Una vez descargado pasamos a extraerlo usando tar:</p>

<p>Cuando tengamos el fichero descargado, primero lo descomprimimos y despues entramos en el directorio vpnserver que se nos crea y compilamos los ficheros de forma que softether pueda ser usado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/home/vagrant# tar xzvf softether-vpnserver-v4.34-9745-rtm-2020.04.05-linux-x64-64bit.tar.gz
vpnserver/
vpnserver/Makefile
vpnserver/.install.sh
vpnserver/ReadMeFirst_License.txt
vpnserver/Authors.txt
vpnserver/ReadMeFirst_Important_Notices_ja.txt
vpnserver/ReadMeFirst_Important_Notices_en.txt
vpnserver/ReadMeFirst_Important_Notices_cn.txt
vpnserver/code/
vpnserver/code/vpnserver.a
vpnserver/code/vpncmd.a
vpnserver/lib/
vpnserver/lib/libcharset.a
vpnserver/lib/libcrypto.a
vpnserver/lib/libedit.a
vpnserver/lib/libiconv.a
vpnserver/lib/libintelaes.a
vpnserver/lib/libncurses.a
vpnserver/lib/libssl.a
vpnserver/lib/libz.a
vpnserver/lib/License.txt
vpnserver/hamcore.se2
root@server-vpn:/home/vagrant# cd vpnserver/
root@server-vpn:/home/vagrant/vpnserver# make
--------------------------------------------------------------------

SoftEther VPN Server (Ver 4.34, Build 9745, Intel x64 / AMD64) for Linux Install Utility
Copyright (c) SoftEther Project at University of Tsukuba, Japan. All Rights Reserved.

--------------------------------------------------------------------


Do you want to read the License Agreement for this software ?

 1. Yes
 2. No

Please choose one of above number: 
1

Copyright (c) all contributors on SoftEther VPN project in GitHub.
Copyright (c) Daiyuu Nobori, SoftEther Project at University of Tsukuba, and SoftEther Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.


DISCLAIMER
==========

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

THIS SOFTWARE IS DEVELOPED IN JAPAN, AND DISTRIBUTED FROM JAPAN, UNDER JAPANESE LAWS. YOU MUST AGREE IN ADVANCE TO USE, COPY, MODIFY, MERGE, PUBLISH, DISTRIBUTE, SUBLICENSE, AND/OR SELL COPIES OF THIS SOFTWARE, THAT ANY JURIDICAL DISPUTES WHICH ARE CONCERNED TO THIS SOFTWARE OR ITS CONTENTS, AGAINST US (SOFTETHER PROJECT, SOFTETHER CORPORATION, DAIYUU NOBORI OR OTHER SUPPLIERS), OR ANY JURIDICAL DISPUTES AGAINST US WHICH ARE CAUSED BY ANY KIND OF USING, COPYING, MODIFYING, MERGING, PUBLISHING, DISTRIBUTING, SUBLICENSING, AND/OR SELLING COPIES OF THIS SOFTWARE SHALL BE REGARDED AS BE CONSTRUED AND CONTROLLED BY JAPANESE LAWS, AND YOU MUST FURTHER CONSENT TO EXCLUSIVE JURISDICTION AND VENUE IN THE COURTS SITTING IN TOKYO, JAPAN. YOU MUST WAIVE ALL DEFENSES OF LACK OF PERSONAL JURISDICTION AND FORUM NON CONVENIENS. PROCESS MAY BE SERVED ON EITHER PARTY IN THE MANNER AUTHORIZED BY APPLICABLE LAW OR COURT RULE.

USE ONLY IN JAPAN. DO NOT USE THIS SOFTWARE IN ANOTHER COUNTRY UNLESS YOU HAVE A CONFIRMATION THAT THIS SOFTWARE DOES NOT VIOLATE ANY CRIMINAL LAWS OR CIVIL RIGHTS IN THAT PARTICULAR COUNTRY. USING THIS SOFTWARE IN OTHER COUNTRIES IS COMPLETELY AT YOUR OWN RISK. THE SOFTETHER VPN PROJECT HAS DEVELOPED AND DISTRIBUTED THIS SOFTWARE TO COMPLY ONLY WITH THE JAPANESE LAWS AND EXISTING CIVIL RIGHTS INCLUDING PATENTS WHICH ARE SUBJECTS APPLY IN JAPAN. OTHER COUNTRIES' LAWS OR CIVIL RIGHTS ARE NONE OF OUR CONCERNS NOR RESPONSIBILITIES. WE HAVE NEVER INVESTIGATED ANY CRIMINAL REGULATIONS, CIVIL LAWS OR INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENTS IN ANY OF OTHER 200+ COUNTRIES AND TERRITORIES. BY NATURE, THERE ARE 200+ REGIONS IN THE WORLD, WITH DIFFERENT LAWS. IT IS IMPOSSIBLE TO VERIFY EVERY COUNTRIES' LAWS, REGULATIONS AND CIVIL RIGHTS TO MAKE THE SOFTWARE COMPLY WITH ALL COUNTRIES' LAWS BY THE PROJECT. EVEN IF YOU WILL BE SUED BY A PRIVATE ENTITY OR BE DAMAGED BY A PUBLIC SERVANT IN YOUR COUNTRY, THE DEVELOPERS OF THIS SOFTWARE WILL NEVER BE LIABLE TO RECOVER OR COMPENSATE SUCH DAMAGES, CRIMINAL OR CIVIL
RESPONSIBILITIES. NOTE THAT THIS LINE IS NOT LICENSE RESTRICTION BUT JUST A STATEMENT FOR WARNING AND DISCLAIMER.

READ AND UNDERSTAND THE 'src/WARNING.TXT' FILE BEFORE USING THIS SOFTWARE. SOME SOFTWARE PROGRAMS FROM THIRD PARTIES ARE INCLUDED ON THIS SOFTWARE WITH LICENSE CONDITIONS WHICH ARE DESCRIBED ON THE 'src/THIRD_PARTY.TXT' FILE.


Did you read and understand the License Agreement ?
(If you couldn't read above text, Please read 'ReadMeFirst_License.txt'
 file with any text editor.)

 1. Yes
 2. No

Please choose one of above number: 
1


Did you agree the License Agreement ?

1. Agree
2. Do Not Agree

Please choose one of above number: 
1

make[1]: Entering directory '/home/vagrant/vpnserver'
Preparing SoftEther VPN Server...
ranlib lib/libcharset.a
ranlib lib/libcrypto.a
ranlib lib/libedit.a
ranlib lib/libiconv.a
ranlib lib/libintelaes.a
ranlib lib/libncurses.a
ranlib lib/libssl.a
ranlib lib/libz.a
ranlib code/vpnserver.a
gcc code/vpnserver.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpnserver
ranlib code/vpncmd.a
gcc code/vpncmd.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpncmd
./vpncmd /tool /cmd:Check
vpncmd command - SoftEther VPN Command Line Management Utility
SoftEther VPN Command Line Management Utility (vpncmd command)
Version 4.34 Build 9745   (English)
Compiled 2020/04/05 23:39:56 by buildsan at crosswin
Copyright (c) SoftEther VPN Project. All Rights Reserved.

VPN Tools has been launched. By inputting HELP, you can view a list of the commands that can be used.

VPN Tools&gt;Check
Check command - Check whether SoftEther VPN Operation is Possible
---------------------------------------------------
SoftEther VPN Operation Environment Check Tool

Copyright (c) SoftEther VPN Project.
All Rights Reserved.

If this operation environment check tool is run on a system and that system passes, it is most likely that SoftEther VPN software can operate on that system. This check may take a while. Please wait...

Checking 'Kernel System'... 
              Pass
Checking 'Memory Operation System'... 
              Pass
Checking 'ANSI / Unicode string processing system'... 
              Pass
Checking 'File system'... 
              Pass
Checking 'Thread processing system'... 
              Pass
Checking 'Network system'... 
              Pass

All checks passed. It is most likely that SoftEther VPN Server / Bridge can operate normally on this system.

The command completed successfully.


--------------------------------------------------------------------
The preparation of SoftEther VPN Server is completed !


*** How to switch the display language of the SoftEther VPN Server Service ***
SoftEther VPN Server supports the following languages:
  - Japanese
  - English
  - Simplified Chinese

You can choose your prefered language of SoftEther VPN Server at any time.
To switch the current language, open and edit the 'lang.config' file.


Note: the administrative password is not set on the VPN Server. Please set your own administrative password as soon as possible by vpncmd or the GUI manager.


*** How to start the SoftEther VPN Server Service ***

Please execute './vpnserver start' to run the SoftEther VPN Server Background Service.
And please execute './vpncmd' to run the SoftEther VPN Command-Line Utility to configure SoftEther VPN Server.

Of course, you can use the VPN Server Manager GUI Application for Windows / Mac OS X on the other Windows / Mac OS X computers in order to configure the SoftEther VPN Server remotely.

*** For Windows users ***
You can download the SoftEther VPN Server Manager for Windows
from the http://www.softether-download.com/ web site.
This manager application helps you to completely and easily manage the VPN server services running in remote hosts.


*** For Mac OS X users ***
In April 2016 we released the SoftEther VPN Server Manager for Mac OS X.
You can download it from the http://www.softether-download.com/ web site.
VPN Server Manager for Mac OS X works perfectly as same as the traditional Windows versions. It helps you to completely and easily manage the VPN server services running in remote hosts.



*** PacketiX VPN Server HTML5 Web Administration Console (NEW) ***
This VPN Server / Bridge has the built-in HTML5 Web Administration Console.

After you start the server daemon, you can open the HTML5 Web Administration Console is available at

https://127.0.0.1:5555/
or
https://ip_address_of_the_vpn_server:5555/

This HTML5 page is obviously under construction, and your HTML5 development contribution is very appreciated.

--------------------------------------------------------------------

make[1]: Leaving directory '/home/vagrant/vpnserver'
</code></pre></div></div>

<p>A la hora de compilar softether hay que tener en cuenta dos cosas, la primera que tenemos que responder a las preguntas que se nos muestran con la opcion 1 para aceptar los terminos de licencia, la segunda que a la hora de checkear la compilacion, debe tener aprobadas todas las configuraciones, sino el programa no se compilara y no podra usarse.</p>

<p>Ahora podemos ejecutar nuestro servidor ejecutando ./vpnserver start, pero en su lugar configuraremos softether como un daemon:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/home/vagrant/vpnserver# cd ..
root@server-vpn:/home/vagrant# mv vpnserver /usr/local
root@server-vpn:/home/vagrant# cd /usr/local/vpnserver/
root@server-vpn:/usr/local/vpnserver# sudo chmod 600 *
root@server-vpn:/usr/local/vpnserver# sudo chmod 700 vpnserver
root@server-vpn:/usr/local/vpnserver# sudo chmod 700 vpncmd
</code></pre></div></div>

<p>Creamos el servicio systemd para softether creando el servicio vpnserver en /lib/systemd/system/ con el siguiente contenido:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[Unit]
Description=SoftEther VPN Server
After=network.target

[Service]
Type=forking
ExecStart=/usr/local/vpnserver/vpnserver start
ExecStop=/usr/local/vpnserver/vpnserver stop

[Install]
WantedBy=multi-user.target
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/usr/local/vpnserver# systemctl status vpnserver
● vpnserver.service - SoftEther VPN Server
   Loaded: loaded (/lib/systemd/system/vpnserver.service; disabled; vendor preset: enabled)
   Active: active (running) since Sun 2021-11-28 10:42:35 UTC; 5s ago
  Process: 8395 ExecStart=/usr/local/vpnserver/vpnserver start (code=exited, status=0/SUCCESS)
 Main PID: 8400 (vpnserver)
    Tasks: 33
   Memory: 17.1M
      CPU: 348ms
   CGroup: /system.slice/vpnserver.service
           ├─8400 /usr/local/vpnserver/vpnserver execsvc
           └─8401 /usr/local/vpnserver/vpnserver execsvc

Nov 28 10:42:35 server-vpn systemd[1]: Starting SoftEther VPN Server...
Nov 28 10:42:35 server-vpn vpnserver[8395]: The SoftEther VPN Server service has been started.
Nov 28 10:42:35 server-vpn vpnserver[8395]: Let's get started by accessing to the following URL from your PC:
Nov 28 10:42:35 server-vpn vpnserver[8395]: https://10.0.2.15:5555/
Nov 28 10:42:35 server-vpn vpnserver[8395]:   or
Nov 28 10:42:35 server-vpn vpnserver[8395]: https://10.0.2.15/
Nov 28 10:42:35 server-vpn vpnserver[8395]: Note: IP address may vary. Specify your server's IP address.
Nov 28 10:42:35 server-vpn vpnserver[8395]: A TLS certificate warning will appear because the server uses self signed certificate by default. That is natural. Continue with 
Nov 28 10:42:35 server-vpn systemd[1]: Started SoftEther VPN Server.
</code></pre></div></div>

<p>Podemos ver que el checkeo a salido bien ya que ha pasado sin problemas las comprobaciones que se han hecho, por lo que nuestro servidor softethernet ya esta listo para configurarse y usarse.</p>

<p>La primera configuracion que haremos en nuestro server sera configurar una contraseña de admin, para ello usaremos vpncmd:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/usr/local/vpnserver# ./vpncmd
vpncmd command - SoftEther VPN Command Line Management Utility
SoftEther VPN Command Line Management Utility (vpncmd command)
Version 4.34 Build 9745   (English)
Compiled 2020/04/05 23:39:56 by buildsan at crosswin
Copyright (c) SoftEther VPN Project. All Rights Reserved.

By using vpncmd program, the following can be achieved. 

1. Management of VPN Server or VPN Bridge 
2. Management of VPN Client
3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)

Select 1, 2 or 3: 1

Specify the host name or IP address of the computer that the destination VPN Server or VPN Bridge is operating on. 
By specifying according to the format 'host name:port number', you can also specify the port number. 
(When the port number is unspecified, 443 is used.)
If nothing is input and the Enter key is pressed, the connection will be made to the port number 8888 of localhost (this computer).
Hostname of IP Address of Destination: 

If connecting to the server by Virtual Hub Admin Mode, please input the Virtual Hub name. 
If connecting by server admin mode, please press Enter without inputting anything.
Specify Virtual Hub Name: 
Connection has been established with VPN Server "localhost" (port 443).

You have administrator privileges for the entire VPN Server.

VPN Server&gt;ServerPasswordSet
ServerPasswordSet command - Set VPN Server Administrator Password
Please enter the password. To cancel press the Ctrl+D key.

Password: ************  #admin-server
Confirm input: ************


The command completed successfully.

VPN Server&gt;
</code></pre></div></div>

<p>Para poder usar Softether lo primero sera crear un concentrador virtual o hub al que posteriormente se puedan conectar los clientes. En SoftEther VPN, un hub virtual es un punto central de conexión donde se gestionan los clientes VPN. Es similar a un switch en una red física, permitiendo la comunicación entre los dispositivos conectados.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server&gt;HubCreate Empresa
HubCreate command - Create New Virtual Hub
Please enter the password. To cancel press the Ctrl+D key.

Password: ************ #admin-server
Confirm input: ************


The command completed successfully.
</code></pre></div></div>

<p>Por otro lado, empezaremos a configurar un puente local para que los clientes en la misma red puedan conectarse sin problemas. Este puente local se puede hacer de dos formas, la primera es usando la función de SecureNAT y la segunda seria configurar un puente local haciendo uso de la interfaz tap:</p>

<ul>
  <li>Casos en los que se aplica la opción SecureNAT:</li>
</ul>

<ol>
  <li>Redes pequeas o de pruebas (no requiere configuraciones avanzadas ni tocar la configuraci-on de red del servidor).</li>
  <li>Clientes moviles o con IP dinámicas debido a que SecureNAT permite conexiones sin necesidad de cambiar reglas de firewall o rutas y funciona bien para usuarios remotos que se conectan desde redes públicas o con restricciones.</li>
  <li>Ambientes con restricciones de red a que SecureNAT encapsula el tráfico en HTTPS, lo que permite eludir restricciones en redes corporativas o escolares y no necesitas abrir puertos adicionales en el firewall del servidor.</li>
</ol>

<p>Ejemplo practico</p>

<p>Un trabajador remoto necesita conectarse a la red de la empresa sin modificar su router o la configuración del firewall. SecureNAT le asigna una IP virtual sin interferir con su red local.</p>

<ul>
  <li>Casos en los que se aplica el uso de la interfaz tap</li>
</ul>

<ol>
  <li>Integración total con la red local, ya que al contrario que SecureNat la interfaz tap hace que los clientes VPN tengan una IP en la misma subred que el resto de dispositivos locales lo que permite que los clientes accedan a los recursos compartidos como impresoras y servidores locales</li>
  <li>VPN Site to site</li>
  <li>Rendimiento optimizado debido a que ebita la sobrecarga de NAT, mejorando asi la velocidad y estabilidad del tráfico de red.</li>
</ol>

<p>Ejemplo práctico:</p>

<p>Una empresa con oficinas en dos ciudades necesita que los empleados accedan a la misma red interna sin restricciones. Un puente TAP les asigna IPs de la misma red, como si estuvieran físicamente en la sede principal.</p>

<p>En el caso de querer configurar SecureNAT, es tan sencillo como ejecutar el siguiente comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/VPN1&gt;SecureNatEnable
SecureNatEnable command - Enable the Virtual NAT and DHCP Server Function (SecureNat Function)
The command completed successfully.
</code></pre></div></div>

<p>En el caso de querer usar la interfaz tap, tendriamos que hacer lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server&gt;BridgeCreate /DEVICE:"soft" /TAP:yes Empresa
BridgeCreate command - Create Local Bridge Connection
While in the condition that occurs immediately after a new bridge connection is made when bridging to a physical network adapter, depending on the type of network adapter, there are cases where it will not be possible to communicate using TCP/IP to the network adapter using a bridge connection from a computer on the virtual network. 
(This phenomenon is known to occur for Intel and Broadcom network adapters.) 


If this issue arises, remedy the situation by restarting the computer on which VPN Server / Bridge is running. Normal communication will be possible after the computer has restarted. 


Also many wireless network adapters will not respond to the sending of packets in promiscuous mode and when this occurs you will be unable to use the Local Bridge. If this issue arises, try using a regular wired network adapter instead of the wireless network adapter.

Instructions for Local Bridge on VM
It has been detected that the VPN Server might be running on a VM (Virtual Machine) suchlike VMware or Hyper-V. Read the following instructions carefully. If you are not using a VM, please ignore this message.
Some VMs prohibit the "Promiscuous Mode" (MAC Address Spoofing) on the network adapters by default.

If the Promiscuous Mode (MAC Address Spoofing) is administratively disabled, the Local Bridge function between a Virtual Hub on the VPN Server and a physical network adapter on the physical computer does not work well. You should allow the Promiscuous Mode (MAC Address Spoofing) by using the configuration tool of the VM.

For details please refer the documents of your VM. If it is a shared-VM and administrated by other person, please request the administrator to permit the use of the Promiscuous (MAC Address Spoofing) Mode to your VM.

The command completed successfully.
</code></pre></div></div>

<p>Esta creación de puente local es posible que muestre un error de privilegios insuficientes, es necesario asegurarse de que el controlador de red usado este configurado en modo promiscuo.</p>

<p>Ahora una vez creado el puente local, crearemos los usuarios necesarios que tendran acceso a el, dichos usuarios pueden tener distintos metodos de autentificación (contraseña, certificado, RADIUS, NTLM y otros) metiendolos en un grupo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;UserCreate sergio
UserCreate command - Create User 
Assigned Group Name: 

User Full Name: sergio

User Description: sergio

The command completed successfully.

VPN Server/Empresa&gt;UserPasswordSet sergio
UserPasswordSet command - Set Password Authentication for User Auth Type and Set Password
Please enter the password. To cancel press the Ctrl+D key.

Password: **********  #usuario-01
Confirm input: **********


The command completed successfully.

VPN Server/Empresa&gt;UserCreate invitado
UserCreate command - Create User 
Assigned Group Name: 

User Full Name: prueba    

User Description: usuario de pruebas

The command completed successfully.

VPN Server/Empresa&gt;UserPasswordSet invitado
UserPasswordSet command - Set Password Authentication for User Auth Type and Set Password
Please enter the password. To cancel press the Ctrl+D key.

Password: ********** #usuario-02
Confirm input: **********


The command completed successfully.
</code></pre></div></div>

<p>Ahora configuramos L2TP/IPSec:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;IPsecEnable
IPsecEnable command - Enable or Disable IPsec VPN Server Function
Enable L2TP over IPsec Server Function (yes / no): yes

Enable Raw L2TP Server Function (yes / no): yes

Enable EtherIP / L2TPv3 over IPsec Server Function (yes / no): yes

Pre Shared Key for IPsec (Recommended: 9 letters at maximum): softether 

Default Virtual HUB in a case of omitting the HUB on the Username: Empresa

The command completed successfully.
</code></pre></div></div>

<p>Generamos un certificado para que los clientes puedan acceder al servidor a traves de un certificado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;ServerCertRegenerate
ServerCertRegenerate command - Generate New Self-Signed Certificate with Specified CN (Common Name) and Register on VPN Server
Value of Common Name (CN): server-vpn


A new server certificate has been set.

If you are using OpenVPN protocols, please mind that you may have to update the inline certificate data in the OpenVPN configuration file.

The command completed successfully.

VPN Server/Empresa&gt;ServerCertGet ~/cert.cer
ServerCertGet command - Get SSL Certificate of VPN Server
The command completed successfully.
</code></pre></div></div>

<p>Habilitamos la función sstp:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;SstpEnable yes
SstpEnable command - Enable / Disable Microsoft SSTP VPN Clone Server Function
The command completed successfully.
</code></pre></div></div>

<p>Habilitamos openvpn:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;OpenVpnEnable yes /PORTS:1194
OpenVpnEnable command - Enable / Disable OpenVPN Clone Server Function
The command completed successfully.
</code></pre></div></div>

<p>Creamos una configuración openvpn por si se da el caso de que los clientes tengan openvpn:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;OpenVpnMakeConfig ~/openvpn_config.zip
OpenVpnMakeConfig command - Generate a Sample Setting File for OpenVPN Client
The sample setting file was saved as "~/openvpn_config.zip". You can unzip this file to extract setting files.
The command completed successfully.
</code></pre></div></div>

<p>Habilitamos tanto icmp como dns (En caso de haber creado la interfaz tap, con SecureNAT no es necesario):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/Empresa&gt;VpnOverIcmpDnsEnable /ICMP:yes /DNS:yes
VpnOverIcmpDnsEnable command - Enable / Disable the VPN over ICMP / VPN over DNS Server Function
The command completed successfully.
</code></pre></div></div>

<p>Configuramos dns y dhcp</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/usr/local/vpnserver# service vpnserver stop
root@server-vpn:/usr/local/vpnserver# echo interface=tap_soft &gt;&gt; /etc/dnsmasq.conf
root@server-vpn:/usr/local/vpnserver# echo dhcp-range=tap_soft,192.168.1.50,192.168.1.200,12h &gt;&gt; /etc/dnsmasq.conf
root@server-vpn:/usr/local/vpnserver# echo dhcp-option=tap_soft,3,192.168.1.1 &gt;&gt; /etc/dnsmasq.conf
root@server-vpn:/usr/local/vpnserver# echo port=0 &gt;&gt; /etc/dnsmasq.conf
root@server-vpn:/usr/local/vpnserver# echo dhcp-option=option:dns-server,8.8.8.8 &gt;&gt; /etc/dnsmasq.conf
root@server-vpn:/usr/local/vpnserver# echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.d/ipv4_forwarding.conf
</code></pre></div></div>

<p>Aplicamos los cambios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@server-vpn:/usr/local/vpnserver# sysctl -n -e --system
* Applying /etc/sysctl.d/10-console-messages.conf ...
4 4 1 7
* Applying /etc/sysctl.d/10-ipv6-privacy.conf ...
2
2
* Applying /etc/sysctl.d/10-kernel-hardening.conf ...
1
* Applying /etc/sysctl.d/10-link-restrictions.conf ...
1
1
* Applying /etc/sysctl.d/10-lxd-inotify.conf ...
1024
* Applying /etc/sysctl.d/10-magic-sysrq.conf ...
176
* Applying /etc/sysctl.d/10-network-security.conf ...
1
1
1
* Applying /etc/sysctl.d/10-ptrace.conf ...
1
* Applying /etc/sysctl.d/10-zeropage.conf ...
65536
* Applying /etc/sysctl.d/99-cloudimg-ipv6.conf ...
0
0
* Applying /etc/sysctl.d/99-sysctl.conf ...
* Applying /etc/sysctl.d/ipv4_forwarding.conf ...
1
* Applying /etc/sysctl.conf ...
</code></pre></div></div>

<h4 id="en-el-caso-del-cliente">En el caso del cliente</h4>

<p>Actualizamos el cliente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/home/vagrant# apt update
root@cliente-vpn:/home/vagrant# apt upgrade
</code></pre></div></div>

<p>Instalamos softether con lynx:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/home/vagrant# lynx http://www.softether-download.com/files/softether/
</code></pre></div></div>

<p>Instalamos los paquetes necesarios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/home/vagrant# apt install build-essential
</code></pre></div></div>

<p>Descomprimimos el fichero:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/home/vagrant# tar xzvf softether-vpnclient-v4.34-9745-rtm-2020.04.05-linux-x64-64bit.tar.gz
vpnclient/
vpnclient/Makefile
vpnclient/.install.sh
vpnclient/ReadMeFirst_License.txt
vpnclient/Authors.txt
vpnclient/ReadMeFirst_Important_Notices_ja.txt
vpnclient/ReadMeFirst_Important_Notices_en.txt
vpnclient/ReadMeFirst_Important_Notices_cn.txt
vpnclient/code/
vpnclient/code/vpnclient.a
vpnclient/code/vpncmd.a
vpnclient/lib/
vpnclient/lib/libcharset.a
vpnclient/lib/libcrypto.a
vpnclient/lib/libedit.a
vpnclient/lib/libiconv.a
vpnclient/lib/libintelaes.a
vpnclient/lib/libncurses.a
vpnclient/lib/libssl.a
vpnclient/lib/libz.a
vpnclient/lib/License.txt
vpnclient/hamcore.se2
</code></pre></div></div>

<p>Compilamos el fichero:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/home/vagrant# cd vpnclient/
root@cliente-vpn:/home/vagrant/vpnclient# make
--------------------------------------------------------------------

SoftEther VPN Client (Ver 4.34, Build 9745, Intel x64 / AMD64) for Linux Install Utility
Copyright (c) SoftEther Project at University of Tsukuba, Japan. All Rights Reserved.

--------------------------------------------------------------------


Do you want to read the License Agreement for this software ?

 1. Yes
 2. No

Please choose one of above number: 
1

Copyright (c) all contributors on SoftEther VPN project in GitHub.
Copyright (c) Daiyuu Nobori, SoftEther Project at University of Tsukuba, and SoftEther Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.


DISCLAIMER
==========

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

THIS SOFTWARE IS DEVELOPED IN JAPAN, AND DISTRIBUTED FROM JAPAN, UNDER JAPANESE LAWS. YOU MUST AGREE IN ADVANCE TO USE, COPY, MODIFY, MERGE, PUBLISH, DISTRIBUTE, SUBLICENSE, AND/OR SELL COPIES OF THIS SOFTWARE, THAT ANY JURIDICAL DISPUTES WHICH ARE CONCERNED TO THIS SOFTWARE OR ITS CONTENTS, AGAINST US (SOFTETHER PROJECT, SOFTETHER CORPORATION, DAIYUU NOBORI OR OTHER SUPPLIERS), OR ANY JURIDICAL DISPUTES AGAINST US WHICH ARE CAUSED BY ANY KIND OF USING, COPYING, MODIFYING, MERGING, PUBLISHING, DISTRIBUTING, SUBLICENSING, AND/OR SELLING COPIES OF THIS SOFTWARE SHALL BE REGARDED AS BE CONSTRUED AND CONTROLLED BY JAPANESE LAWS, AND YOU MUST FURTHER CONSENT TO EXCLUSIVE JURISDICTION AND VENUE IN THE COURTS SITTING IN TOKYO, JAPAN. YOU MUST WAIVE ALL DEFENSES OF LACK OF PERSONAL JURISDICTION AND FORUM NON CONVENIENS. PROCESS MAY BE SERVED ON EITHER PARTY IN THE MANNER AUTHORIZED BY APPLICABLE LAW OR COURT RULE.

USE ONLY IN JAPAN. DO NOT USE THIS SOFTWARE IN ANOTHER COUNTRY UNLESS YOU HAVE A CONFIRMATION THAT THIS SOFTWARE DOES NOT VIOLATE ANY CRIMINAL LAWS OR CIVIL RIGHTS IN THAT PARTICULAR COUNTRY. USING THIS SOFTWARE IN OTHER COUNTRIES IS COMPLETELY AT YOUR OWN RISK. THE SOFTETHER VPN PROJECT HAS DEVELOPED AND DISTRIBUTED THIS SOFTWARE TO COMPLY ONLY WITH THE JAPANESE LAWS AND EXISTING CIVIL RIGHTS INCLUDING PATENTS WHICH ARE SUBJECTS APPLY IN JAPAN. OTHER COUNTRIES' LAWS OR CIVIL RIGHTS ARE NONE OF OUR CONCERNS NOR RESPONSIBILITIES. WE HAVE NEVER INVESTIGATED ANY CRIMINAL REGULATIONS, CIVIL LAWS OR INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENTS IN ANY OF OTHER 200+ COUNTRIES AND TERRITORIES. BY NATURE, THERE ARE 200+ REGIONS IN THE WORLD, WITH DIFFERENT LAWS. IT IS IMPOSSIBLE TO VERIFY EVERY COUNTRIES' LAWS, REGULATIONS AND CIVIL RIGHTS TO MAKE THE SOFTWARE COMPLY WITH ALL COUNTRIES' LAWS BY THE PROJECT. EVEN IF YOU WILL BE SUED BY A PRIVATE ENTITY OR BE DAMAGED BY A PUBLIC SERVANT IN YOUR COUNTRY, THE DEVELOPERS OF THIS SOFTWARE WILL NEVER BE LIABLE TO RECOVER OR COMPENSATE SUCH DAMAGES, CRIMINAL OR CIVIL
RESPONSIBILITIES. NOTE THAT THIS LINE IS NOT LICENSE RESTRICTION BUT JUST A STATEMENT FOR WARNING AND DISCLAIMER.

READ AND UNDERSTAND THE 'src/WARNING.TXT' FILE BEFORE USING THIS SOFTWARE. SOME SOFTWARE PROGRAMS FROM THIRD PARTIES ARE INCLUDED ON THIS SOFTWARE WITH LICENSE CONDITIONS WHICH ARE DESCRIBED ON THE 'src/THIRD_PARTY.TXT' FILE.


Did you read and understand the License Agreement ?
(If you couldn't read above text, Please read 'ReadMeFirst_License.txt'
 file with any text editor.)

 1. Yes
 2. No

Please choose one of above number: 
1


Did you agree the License Agreement ?

1. Agree
2. Do Not Agree

Please choose one of above number: 
1

make[1]: Entering directory '/home/vagrant/vpnclient'
Preparing SoftEther VPN Client...
ranlib lib/libcharset.a
ranlib lib/libcrypto.a
ranlib lib/libedit.a
ranlib lib/libiconv.a
ranlib lib/libintelaes.a
ranlib lib/libncurses.a
ranlib lib/libssl.a
ranlib lib/libz.a
ranlib code/vpnclient.a
gcc code/vpnclient.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpnclient
ranlib code/vpncmd.a
gcc code/vpncmd.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpncmd

--------------------------------------------------------------------
The preparation of SoftEther VPN Client is completed !


*** How to switch the display language of the SoftEther VPN Client Service ***
SoftEther VPN Client supports the following languages:
  - Japanese
  - English
  - Simplified Chinese

You can choose your prefered language of SoftEther VPN Client at any time.
To switch the current language, open and edit the 'lang.config' file.


Note: the administrative password is not set on the VPN Server. Please set your own administrative password as soon as possible by vpncmd or the GUI manager.


*** How to start the SoftEther VPN Client Service ***

Please execute './vpnclient start' to run the SoftEther VPN Client Background Service.
And please execute './vpncmd' to run the SoftEther VPN Command-Line Utility to configure SoftEther VPN Client.

Of course, you can use the VPN Server Manager GUI Application for Windows / Mac OS X on the other Windows / Mac OS X computers in order to configure the SoftEther VPN Client remotely.

*** For Windows users ***
You can download the SoftEther VPN Server Manager for Windows
from the http://www.softether-download.com/ web site.
This manager application helps you to completely and easily manage the VPN server services running in remote hosts.


*** For Mac OS X users ***
In April 2016 we released the SoftEther VPN Server Manager for Mac OS X.
You can download it from the http://www.softether-download.com/ web site.
VPN Server Manager for Mac OS X works perfectly as same as the traditional Windows versions. It helps you to completely and easily manage the VPN server services running in remote hosts.



*** PacketiX VPN Server HTML5 Web Administration Console (NEW) ***
This VPN Server / Bridge has the built-in HTML5 Web Administration Console.

After you start the server daemon, you can open the HTML5 Web Administration Console is available at

https://127.0.0.1:5555/
or
https://ip_address_of_the_vpn_server:5555/

This HTML5 page is obviously under construction, and your HTML5 development contribution is very appreciated.

--------------------------------------------------------------------

make[1]: Leaving directory '/home/vagrant/vpnclient'
</code></pre></div></div>

<p>Movemos el fichero a /usr/local y modificamos los permisos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/usr/local/vpnclient# chmod 600 *
root@cliente-vpn:/usr/local/vpnclient# chmod 700 vpnclient
root@cliente-vpn:/usr/local/vpnclient# chmod 700 vpncmd
</code></pre></div></div>

<p>Iniciamos el cliente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/usr/local/vpnclient# ./vpnclient start
</code></pre></div></div>

<h4 id="configuración-del-cliente">Configuración del cliente</h4>

<p>Creamos un adaptador virtual:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;NicCreate R1    
NicCreate command - Create New Virtual Network Adapter
The command completed successfully.

VPN Client&gt;AccountCreate Local
AccountCreate command - Create New VPN Connection Setting
Destination VPN Server Host Name and Port Number: 192.168.1.100:443

Destination Virtual Hub Name: Empresa

Connecting User Name: sergio

Used Virtual Network Adapter Name: R1

The command completed successfully.

VPN Client&gt;AccountPasswordSet Local 
AccountPasswordSet command - Set User Authentication Type of VPN Connection Setting to Password Authentication
Please enter the password. To cancel press the Ctrl+D key.

Password: ********** #usuario-01
Confirm input: **********


Specify standard or radius: standard

The command completed successfully.
</code></pre></div></div>

<p>Conectamos el adaptador y comprobamos que se ha establecido una conexión con el servidor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;accountconnect Local
AccountConnect command - Start Connection to VPN Server using VPN Connection Setting
The command completed successfully.

VPN Client&gt;AccountStatusGet Local
AccountStatusGet command - Get Current VPN Connection Setting Status
Item                                      |Value
------------------------------------------+--------------------------------------------------------
VPN Connection Setting Name               |Local
Session Status                            |Connection Completed (Session Established)
VLAN ID                                   |-
Server Name                               |192.168.1.100
Port Number                               |TCP Port 443
Server Product Name                       |SoftEther VPN Server (64 bit)
Server Version                            |4.34
Server Build                              |Build 9745
Connection Started at                     |2021-11-28 (Sun) 14:15:59
First Session has been Established since  |2021-11-28 (Sun) 14:15:59
Current Session has been Established since|2021-11-28 (Sun) 14:15:59
Number of Established Sessions            |1 Times
Half Duplex TCP Connection Mode           |No (Full Duplex Mode)
VoIP / QoS Function                       |Enabled
Number of TCP Connections                 |2
Maximum Number of TCP Connections         |2
Encryption                                |Enabled (Algorithm: TLS_AES_256_GCM_SHA384)
Use of Compression                        |No (No Compression)
Physical Underlay Protocol                |Standard TCP/IP (IPv4)
                                          |IPv4 UDPAccel_Ver=2 ChachaPoly_OpenSSL UDPAccel_MSS=1309
UDP Acceleration is Supported             |Yes
UDP Acceleration is Active                |Yes
Session Name                              |SID-SERGIO-2
Connection Name                           |CID-12
Session Key (160 bit)                     |DD15D51435FE05B59D80B97FF4AE0BB7FDC23D8F
Bridge / Router Mode                      |No
Monitoring Mode                           |No
Outgoing Data Size                        |9,713 bytes
Incoming Data Size                        |6,618 bytes
Outgoing Unicast Packets                  |24 packets
Outgoing Unicast Total Size               |1,984 bytes
Outgoing Broadcast Packets                |8 packets
Outgoing Broadcast Total Size             |648 bytes
Incoming Unicast Packets                  |10 packets
Incoming Unicast Total Size               |860 bytes
Incoming Broadcast Packets                |0 packets
Incoming Broadcast Total Size             |0 bytes
The command completed successfully.
</code></pre></div></div>

<p>A la hora de hacer dhclient comprobamos como el servidor nos da una ip:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente-vpn:/usr/local/vpnclient# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 02:be:82:6b:cc:1d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::be:82ff:fe6b:cc1d/64 scope link 
       valid_lft forever preferred_lft forever
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:e5:01:cd brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.150/24 brd 192.168.1.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fee5:1cd/64 scope link 
       valid_lft forever preferred_lft forever
5: vpn_r1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether 5e:e3:d0:fa:69:b9 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5ce3:d0ff:fefa:69b9/64 scope link 
       valid_lft forever preferred_lft forever


root@cliente-vpn:/usr/local/vpnclient# dhclient vpn_r1
root@cliente-vpn:/usr/local/vpnclient# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 02:be:82:6b:cc:1d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::be:82ff:fe6b:cc1d/64 scope link 
       valid_lft forever preferred_lft forever
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:e5:01:cd brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.150/24 brd 192.168.1.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fee5:1cd/64 scope link 
       valid_lft forever preferred_lft forever
5: vpn_r1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UNKNOWN group default qlen 1000
    link/ether 5e:e3:d0:fa:69:b9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.30.10/24 brd 192.168.30.255 scope global vpn_r1
       valid_lft forever preferred_lft forever
    inet6 fe80::5ce3:d0ff:fefa:69b9/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre></div></div>

<p>Vemos que nos da la ip 192.168.30.10, esto se debe a que securenat por defecto da ips en el rango 30.1 (esto puede modificarse).</p>

<p>Si en nuestro servidor hacemos un dhclient al igual que en el cliente de la interfaz tap, comprobamos que al servidor la ip 192.168.30.11. Al estar ambas máquinas en la misma red de forma local esta configuración no sirve de nada, sin embargo, esto quiere decir que de forma remota ya se pueden conectar equipos sin ningún problema por lo que ahora se probará a poner Softether en práctica creando otras dos máquinas, una que configurará como cliente y otra que se configurará como puente entre el cliente2 y el servidor, de forma que cuando el cliente2 solicite una ip con dhclient, aun estando en redes distintas podrá interactuar con el cliente1 como si estuviese en la misma red.</p>

<h4 id="configuración-site-to-site">Configuración Site to Site</h4>

<p>Antes de nada accedemos por ssh al cliente2 y comprobamos que no puede acceso a las maquinas de la red1:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vagrant@cliente2-vpn:~$ ping 192.168.1.100
PING 192.168.1.100 (192.168.1.100) 56(84) bytes of data.
From 192.168.1.102 icmp_seq=1 Destination Host Unreachable
From 192.168.1.102 icmp_seq=2 Destination Host Unreachable
From 192.168.1.102 icmp_seq=3 Destination Host Unreachable

vagrant@cliente2-vpn:~$ ping 192.168.1.150
PING 192.168.1.150 (192.168.1.150) 56(84) bytes of data.
From 192.168.1.102 icmp_seq=1 Destination Host Unreachable
From 192.168.1.102 icmp_seq=2 Destination Host Unreachable
From 192.168.1.102 icmp_seq=3 Destination Host Unreachable
</code></pre></div></div>

<p>Como podemos ver, no tiene conexion ni con el servidor ni cn el cliente, a si que empezaremos a configurar el puente.</p>

<p>En el caso de la red2, haré un cambio respecto a la red1 y en este caso la máquina que hará de puente será una máquina Windows 7 en la que instalaremos Softether VPN Bridge.</p>

<p>El Bridge ya sea instalado en Windows o en Linux, es bastante sencillo de configurar puesto que al no ser el Server, esta muy limitado, basicamente lo único que debemos hacer es establer un puente local hacia nuestro cliente (cosa que se hace solo, nosotros solo debemos elegir la interfaz por la que ese puente se hace) y establecer la conexión entre el Hub único que tendremos en nuestro puente y el Hub al que queremos conectarnos en nuestro servidor.</p>

<p>Importante, el puente local es el primero que debe hacerse, una vez establecido, iniciamos el servidor, nos conectamos a el desde el puente con una conexión en cascada y cuando la conexión con el servidor se haya establecido, si todo funciona bien el cliente de la red dos deberia recibir una ip del servidor de forma que sera como si estuviesen en la misma red.</p>

<p>Al igual que con las otras maquinas empezamos actualizando el sistema:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/home/vagrant# apt update
root@puente-vpn:/home/vagrant# apt upgrade
</code></pre></div></div>

<p>Instalamos linx y los paquetes necesarios para el uso de softether:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
root@puente-vpn:/home/vagrant# apt install build-essential
</code></pre></div></div>

<p>Descomprimimos softether:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/home/vagrant# tar xzvf softether-vpnbridge-v4.34-9745-rtm-2020.04.05-linux-x64-64bit.tar.gz
vpnbridge/
vpnbridge/Makefile
vpnbridge/.install.sh
vpnbridge/ReadMeFirst_License.txt
vpnbridge/Authors.txt
vpnbridge/ReadMeFirst_Important_Notices_ja.txt
vpnbridge/ReadMeFirst_Important_Notices_en.txt
vpnbridge/ReadMeFirst_Important_Notices_cn.txt
vpnbridge/code/
vpnbridge/code/vpnbridge.a
vpnbridge/code/vpncmd.a
vpnbridge/lib/
vpnbridge/lib/libcharset.a
vpnbridge/lib/libcrypto.a
vpnbridge/lib/libedit.a
vpnbridge/lib/libiconv.a
vpnbridge/lib/libintelaes.a
vpnbridge/lib/libncurses.a
vpnbridge/lib/libssl.a
vpnbridge/lib/libz.a
vpnbridge/lib/License.txt
vpnbridge/hamcore.se2
root@puente-vpn:/home/vagrant# 
root@puente-vpn:/home/vagrant# cd vpnbridge/
root@puente-vpn:/home/vagrant/vpnbridge# make
--------------------------------------------------------------------

SoftEther VPN Bridge (Ver 4.34, Build 9745, Intel x64 / AMD64) for Linux Install Utility
Copyright (c) SoftEther Project at University of Tsukuba, Japan. All Rights Reserved.

--------------------------------------------------------------------


Do you want to read the License Agreement for this software ?

 1. Yes
 2. No

Please choose one of above number: 
1

Copyright (c) all contributors on SoftEther VPN project in GitHub.
Copyright (c) Daiyuu Nobori, SoftEther Project at University of Tsukuba, and SoftEther Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.


DISCLAIMER
==========

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

THIS SOFTWARE IS DEVELOPED IN JAPAN, AND DISTRIBUTED FROM JAPAN, UNDER JAPANESE LAWS. YOU MUST AGREE IN ADVANCE TO USE, COPY, MODIFY, MERGE, PUBLISH, DISTRIBUTE, SUBLICENSE, AND/OR SELL COPIES OF THIS SOFTWARE, THAT ANY JURIDICAL DISPUTES WHICH ARE CONCERNED TO THIS SOFTWARE OR ITS CONTENTS, AGAINST US (SOFTETHER PROJECT, SOFTETHER CORPORATION, DAIYUU NOBORI OR OTHER SUPPLIERS), OR ANY JURIDICAL DISPUTES AGAINST US WHICH ARE CAUSED BY ANY KIND OF USING, COPYING, MODIFYING, MERGING, PUBLISHING, DISTRIBUTING, SUBLICENSING, AND/OR SELLING COPIES OF THIS SOFTWARE SHALL BE REGARDED AS BE CONSTRUED AND CONTROLLED BY JAPANESE LAWS, AND YOU MUST FURTHER CONSENT TO EXCLUSIVE JURISDICTION AND VENUE IN THE COURTS SITTING IN TOKYO, JAPAN. YOU MUST WAIVE ALL DEFENSES OF LACK OF PERSONAL JURISDICTION AND FORUM NON CONVENIENS. PROCESS MAY BE SERVED ON EITHER PARTY IN THE MANNER AUTHORIZED BY APPLICABLE LAW OR COURT RULE.

USE ONLY IN JAPAN. DO NOT USE THIS SOFTWARE IN ANOTHER COUNTRY UNLESS YOU HAVE A CONFIRMATION THAT THIS SOFTWARE DOES NOT VIOLATE ANY CRIMINAL LAWS OR CIVIL RIGHTS IN THAT PARTICULAR COUNTRY. USING THIS SOFTWARE IN OTHER COUNTRIES IS COMPLETELY AT YOUR OWN RISK. THE SOFTETHER VPN PROJECT HAS DEVELOPED AND DISTRIBUTED THIS SOFTWARE TO COMPLY ONLY WITH THE JAPANESE LAWS AND EXISTING CIVIL RIGHTS INCLUDING PATENTS WHICH ARE SUBJECTS APPLY IN JAPAN. OTHER COUNTRIES' LAWS OR CIVIL RIGHTS ARE NONE OF OUR CONCERNS NOR RESPONSIBILITIES. WE HAVE NEVER INVESTIGATED ANY CRIMINAL REGULATIONS, CIVIL LAWS OR INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENTS IN ANY OF OTHER 200+ COUNTRIES AND TERRITORIES. BY NATURE, THERE ARE 200+ REGIONS IN THE WORLD, WITH DIFFERENT LAWS. IT IS IMPOSSIBLE TO VERIFY EVERY COUNTRIES' LAWS, REGULATIONS AND CIVIL RIGHTS TO MAKE THE SOFTWARE COMPLY WITH ALL COUNTRIES' LAWS BY THE PROJECT. EVEN IF YOU WILL BE SUED BY A PRIVATE ENTITY OR BE DAMAGED BY A PUBLIC SERVANT IN YOUR COUNTRY, THE DEVELOPERS OF THIS SOFTWARE WILL NEVER BE LIABLE TO RECOVER OR COMPENSATE SUCH DAMAGES, CRIMINAL OR CIVIL
RESPONSIBILITIES. NOTE THAT THIS LINE IS NOT LICENSE RESTRICTION BUT JUST A STATEMENT FOR WARNING AND DISCLAIMER.

READ AND UNDERSTAND THE 'src/WARNING.TXT' FILE BEFORE USING THIS SOFTWARE. SOME SOFTWARE PROGRAMS FROM THIRD PARTIES ARE INCLUDED ON THIS SOFTWARE WITH LICENSE CONDITIONS WHICH ARE DESCRIBED ON THE 'src/THIRD_PARTY.TXT' FILE.


Did you read and understand the License Agreement ?
(If you couldn't read above text, Please read 'ReadMeFirst_License.txt'
 file with any text editor.)

 1. Yes
 2. No

Please choose one of above number: 
1


Did you agree the License Agreement ?

1. Agree
2. Do Not Agree

Please choose one of above number: 
1

make[1]: Entering directory '/home/vagrant/vpnbridge'
Preparing SoftEther VPN Bridge...
ranlib lib/libcharset.a
ranlib lib/libcrypto.a
ranlib lib/libedit.a
ranlib lib/libiconv.a
ranlib lib/libintelaes.a
ranlib lib/libncurses.a
ranlib lib/libssl.a
ranlib lib/libz.a
ranlib code/vpnbridge.a
gcc code/vpnbridge.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpnbridge
ranlib code/vpncmd.a
gcc code/vpncmd.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpncmd
./vpncmd /tool /cmd:Check
vpncmd command - SoftEther VPN Command Line Management Utility
SoftEther VPN Command Line Management Utility (vpncmd command)
Version 4.34 Build 9745   (English)
Compiled 2020/04/05 23:39:56 by buildsan at crosswin
Copyright (c) SoftEther VPN Project. All Rights Reserved.

VPN Tools has been launched. By inputting HELP, you can view a list of the commands that can be used.

VPN Tools&gt;Check
Check command - Check whether SoftEther VPN Operation is Possible
---------------------------------------------------
SoftEther VPN Operation Environment Check Tool

Copyright (c) SoftEther VPN Project.
All Rights Reserved.

If this operation environment check tool is run on a system and that system passes, it is most likely that SoftEther VPN software can operate on that system. This check may take a while. Please wait...

Checking 'Kernel System'... 
              Pass
Checking 'Memory Operation System'... 
              Pass
Checking 'ANSI / Unicode string processing system'... 
              Pass
Checking 'File system'... 
              Pass
Checking 'Thread processing system'... 
              Pass
Checking 'Network system'... 
              Pass

All checks passed. It is most likely that SoftEther VPN Server / Bridge can operate normally on this system.

The command completed successfully.


--------------------------------------------------------------------
The preparation of SoftEther VPN Bridge is completed !


*** How to switch the display language of the SoftEther VPN Bridge Service ***
SoftEther VPN Bridge supports the following languages:
  - Japanese
  - English
  - Simplified Chinese

You can choose your prefered language of SoftEther VPN Bridge at any time.
To switch the current language, open and edit the 'lang.config' file.


Note: the administrative password is not set on the VPN Server. Please set your own administrative password as soon as possible by vpncmd or the GUI manager.


*** How to start the SoftEther VPN Bridge Service ***

Please execute './vpnbridge start' to run the SoftEther VPN Bridge Background Service.
And please execute './vpncmd' to run the SoftEther VPN Command-Line Utility to configure SoftEther VPN Bridge.

Of course, you can use the VPN Server Manager GUI Application for Windows / Mac OS X on the other Windows / Mac OS X computers in order to configure the SoftEther VPN Bridge remotely.

*** For Windows users ***
You can download the SoftEther VPN Server Manager for Windows
from the http://www.softether-download.com/ web site.
This manager application helps you to completely and easily manage the VPN server services running in remote hosts.


*** For Mac OS X users ***
In April 2016 we released the SoftEther VPN Server Manager for Mac OS X.
You can download it from the http://www.softether-download.com/ web site.
VPN Server Manager for Mac OS X works perfectly as same as the traditional Windows versions. It helps you to completely and easily manage the VPN server services running in remote hosts.



*** PacketiX VPN Server HTML5 Web Administration Console (NEW) ***
This VPN Server / Bridge has the built-in HTML5 Web Administration Console.

After you start the server daemon, you can open the HTML5 Web Administration Console is available at

https://127.0.0.1:5555/
or
https://ip_address_of_the_vpn_server:5555/

This HTML5 page is obviously under construction, and your HTML5 development contribution is very appreciated.

--------------------------------------------------------------------

make[1]: Leaving directory '/home/vagrant/vpnbridge'
</code></pre></div></div>

<p>Movemos el directorio y cambiamos los permisos como en los demás:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/home/vagrant/vpnbridge# cd ..
root@puente-vpn:/home/vagrant# mv vpnbridge/ /usr/local/
root@puente-vpn:/home/vagrant# cd /usr/local/vpnbridge/
root@puente-vpn:/usr/local/vpnbridge# chmod 600 *
root@puente-vpn:/usr/local/vpnbridge# chmod 700 vpnbridge 
root@puente-vpn:/usr/local/vpnbridge# chmod 700 vpncmd 
root@puente-vpn:/usr/local/vpnbridge# 
</code></pre></div></div>

<p>Cuando tengamos el puente instalado, lo primero sera crear una conexión de puente local entre algún cliente y el puente y por último se creará la conexión del puente al servidor. Para dicha conexión primero en el lado del servidor creamos un nuevo Hub al que se conectara el puente a traves de una conexión en cascada.</p>

<h4 id="configuración-del-cliente2">Configuración del Cliente2</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant# apt update
root@cliente2-vpn:/home/vagrant# apt upgrade
</code></pre></div></div>

<p>Instalamos softether:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant# lynx http://www.softether-download.com/files/softether/
</code></pre></div></div>

<p>Instalamos los programas necesarios:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant# apt install build-essential
</code></pre></div></div>

<p>Descomprimimos softether:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant# tar xzvf softether-vpnclient-v4.34-9745-rtm-2020.04.05-linux-x64-64bit.tar.gz
</code></pre></div></div>

<p>Compilamos softether:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant# cd vpnclient/
root@cliente2-vpn:/home/vagrant/vpnclient# make
--------------------------------------------------------------------

SoftEther VPN Client (Ver 4.34, Build 9745, Intel x64 / AMD64) for Linux Install Utility
Copyright (c) SoftEther Project at University of Tsukuba, Japan. All Rights Reserved.

--------------------------------------------------------------------


Do you want to read the License Agreement for this software ?

 1. Yes
 2. No

Please choose one of above number: 
1

Copyright (c) all contributors on SoftEther VPN project in GitHub.
Copyright (c) Daiyuu Nobori, SoftEther Project at University of Tsukuba, and SoftEther Corporation.

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.


DISCLAIMER
==========

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

THIS SOFTWARE IS DEVELOPED IN JAPAN, AND DISTRIBUTED FROM JAPAN, UNDER JAPANESE LAWS. YOU MUST AGREE IN ADVANCE TO USE, COPY, MODIFY, MERGE, PUBLISH, DISTRIBUTE, SUBLICENSE, AND/OR SELL COPIES OF THIS SOFTWARE, THAT ANY JURIDICAL DISPUTES WHICH ARE CONCERNED TO THIS SOFTWARE OR ITS CONTENTS, AGAINST US (SOFTETHER PROJECT, SOFTETHER CORPORATION, DAIYUU NOBORI OR OTHER SUPPLIERS), OR ANY JURIDICAL DISPUTES AGAINST US WHICH ARE CAUSED BY ANY KIND OF USING, COPYING, MODIFYING, MERGING, PUBLISHING, DISTRIBUTING, SUBLICENSING, AND/OR SELLING COPIES OF THIS SOFTWARE SHALL BE REGARDED AS BE CONSTRUED AND CONTROLLED BY JAPANESE LAWS, AND YOU MUST FURTHER CONSENT TO EXCLUSIVE JURISDICTION AND VENUE IN THE COURTS SITTING IN TOKYO, JAPAN. YOU MUST WAIVE ALL DEFENSES OF LACK OF PERSONAL JURISDICTION AND FORUM NON CONVENIENS. PROCESS MAY BE SERVED ON EITHER PARTY IN THE MANNER AUTHORIZED BY APPLICABLE LAW OR COURT RULE.

USE ONLY IN JAPAN. DO NOT USE THIS SOFTWARE IN ANOTHER COUNTRY UNLESS YOU HAVE A CONFIRMATION THAT THIS SOFTWARE DOES NOT VIOLATE ANY CRIMINAL LAWS OR CIVIL RIGHTS IN THAT PARTICULAR COUNTRY. USING THIS SOFTWARE IN OTHER COUNTRIES IS COMPLETELY AT YOUR OWN RISK. THE SOFTETHER VPN PROJECT HAS DEVELOPED AND DISTRIBUTED THIS SOFTWARE TO COMPLY ONLY WITH THE JAPANESE LAWS AND EXISTING CIVIL RIGHTS INCLUDING PATENTS WHICH ARE SUBJECTS APPLY IN JAPAN. OTHER COUNTRIES' LAWS OR CIVIL RIGHTS ARE NONE OF OUR CONCERNS NOR RESPONSIBILITIES. WE HAVE NEVER INVESTIGATED ANY CRIMINAL REGULATIONS, CIVIL LAWS OR INTELLECTUAL PROPERTY RIGHTS INCLUDING PATENTS IN ANY OF OTHER 200+ COUNTRIES AND TERRITORIES. BY NATURE, THERE ARE 200+ REGIONS IN THE WORLD, WITH DIFFERENT LAWS. IT IS IMPOSSIBLE TO VERIFY EVERY COUNTRIES' LAWS, REGULATIONS AND CIVIL RIGHTS TO MAKE THE SOFTWARE COMPLY WITH ALL COUNTRIES' LAWS BY THE PROJECT. EVEN IF YOU WILL BE SUED BY A PRIVATE ENTITY OR BE DAMAGED BY A PUBLIC SERVANT IN YOUR COUNTRY, THE DEVELOPERS OF THIS SOFTWARE WILL NEVER BE LIABLE TO RECOVER OR COMPENSATE SUCH DAMAGES, CRIMINAL OR CIVIL
RESPONSIBILITIES. NOTE THAT THIS LINE IS NOT LICENSE RESTRICTION BUT JUST A STATEMENT FOR WARNING AND DISCLAIMER.

READ AND UNDERSTAND THE 'src/WARNING.TXT' FILE BEFORE USING THIS SOFTWARE. SOME SOFTWARE PROGRAMS FROM THIRD PARTIES ARE INCLUDED ON THIS SOFTWARE WITH LICENSE CONDITIONS WHICH ARE DESCRIBED ON THE 'src/THIRD_PARTY.TXT' FILE.


Did you read and understand the License Agreement ?
(If you couldn't read above text, Please read 'ReadMeFirst_License.txt'
 file with any text editor.)

 1. Yes
 2. No

Please choose one of above number: 
1


Did you agree the License Agreement ?

1. Agree
2. Do Not Agree

Please choose one of above number: 
1

make[1]: Entering directory '/home/vagrant/vpnclient'
Preparing SoftEther VPN Client...
ranlib lib/libcharset.a
ranlib lib/libcrypto.a
ranlib lib/libedit.a
ranlib lib/libiconv.a
ranlib lib/libintelaes.a
ranlib lib/libncurses.a
ranlib lib/libssl.a
ranlib lib/libz.a
ranlib code/vpnclient.a
gcc code/vpnclient.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpnclient
ranlib code/vpncmd.a
gcc code/vpncmd.a -fPIE -O2 -fsigned-char -pthread -m64 -lm -lrt -lpthread -L./ lib/libssl.a lib/libcrypto.a lib/libiconv.a lib/libcharset.a lib/libedit.a lib/libncurses.a lib/libz.a lib/libintelaes.a -ldl -o vpncmd

--------------------------------------------------------------------
The preparation of SoftEther VPN Client is completed !


*** How to switch the display language of the SoftEther VPN Client Service ***
SoftEther VPN Client supports the following languages:
  - Japanese
  - English
  - Simplified Chinese

You can choose your prefered language of SoftEther VPN Client at any time.
To switch the current language, open and edit the 'lang.config' file.


Note: the administrative password is not set on the VPN Server. Please set your own administrative password as soon as possible by vpncmd or the GUI manager.


*** How to start the SoftEther VPN Client Service ***

Please execute './vpnclient start' to run the SoftEther VPN Client Background Service.
And please execute './vpncmd' to run the SoftEther VPN Command-Line Utility to configure SoftEther VPN Client.

Of course, you can use the VPN Server Manager GUI Application for Windows / Mac OS X on the other Windows / Mac OS X computers in order to configure the SoftEther VPN Client remotely.

*** For Windows users ***
You can download the SoftEther VPN Server Manager for Windows
from the http://www.softether-download.com/ web site.
This manager application helps you to completely and easily manage the VPN server services running in remote hosts.


*** For Mac OS X users ***
In April 2016 we released the SoftEther VPN Server Manager for Mac OS X.
You can download it from the http://www.softether-download.com/ web site.
VPN Server Manager for Mac OS X works perfectly as same as the traditional Windows versions. It helps you to completely and easily manage the VPN server services running in remote hosts.



*** PacketiX VPN Server HTML5 Web Administration Console (NEW) ***
This VPN Server / Bridge has the built-in HTML5 Web Administration Console.

After you start the server daemon, you can open the HTML5 Web Administration Console is available at

https://127.0.0.1:5555/
or
https://ip_address_of_the_vpn_server:5555/

This HTML5 page is obviously under construction, and your HTML5 development contribution is very appreciated.

--------------------------------------------------------------------

make[1]: Leaving directory '/home/vagrant/vpnclient'
</code></pre></div></div>

<p>Movemos el directorio y modificamos los permisos para poder usarse:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@cliente2-vpn:/home/vagrant/vpnclient# cd ..
root@cliente2-vpn:/home/vagrant# mv vpnclient/ /usr/local/
root@cliente2-vpn:/home/vagrant# cd /usr/local/vpnclient/
root@cliente2-vpn:/usr/local/vpnclient# chmod 600 *
root@cliente2-vpn:/usr/local/vpnclient# chmod 700 vpnclient
root@cliente2-vpn:/usr/local/vpnclient# chmod 700 vpncmd
</code></pre></div></div>

<p>Creamos el adaptador virtual y lo conectamos al puente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;NicCreate R2 
NicCreate command - Create New Virtual Network Adapter
The command completed successfully.

VPN Client&gt;AccountCreate Puente
AccountCreate command - Create New VPN Connection Setting
Destination VPN Server Host Name and Port Number: 172.22.10.10:443

Destination Virtual Hub Name: BRIDGE

Connecting User Name: invitado

Used Virtual Network Adapter Name: R2

The command completed successfully.
</code></pre></div></div>

<p>Le ponemos contraseña de usuario:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Client&gt;AccountPasswordSet Puente
AccountPasswordSet command - Set User Authentication Type of VPN Connection Setting to Password Authentication
Please enter the password. To cancel press the Ctrl+D key.

Password: **********
Confirm input: **********


Specify standard or radius: standard

The command completed successfully.

</code></pre></div></div>

<h4 id="configuración-para-el-puente">Configuración para el puente</h4>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/home/vagrant# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 02:be:82:6b:cc:1d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::be:82ff:fe6b:cc1d/64 scope link 
       valid_lft forever preferred_lft forever
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:bb:ac:4f brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.20/24 brd 10.10.10.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:febb:ac4f/64 scope link 
       valid_lft forever preferred_lft forever
4: enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:7e:4a:25 brd ff:ff:ff:ff:ff:ff
    inet 172.22.10.10/24 brd 172.22.10.255 scope global enp0s9
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe7e:4a25/64 scope link 
       valid_lft forever preferred_lft forever
</code></pre></div></div>

<p>Arrancamos el servicio y comprobamos el puente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/home/vagrant# ./vpnbridge start
bash: ./vpnbridge: No such file or directory
root@puente-vpn:/home/vagrant# cd /usr/local/vpnbridge/
root@puente-vpn:/usr/local/vpnbridge# ./vpnbridge start
The SoftEther VPN Bridge service has been started.

Let's get started by accessing to the following URL from your PC:

https://10.0.2.15:5555/
  or
https://10.0.2.15/

Note: IP address may vary. Specify your server's IP address.
A TLS certificate warning will appear because the server uses self signed certificate by default. That is natural. Continue with ignoring the TLS warning.

root@puente-vpn:/usr/local/vpnbridge# ./vpncmd 
vpncmd command - SoftEther VPN Command Line Management Utility
SoftEther VPN Command Line Management Utility (vpncmd command)
Version 4.34 Build 9745   (English)
Compiled 2020/04/05 23:39:56 by buildsan at crosswin
Copyright (c) SoftEther VPN Project. All Rights Reserved.

By using vpncmd program, the following can be achieved. 

1. Management of VPN Server or VPN Bridge 
2. Management of VPN Client
3. Use of VPN Tools (certificate creation and Network Traffic Speed Test Tool)

Select 1, 2 or 3: 1

Specify the host name or IP address of the computer that the destination VPN Server or VPN Bridge is operating on. 
By specifying according to the format 'host name:port number', you can also specify the port number. 
(When the port number is unspecified, 443 is used.)
If nothing is input and the Enter key is pressed, the connection will be made to the port number 8888 of localhost (this computer).
Hostname of IP Address of Destination: 

If connecting to the server by Virtual Hub Admin Mode, please input the Virtual Hub name. 
If connecting by server admin mode, please press Enter without inputting anything.
Specify Virtual Hub Name: 
Password: ************

Connection has been established with VPN Server "localhost" (port 443).

You have administrator privileges for the entire VPN Server.

VPN Server&gt;hublist
HubList command - Get List of Virtual Hubs
Item              |Value
------------------+-------------------
Virtual Hub Name  |BRIDGE
Status            |Online
Type              |Standalone
Users             |0
Groups            |0
Sessions          |1
MAC Tables        |0
IP Tables         |0
Num Logins        |0
Last Login        |2021-11-28 15:58:19
Last Communication|2021-12-04 11:57:03
Transfer Bytes    |8,067,782,709
Transfer Packets  |152,211,372
The command completed successfully.
</code></pre></div></div>

<p>Al contrario que con el servidor Softether, el puente solo puede tener un único hub bastante limitado ya que tampoco permite la creacion de usuarios.</p>

<p>Creamos la conexión en cascada con el quipo servidor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/BRIDGE&gt;cascadecreate R1     
CascadeCreate command - Create New Cascade Connection
Destination VPN Server Host Name and Port Number: 10.10.10.10:443

Destination Virtual Hub Name: Empresa

Connecting User Name: prueba

The command completed successfully.

VPN Server/BRIDGE&gt;cascadepasswordset prueba
CascadePasswordSet command - Set User Authentication Type of Cascade Connection to Password Authentication
Please enter the password. To cancel press the Ctrl+D key.

Password: ****** #prueba
Confirm input: ******

Specify standard or radius: standard

The command completed successfully.
</code></pre></div></div>

<p>Comprobamos que se ha creado correctamente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server/BRIDGE&gt;cascadelist              
CascadeList command - Get List of Cascade Connections
Item                  |Value
----------------------+-----------------
Setting Name          |R1
Status                |Offline (Stopped)
Established at        |(None)
Destination VPN Server|10.10.10.10
Virtual Hub           |
The command completed successfully.

VPN Server/BRIDGE&gt;cascadeonline R1
CascadeOnline command - Switch Cascade Connection to Online Status
The command completed successfully.

VPN Server/BRIDGE&gt;cascadelist     
CascadeList command - Get List of Cascade Connections
Item                  |Value
----------------------+-------------------------
Setting Name          |R1
Status                |Online (Established)
Established at        |2021-12-04 (Sat) 15:56:53
Destination VPN Server|10.10.10.10
Virtual Hub           |
The command completed successfully.
</code></pre></div></div>

<p>Ahora crearemos la interfaz que recibirá la ip del servidor, para ello empezamos instalando bridge-utils</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install bridge-utils
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/usr/local/vpnbridge# brctl addbr br0
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VPN Server&gt;bridgecreate BRIDGE /DEVICE:enp0s9 /TAP:yes
BridgeCreate command - Create Local Bridge Connection
While in the condition that occurs immediately after a new bridge connection is made when bridging to a physical network adapter, depending on the type of network adapter, there are cases where it will not be possible to communicate using TCP/IP to the network adapter using a bridge connection from a computer on the virtual network. 
(This phenomenon is known to occur for Intel and Broadcom network adapters.) 


If this issue arises, remedy the situation by restarting the computer on which VPN Server / Bridge is running. Normal communication will be possible after the computer has restarted. 


Also many wireless network adapters will not respond to the sending of packets in promiscuous mode and when this occurs you will be unable to use the Local Bridge. If this issue arises, try using a regular wired network adapter instead of the wireless network adapter.

Instructions for Local Bridge on VM
It has been detected that the VPN Server might be running on a VM (Virtual Machine) suchlike VMware or Hyper-V. Read the following instructions carefully. If you are not using a VM, please ignore this message.
Some VMs prohibit the "Promiscuous Mode" (MAC Address Spoofing) on the network adapters by default.

If the Promiscuous Mode (MAC Address Spoofing) is administratively disabled, the Local Bridge function between a Virtual Hub on the VPN Server and a physical network adapter on the physical computer does not work well. You should allow the Promiscuous Mode (MAC Address Spoofing) by using the configuration tool of the VM.

For details please refer the documents of your VM. If it is a shared-VM and administrated by other person, please request the administrator to permit the use of the Promiscuous (MAC Address Spoofing) Mode to your VM.

The command completed successfully.

VPN Server&gt;bridgelist
BridgeList command - Get List of Local Bridge Connection
Number|Virtual Hub Name|Network Adapter or Tap Device Name|Status
------+----------------+----------------------------------+---------
1     |Local           |172.22.10.20:443                  |Offline
2     |BRIDGE          |enp0s9                            |Operating
3     |BRIDGE          |enp0s9                            |Operating
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/usr/local/vpnbridge# brctl addif br0 tap_enp0s9
root@puente-vpn:/usr/local/vpnbridge# brctl addif br0 enp0s8
root@puente-vpn:/usr/local/vpnbridge# ip link set br0 up
</code></pre></div></div>

<p>Hacemos dhclient y comprobamos como el puente recibe ip del servidor:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root@puente-vpn:/usr/local/vpnbridge# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 02:be:82:6b:cc:1d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::be:82ff:fe6b:cc1d/64 scope link 
       valid_lft forever preferred_lft forever
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000
    link/ether 08:00:27:bb:ac:4f brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.20/24 brd 10.10.10.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:febb:ac4f/64 scope link 
       valid_lft forever preferred_lft forever
4: enp0s9: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:7e:4a:25 brd ff:ff:ff:ff:ff:ff
    inet 172.22.10.10/24 brd 172.22.10.255 scope global enp0s9
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe7e:4a25/64 scope link 
       valid_lft forever preferred_lft forever
5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 08:00:27:bb:ac:4f brd ff:ff:ff:ff:ff:ff
    inet 192.168.30.10/24 brd 192.168.30.255 scope global br0
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:febb:ac4f/64 scope link 
       valid_lft forever preferred_lft forever
6: tap_enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UNKNOWN group default qlen 1000
    link/ether 5e:a8:f3:c1:4b:78 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5ca8:f3ff:fec1:4b78/64 scope link 
       valid_lft forever preferred_lft forever
root@puente-vpn:/usr/local/vpnbridge# dhclient tap_enp0s9
^C
root@puente-vpn:/usr/local/vpnbridge# ip a
1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host 
       valid_lft forever preferred_lft forever
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 02:be:82:6b:cc:1d brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.15/24 brd 10.0.2.255 scope global enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::be:82ff:fe6b:cc1d/64 scope link 
       valid_lft forever preferred_lft forever
3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UP group default qlen 1000
    link/ether 08:00:27:bb:ac:4f brd ff:ff:ff:ff:ff:ff
    inet 10.10.10.20/24 brd 10.10.10.255 scope global enp0s8
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:febb:ac4f/64 scope link 
       valid_lft forever preferred_lft forever
4: enp0s9: &lt;BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:7e:4a:25 brd ff:ff:ff:ff:ff:ff
    inet 172.22.10.10/24 brd 172.22.10.255 scope global enp0s9
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe7e:4a25/64 scope link 
       valid_lft forever preferred_lft forever
5: br0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 08:00:27:bb:ac:4f brd ff:ff:ff:ff:ff:ff
    inet 192.168.30.10/24 brd 192.168.30.255 scope global br0
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:febb:ac4f/64 scope link 
       valid_lft forever preferred_lft forever
6: tap_enp0s9: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast master br0 state UNKNOWN group default qlen 1000
    link/ether 5e:a8:f3:c1:4b:78 brd ff:ff:ff:ff:ff:ff
    inet6 fe80::5ca8:f3ff:fec1:4b78/64 scope link 
       valid_lft forever preferred_lft forever

root@puente-vpn:/usr/local/vpnbridge# ping 192.168.30.12
PING 192.168.30.12 (192.168.30.12) 56(84) bytes of data.
64 bytes from 192.168.30.12: icmp_seq=1 ttl=64 time=1.35 ms
64 bytes from 192.168.30.12: icmp_seq=2 ttl=64 time=1.37 ms
^C
--- 192.168.30.12 ping statistics ---
2 packets transmitted, 2 received, 0% packet loss, time 1012ms
rtt min/avg/max/mdev = 1.358/1.368/1.379/0.038 ms
</code></pre></div></div>

<p>Podemos ver que el puente puede hacerle ping al cliente de la red1 sin problemas.</p>

<h4 id="dispositivos-androidios">Dispositivos Android/IOS</h4>

<p>Con respecto a los dispositivos moviles, pueden hacer muy facilmente uso de la vpn de softether. Para que esta conexion sea posible solo necesitaria una unica cosa y es tener configurada la opcion IPsec/L2TP en la maquina del servidor.</p>

<p>Una vez configurada esa opcion lo unico que hay que hacer para usar la vpn, entramos en los ajustes &gt; conexion &gt; VPN &gt; Añadir VPN.</p>

<p>Hay introducimos el nombre de la conexion, la direccion del servidor, el tipo de conexion (L2TP/IPsec PSK) y por ultimo las credenciales para poder acceder a dicha VPN.</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Seguridad" /><summary type="html"><![CDATA[SoftEther VPN es uno de los software VPN multiprotocolo más potentes y rápidos del mundo en la actualidad. Funciona en sistemas Windows, Solaris, Mac, FreeBSD y algunas distribuciones de Linux. Además de ser de software libre, también es una alternativa muy buena a openvpn y a los servidores VPN de microsoft.]]></summary></entry><entry><title type="html">Introducción a Docker</title><link href="http://localhost:4000/aplicaciones%20web/apuntes/2021/09/21/Introduccion-a-Docker.html" rel="alternate" type="text/html" title="Introducción a Docker" /><published>2021-09-21T13:14:06+02:00</published><updated>2021-09-21T13:14:06+02:00</updated><id>http://localhost:4000/aplicaciones%20web/apuntes/2021/09/21/Introduccion-a-Docker</id><content type="html" xml:base="http://localhost:4000/aplicaciones%20web/apuntes/2021/09/21/Introduccion-a-Docker.html"><![CDATA[<h3 id="qué-es-docker"><strong>¿Qué es Docker?</strong></h3>

<p>Docker es un proyecto de software libre que permite automatizar el despliegue de aplicaciones dentro de contenedores.</p>

<p>Docker nos permite de forma sencilla crear contenedores ligeros y fáciles de mover donde ejecutar nuestras aplicaciones software sobre cualquier máquina con Docker instalado, independientemente del sistema operativo que la máquina tenga, facilitando así también los despliegues.</p>

<p><strong>¿Que son los contenedores?</strong></p>

<p>Los contenedores son una forma de virtulización del sistema opertaivo, son como maquinas virtuales aisladas en los que podemos ejecutar cualquier cosa como por ejemplo microservicios, aplicaciones, etc…</p>

<p>¿En qué se diferencian los contenedores de las máquinas virtuales?
Aunque tanto los contenedores como las máquinas virtuales permiten la ejecución de aplicaciones en entornos aislados, existen diferencias clave entre ambos.</p>

<table>
  <thead>
    <tr>
      <th>Características</th>
      <th>Contenedores (docker)</th>
      <th>Máquinas Virtuales</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Aislamiento</td>
      <td>Compartido con el sistema host</td>
      <td>Completamente aislado</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Consumo de recursos</td>
      <td>Bajo (solo usa lo necesario)</td>
      <td>Alto (requiere SO completo)</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Velocidad</td>
      <td>Muy rápido (milisegundos)</td>
      <td>Lento (segundos/minutos)</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Tamaño</td>
      <td>Ligero (MB)</td>
      <td>Pesado (GB)</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Arranque</td>
      <td>Inmediato</td>
      <td>Lento</td>
    </tr>
  </tbody>
  <tbody>
    <tr>
      <td>Uso de CPU/RAM</td>
      <td>Optimizado, solo lo necesario</td>
      <td>Consume más recursos</td>
    </tr>
  </tbody>
</table>

<h3 id="caracteristicas-de-docker"><strong>Caracteristicas de Docker</strong></h3>

<ul>
  <li>
    <p><strong>Portabilidad</strong>: El contenedor Docker podremos desplegarlo en cualquier otro sistema siempre y cuando soporte esta tecnología, con lo que nos ahorraremos el tener que instalar en este nuevo entorno todas aquellas aplicaciones que normalmente usemos.</p>
  </li>
  <li>
    <p><strong>Ligereza</strong>: Los sistemas virtualizados con Docker suelen pesar mucho menos que usando otros medios como pueden ser maquinas virtuales.</p>
  </li>
  <li>
    <p><strong>Autosuficiencia</strong>: Un contenedor Docker no contiene todo un sistema completo, sino únicamente aquellas librerías, archivos y configuraciones necesarias para desplegar las funcionalidades que contenga. Asimismo, Docker se encarga de la gestión del contenedor y de las aplicaciones que contenga.</p>
  </li>
  <li>
    <p><strong>Seguridad</strong>: Es seguro haciendo uso de namespaces y cgroups, los recursos están aislados.</p>
  </li>
  <li>
    <p><strong>Uso de imágenes</strong>: Una imagen Docker podríamos entenderla como un Sistema Operativo con aplicaciones instaladas. A partir de una imagen se puede crear un contenedor. Las imágenes de docker son portables entre diferentes plataformas, el único requisito es que en el sistema huésped esté disponible docker.</p>
  </li>
</ul>

<h3 id="instalación-de-docker-debian-buster"><strong>Instalación de Docker (Debian Buster)</strong></h3>

<ol>
  <li>Empezamos actualizando la paqueteria:</li>
</ol>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash"> sudo apt-get update </code>
</pre>
</div>

<ol>
  <li>Instalamos los siguientes paquetes para el uso de docker:</li>
</ol>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sudo apt-get install \
    apt-transport-https \
    ca-certificates \
    curl \
    gnupg \
    lsb-release
</code>
</pre>
</div>

<ol>
  <li>Añadimos la clave gpg a nuestro repositorio (en este caso repositorios de debian):</li>
</ol>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg
</code>
</pre>
</div>

<ol>
  <li>Configuramos el repositorio estable de docker:</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo \
  "deb [arch=amd64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \
  $(lsb_release -cs) stable" | sudo tee /etc/apt/sources.list.d/docker.list &gt; /dev/null
</code></pre></div></div>

<ol>
  <li>Instalamos Docker:</li>
</ol>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sudo apt-get update
sudo apt-get install docker-ce docker-ce-cli containerd.io
</code>
</pre>
</div>

<p>Si lo que queremos es usar docker sin sudo, ejecutaremos el siguiente comando:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sudo usermod -aG docker $USER
</code>
</pre>
</div>

<h3 id="comandos-utiles-de-docker"><strong>Comandos utiles de docker</strong></h3>

<ul>
  <li>Ejecutar un contenedor a partir de una imagen:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker run "nombre de la imagen"
</code>
</pre>
</div>

<p>Podemos obtener varias imágenes de docker en la sigiente pagina <a href="https://hub.docker.com/">Dockerhub</a>. En el caso de que una imagen tenga varias versiones podemos ejecutar la version deseada de la siguiente forma:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker run "nombre de la imagen":"version"
</code>
</pre>
</div>

<p>En el caso de no indicar la version, por defecto se ejecutara la ultima version que exista de la imagen.</p>

<ul>
  <li>Ejecutar un contenedor en background o segundo plano:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker run -d "nombre de la imagen"
</code>
</pre>
</div>

<ul>
  <li>Descargar imágenes docker:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker pull "nombre de la imagen"
</code>
</pre>
</div>

<p>Aunque este comando no es del todo necesario ya que si la imagen que queremos ejecutar no la tenemos, al ejecutar docker run se descarga de forma automatica siempre y cuando exista la imagen que queremos. Este comando se usa sobre todo en el caso de querer descargar imágenes sin que se ejecuten automticamente.</p>

<ul>
  <li>Comprobar las imágenes que tenemos en nuestra maquina:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker images
</code>
</pre>
</div>

<p>Ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~$ docker images
REPOSITORY                 TAG                 IMAGE ID            CREATED             SIZE
sergioib94/drupal          v1                  ffabd2bb2653        6 months ago        334MB
sergioib94/bookmedik-php   v1                  5b857f8a175a        6 months ago        436MB
mysql                      5.6                 0abf1c71efa3        6 months ago        303MB
sergioib94/bookmedik2      v1                  5dd61ff34e91        6 months ago        435MB
sergioib94/bookmedik       v1                  3d1d3ed847f8        6 months ago        249MB
sergioib94/bookmedik       &lt;none&gt;              df7505c5a0ba        6 months ago        251MB
mariadb                    latest              70e69b4a7bda        7 months ago        401MB
joomla                     latest              6014b57fda53        7 months ago        458MB
php                        7.4-apache          83db90327db8        7 months ago        414MB
debian                     latest              5890f8ba95f6        7 months ago        114MB
php                        7.4.3-apache        d753d5b380a1        7 months ago        414MB
</code></pre></div></div>

<p>En mi caso estas son las imágenes que tengo en mi equipo, algunas usadas en otras practicas y ejemplos y otras descargadas y modificadas por mi.</p>

<p>Cada imagen cuenta con una ID unica que podremos usar posteriormente para eliminar las imágenes.</p>

<ul>
  <li>Mostrar contenedores que se estan ejecutando:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker ps
</code>
</pre>
</div>

<p>A este comando le podemos añadir la opción -a si lo que queremos es mostrar todos los contenedores que en algun momento se han ejecutado.</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker ps
CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                          PORTS                     NAMES
83deaf076a51        joomla                        "/entrypoint.sh apac…"   6 months ago        Up 2 hours                      0.0.0.0:8080-&gt;80/tcp      deploy_joomla_1
530ef214963a        mysql:5.6                     "docker-entrypoint.s…"   6 months ago        Up 2 hours                      0.0.0.0:32768-&gt;3306/tcp   deploy_joomladb_1
220f6974c26f        mysql:5.6                     "docker-entrypoint.s…"   6 months ago        Restarting (1) 31 seconds ago                             deploy_db_1
b18afffe8d15        sergioib94/drupal:v1          "/usr/sbin/apache2ct…"   6 months ago        Up 2 hours                      0.0.0.0:8083-&gt;80/tcp      drupal
28dc5d493419        sergioib94/bookmedik-php:v1   "docker-php-entrypoi…"   6 months ago        Up 2 hours                      0.0.0.0:8081-&gt;80/tcp      bookmedik-php

sergioib@debian-sergio:~$ docker ps -a
CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                         PORTS                     NAMES
83deaf076a51        joomla                        "/entrypoint.sh apac…"   6 months ago        Up 2 hours                     0.0.0.0:8080-&gt;80/tcp      deploy_joomla_1
530ef214963a        mysql:5.6                     "docker-entrypoint.s…"   6 months ago        Up 2 hours                     0.0.0.0:32768-&gt;3306/tcp   deploy_joomladb_1
220f6974c26f        mysql:5.6                     "docker-entrypoint.s…"   6 months ago        Restarting (1) 6 seconds ago                             deploy_db_1
b18afffe8d15        sergioib94/drupal:v1          "/usr/sbin/apache2ct…"   6 months ago        Up 2 hours                     0.0.0.0:8083-&gt;80/tcp      drupal
631dc24356c6        5890f8ba95f6                  "/bin/sh -c 'apt-get…"   6 months ago        Exited (100) 6 months ago                                mystifying_visvesvaraya
28dc5d493419        sergioib94/bookmedik-php:v1   "docker-php-entrypoi…"   6 months ago        Up 2 hours                     0.0.0.0:8081-&gt;80/tcp      bookmedik-php
</code>
</pre>
</div>

<ul>
  <li>Reiniciar un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker start "ID del contenedor"
</code>
</pre>
</div>

<ul>
  <li>Mostrar logs de un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker logs "ID del contenedor" o bien docker logs "nombre del contenedor"
</code>
</pre>
</div>

<ul>
  <li>Ejecutar comandos dentro de un contenedor que se este ejecutando:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker exec "ID del contenedor"
</code>
</pre>
</div>

<p>Con este comando podemos usar las opciones -i para crear una sesion interactiva y -t emulara una terminal. Por ejemplo:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker exec -it 83deaf076a51 sh
# ls
LICENSE.txt  administrator  cache  components	      htaccess.txt  includes   language  libraries  modules  robots.txt  tmp
README.txt   bin	    cli    configuration.php  images	    index.php  layouts	 media	    plugins  templates	 web.config.txt
# 
</code>
</pre>
</div>

<p>En este caso por ejemplo abrimos una terminal sh para poder ejecutar comandos en el contenedor que en este caso es un contenedor joomla y probamos la ejecucion de ls.</p>

<ul>
  <li>Parar uno o varios contenedores:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker stop "ID del contenedor"
</code>
</pre>
</div>

<p>En el caso de querer parar varios contenedores simplemente se ponen las ID de los contenedores separadas por espacios una tras otra.</p>

<ul>
  <li>Conectarse al contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker attach "ID contenedor"
</code>
</pre>
</div>

<ul>
  <li>Mostrar las caracteristicas del contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker inspect "ID del conetedor"
</code>
</pre>
</div>

<p>Ejemplo:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker inspect b18afffe8d15
[
    {
        "Id": "b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec",
        "Created": "2021-03-03T15:57:19.599943415Z",
        "Path": "/usr/sbin/apache2ctl",
        "Args": [
            "-D",
            "FOREGROUND"
        ],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 1976,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2021-09-23T08:46:42.423040032Z",
            "FinishedAt": "2021-09-22T14:27:05.965384671Z"
        },
        "Image": "sha256:ffabd2bb26538aa1861095857117a51d13cae77cc89e9736cd69ddd006409803",
        "ResolvConfPath": "/var/lib/docker/containers/b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec/resolv.conf",
        "HostnamePath": "/var/lib/docker/containers/b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec/hostname",
        "HostsPath": "/var/lib/docker/containers/b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec/hosts",
        "LogPath": "/var/lib/docker/containers/b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec/b18afffe8d155d67e3992d10c4336a78c90afcadba4fbddc6f7379d66ca5ceec-json.log",
        "Name": "/drupal",
        "RestartCount": 0,
        "Driver": "overlay2",
        "Platform": "linux",
        "MountLabel": "",
        "ProcessLabel": "",
        "AppArmorProfile": "docker-default",
        "ExecIDs": null,
        "HostConfig": {
            "Binds": [
                "/home/sergio/Escritorio/Informatica/Github/docker-bookmedik/Tarea4/vol-app:/var/log/apache2:rw"
            ],
            "ContainerIDFile": "",
            "LogConfig": {
                "Type": "json-file",
                "Config": {}
            },
            "NetworkMode": "deploy_default",
            "PortBindings": {
                "80/tcp": [
                    {
                        "HostIp": "",
                        "HostPort": "8083"
                    }
                ]
            },
            "RestartPolicy": {
                "Name": "always",
                "MaximumRetryCount": 0
            },
            "AutoRemove": false,
            "VolumeDriver": "",
            "VolumesFrom": [],
            "CapAdd": null,
            "CapDrop": null,
            "Dns": [],
            "DnsOptions": [],
            "DnsSearch": [],
            "ExtraHosts": null,
            "GroupAdd": null,
            "IpcMode": "shareable",
            "Cgroup": "",
            "Links": null,
            "OomScoreAdj": 0,
            "PidMode": "",
            "Privileged": false,
            "PublishAllPorts": false,
            "ReadonlyRootfs": false,
            "SecurityOpt": null,
            "UTSMode": "",
            "UsernsMode": "",
            "ShmSize": 67108864,
            "Runtime": "runc",
            "ConsoleSize": [
                0,
                0
            ],
            "Isolation": "",
            "CpuShares": 0,
            "Memory": 0,
            "NanoCpus": 0,
            "CgroupParent": "",
            "BlkioWeight": 0,
            "BlkioWeightDevice": null,
            "BlkioDeviceReadBps": null,
            "BlkioDeviceWriteBps": null,
            "BlkioDeviceReadIOps": null,
            "BlkioDeviceWriteIOps": null,
            "CpuPeriod": 0,
            "CpuQuota": 0,
            "CpuRealtimePeriod": 0,
            "CpuRealtimeRuntime": 0,
            "CpusetCpus": "",
            "CpusetMems": "",
            "Devices": null,
            "DeviceCgroupRules": null,
            "DiskQuota": 0,
            "KernelMemory": 0,
            "MemoryReservation": 0,
            "MemorySwap": 0,
            "MemorySwappiness": null,
            "OomKillDisable": false,
            "PidsLimit": 0,
            "Ulimits": null,
            "CpuCount": 0,
            "CpuPercent": 0,
            "IOMaximumIOps": 0,
            "IOMaximumBandwidth": 0,
            "MaskedPaths": [
                "/proc/asound",
                "/proc/acpi",
                "/proc/kcore",
                "/proc/keys",
                "/proc/latency_stats",
                "/proc/timer_list",
                "/proc/timer_stats",
                "/proc/sched_debug",
                "/proc/scsi",
                "/sys/firmware"
            ],
            "ReadonlyPaths": [
                "/proc/bus",
                "/proc/fs",
                "/proc/irq",
                "/proc/sys",
                "/proc/sysrq-trigger"
            ]
        },
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/99132561004d96471fbd8c8bf78bcdd3edb404b60bb6a56b7bd7b5210642cf9a-init/diff:/var/lib/docker/overlay2/8c19cff03760c3f3538225d3dda65f1417b24d7bf36620df33a0b82397ae0bdc/diff:/var/lib/docker/overlay2/59b79af32079cb6f562e43f6a2942e683371fedf54ab563b2d02a900328286a3/diff:/var/lib/docker/overlay2/7120a8197d4c96b9f28c9920a6efd08ef521c63dc59853c0b54d04cc147c2824/diff:/var/lib/docker/overlay2/8fd883ebf1a0ff23f7569944810d7e1442a78af7305c2ab7c5d7a94df2dfdba3/diff",
                "MergedDir": "/var/lib/docker/overlay2/99132561004d96471fbd8c8bf78bcdd3edb404b60bb6a56b7bd7b5210642cf9a/merged",
                "UpperDir": "/var/lib/docker/overlay2/99132561004d96471fbd8c8bf78bcdd3edb404b60bb6a56b7bd7b5210642cf9a/diff",
                "WorkDir": "/var/lib/docker/overlay2/99132561004d96471fbd8c8bf78bcdd3edb404b60bb6a56b7bd7b5210642cf9a/work"
            },
            "Name": "overlay2"
        },
        "Mounts": [
            {
                "Type": "bind",
                "Source": "/home/sergio/Escritorio/Informatica/Github/docker-bookmedik/Tarea4/vol-app",
                "Destination": "/var/log/apache2",
                "Mode": "rw",
                "RW": true,
                "Propagation": "rprivate"
            }
        ],
        "Config": {
            "Hostname": "b18afffe8d15",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "ExposedPorts": {
                "80/tcp": {}
            },
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin"
            ],
            "Cmd": [
                "/usr/sbin/apache2ctl",
                "-D",
                "FOREGROUND"
            ],
            "ArgsEscaped": true,
            "Image": "sergioib94/drupal:v1",
            "Volumes": {
                "/var/log/apache2": {}
            },
            "WorkingDir": "",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": {
                "com.docker.compose.config-hash": "bdc0b1a85207601bcc1fd0c585c01d9686d3d4f0ff6fd4db65d59399d6b782eb",
                "com.docker.compose.container-number": "1",
                "com.docker.compose.oneoff": "False",
                "com.docker.compose.project": "deploy",
                "com.docker.compose.service": "drupal",
                "com.docker.compose.version": "1.21.0"
            }
        },
        "NetworkSettings": {
            "Bridge": "",
            "SandboxID": "ed755bb08c99f9185c07790e7a3d1c57a3d36fbb3424b680c0e6985ab6173f2c",
            "HairpinMode": false,
            "LinkLocalIPv6Address": "",
            "LinkLocalIPv6PrefixLen": 0,
            "Ports": {
                "80/tcp": [
                    {
                        "HostIp": "0.0.0.0",
                        "HostPort": "8083"
                    }
                ]
            },
            "SandboxKey": "/var/run/docker/netns/ed755bb08c99",
            "SecondaryIPAddresses": null,
            "SecondaryIPv6Addresses": null,
            "EndpointID": "",
            "Gateway": "",
            "GlobalIPv6Address": "",
            "GlobalIPv6PrefixLen": 0,
            "IPAddress": "",
            "IPPrefixLen": 0,
            "IPv6Gateway": "",
            "MacAddress": "",
            "Networks": {
                "deploy_default": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": [
                        "drupal",
                        "b18afffe8d15"
                    ],
                    "NetworkID": "2d13f9ba198280146426de0bc4704bd911c6a593640187644d83bda98cf8daab",
                    "EndpointID": "df8047a7c43eab47ea408f970c982eb6c86e743897d3c4328a013cc7415a4785",
                    "Gateway": "172.21.0.1",
                    "IPAddress": "172.21.0.4",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:15:00:04",
                    "DriverOpts": null
                }
            }
        }
    }
]
</code>
</pre>
</div>

<p>En este caso vemos la informacion relacionada con un contenedor que aloja Drupal. Aqui podemos encontrar varia informacion como:</p>

<ul>
  <li>El id del contenedor.</li>
  <li>Los puertos abiertos y sus redirecciones</li>
  <li>Los bind mounts y volúmenes usados.</li>
  <li>El tamaño del contenedor</li>
  <li>La configuración de red del contenedor.</li>
  <li>El ENTRYPOINT que es lo que se ejecuta al hacer docker run.</li>
  <li>El valor de las variables de entorno.</li>
  <li>
    <p>Y muchas más cosas….</p>
  </li>
  <li>Destruir o “matar” un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker kill "ID controlador"
</code>
</pre>
</div>

<ul>
  <li>Pausar/reanudar un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker pause "ID controlador" / docker unpause "ID controlador"
</code>
</pre>
</div>

<ul>
  <li>Ver o establecer un puerto para un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker port "numero de puerto" "ID contenedor"
</code>
</pre>
</div>

<p>A la hora de establecer el puerto de un contenedor tambien podemos hacerlo usando la opcion -p:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker -p "nuemro de puerto" "ID contenedor"
</code>
</pre>
</div>

<ul>
  <li>Renombrar un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker renamo "ID contenedor"
</code>
</pre>
</div>

<ul>
  <li>Eliminar todos los contenedores:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker rm -f $(docker ps -a -q)
</code>
</pre>
</div>

<ul>
  <li>Comprobar la version de docker:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker --version
</code>
</pre>
</div>

<p>Ejemplo:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker --version
Docker version 18.09.1, build 4c52b90
</code>
</pre>
</div>

<p>En mi caso la version esta un poco desactualizada ya que actualmente si no me equivoco la version actual es la 20.10.</p>

<h3 id="creación-de-imágenes"><strong>Creación de imágenes</strong></h3>

<h4 id="modificando-una-imagen"><strong>Modificando una imagen</strong></h4>

<p>Con Docker tenemos la posibilidad de crear una imagen personalizada a partir de una imagen ya existente modificando el contenedor de la siguiente forma:</p>

<ol>
  <li>Arrancamos un contenedor artiendo de una imagen como base:</li>
  <li>Realizamos algun tipo de modificacion:</li>
  <li>Usamos el comando docker commit para crear una imagen que contenga la imagen base usasda + las modificaciones añadidas:</li>
</ol>

<p>En el caso de que queramos añadir nuestra imagen personalizada en docker hub ejecutamos los siguientes comandos:</p>

<ol>
  <li>
    <p>Nos logueamos en docker hub ejecutando el comando docker logine introduciendo nuestro usuario y contraseña.</p>
  </li>
  <li>
    <p>Una vez logueados ejecutamos docker push subiendo nuestra imagen a docker hub.</p>
  </li>
</ol>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker ps
CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS                          PORTS                     NAMES
b18afffe8d15        sergioib94/drupal:v1          "/usr/sbin/apache2ct…"   6 months ago        Up 3 hours                      0.0.0.0:8083-&gt;80/tcp      drupal
</code>
</pre>
</div>

<p>En mi caso por ejemplo cuento con una imagen modificada por mi de un contenedor que cuenta con un drupal, en este caso si quiero subir este drupal mio a docker hub tendria que loguarme con docker login y una vez logueado subir la imagen con docker push:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker push sergioib94/drupal:v1
</code>
</pre>
</div>

<p>De esta forma cualquier usuario de docker hub puede descargarse nuestra imagen y trabajar con ella ejecutando un docker pull.</p>

<h4 id="haciendo-uso-de-un-fichero-dockerfile"><strong>Haciendo uso de un fichero dockerfile</strong></h4>

<p>Esta que hemos visto es una forma de crear una imagen personalizada en docker, pero lo abitual es crearla haciendo uso de un fichero dockerfile.</p>

<p>¿Que es un fichero dockerfile? este es un fichero de texto plano que contiene una serie de instrucciones, necesarias para crear una imagen que posteriormente, se convertirá en una aplicacion.</p>

<p>Unos ejemplos sobre el uso de dockerfile los podemos encontrar en el post <a href="https://sergioib.netlify.app/posts/aplicaciones-web-php-en-docker/">aplicaciones web php en docker</a> en el que a traves de unos ejercicios hacemos uso de una imagen de la aplicacion bookmedic y la personalizamos.</p>

<p>La estructura de los dockerfile será la siguiente:</p>

<ul>
  <li>
    <p>En los ficheros dockerfile la primera linea que indicaremos será un <strong>FROM</strong> indicando la imagen “padre” o imagen base que va a usarse.</p>
  </li>
  <li>
    <p>La linea de <strong>WORKDIR</strong>, en el que se va a declarar en que directorio se va a realizar todo el trabajo, en el caso de que no exista el directorio, se creara de forma automática.</p>
  </li>
  <li>
    <p>En el caso necesario podemos tener tambien una linea <strong>COPY</strong> con la linea copy podremos copiar los ficheros del directorio donde esta nuestro dockerfile al directorio de trabajo de nuestro contenedor indicado en la linea workdir.</p>
  </li>
  <li>
    <p>Podemos hacer uso tambien de RUN en nuestro dockerfile para que se ejecuten los comandos indocados una vez se cree el contenedor.</p>
  </li>
  <li>
    <p>Todos los dockerfile deben acabar con una linea <strong>CMD</strong>, indicando los comandos o scripts que se van a ejecutar.</p>
  </li>
</ul>

<p>Ejemplo:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
# Imágen base de PHP con docker
FROM php:7.4-apache

# Variables de entorno
ENV MARIADB_USER admin
ENV MARIADB_PASS admin
ENV MARIADB_HOST servidor_mysql2

# Instalación de paquetes necesarios
RUN apt-get update
RUN docker-php-ext-install pdo pdo_mysql mysqli json
RUN a2enmod rewrite

# Exponer puerto 80
EXPOSE 80

# Habilitar módulos de Apache
WORKDIR /var/www/html

# Copiar archivos de la aplicación
COPY bookmedik/ /var/www/html

ADD script.sh /usr/local/bin/script.sh

RUN chmod +x /usr/local/bin/script.sh

# Comando que ejecutará el contenedor
CMD ["script.sh"]
</code>
</pre>
</div>

<p>En este ejemplo usamos una imagen base de php version 7.4 con apache. Se han creado tres variables, mariadb_user, mariadb_pass y mariadb_host de forma que el mysql que tendremos en nuestro contenedor reciva las varioables a traves del script indicado al final del dockerfile.</p>

<p>Una vez creado el contenedor se ejecutaran los comandos indicados con run, es decir que el contenedor de actualizara, se descargaran varios paquetes y se habilitara el modulo rewrite de apache.</p>

<p>Como nuestro contenedor tendra un apache y php, se abrira el puerto 80 para que haga uso de el apache usando para ello la linea <strong>EXPOSE</strong>.</p>

<p>El directorio de trabajo indicado será /var/www/html y copiaremos en ese directorio los ficheros de nuestro directorio bookmedik (una aplicacion web que hace de agenda).</p>

<p>añdimos s nuestro contenedor el script indicado usando <strong>ADD</strong> en la ubicacion necesaria y jecutamos otro RUN para darle permisos de ejecucion a al script y que de esa forma mysql reciba los datos necesario y al ejecutar apache se pueda usar la aplicacion web de bookmedik</p>

<p>El contenido de nuestro script.sh será el siguiente:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
#!/bin/bash
sed -i "s/$this-&gt;user=\"root\";/$this-&gt;user=\"$MARIADB_USER\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;pass=\"\";/$this-&gt;pass=\"$MARIADB_PASS\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;host=\"localhost\";/$this-&gt;host=\"$MARIADB_HOST\";/g" /var/www/html/core/controller/Database.php
</code>
</pre>
</div>

<p>Después para construir el contenedor, ejecutamos docker build -t “nombre de la imagen”</p>

<h3 id="redes-en-docker"><strong>Redes en Docker</strong></h3>

<p>A los contenedores que creemos, tenemos la posibilidad de añadirlos a una red haciendo uso de los siguientes comandos:</p>

<ul>
  <li>Conectar/desconectar una red de un contenedor:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker network connect/disconnect "ID red"
</code>
</pre>
</div>

<ul>
  <li>Crear una nueva red:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker network create
</code>
</pre>
</div>

<ul>
  <li>Mostrar informacion de una red:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker network inspect "ID red"
</code>
</pre>
</div>

<ul>
  <li>Mostrar todas las redes docker</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker network ls
</code>
</pre>
</div>

<ul>
  <li>Eliminar red:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker network rm
</code>
</pre>
</div>

<p>Por defecto al instalar docker se crean automaticamente tres redes, bridge, none y host:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~$ docker network ls
NETWORK ID          NAME                DRIVER              SCOPE
1857a84cc7c7        bridge              bridge              local
daeb4ba11558        host                host                local
98f5e7fa91c2        none                null                local
</code>
</pre>
</div>

<ul>
  <li>
    <p>Red bridge: Es la red a la que se conectan los contenedores por defecto (con direccionamiento 172.17.0.0/16). Esta red corresponde a la interfaz docker0 en nuestra maquina fisica, esta interfaz hace de puerta de enlace de los contenedores.</p>

    <ul>
      <li>
        <p>Con esta red podremos aislar los distintos contenedores en distintas subredes docker, de tal manera que desde cada una de las subredes solo podremos acceder a los equipos de esa misma subred.</p>
      </li>
      <li>
        <p>Aislar los contenedores del acceso exterior.</p>
      </li>
      <li>
        <p>Publicar servicios que tengamos en los contenedores mediante redirecciones que docker implementará con las reglas de iptables.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Si conectamos un contenedor a la red host, el contenedor estaría en la misma red que el host (por lo tanto toma direccionamiento del servidor DHCP de nuestra red). Además los puertos son accesibles directamente desde el host.</p>
  </li>
  <li>
    <p>La red none no configurará ninguna IP para el contenedor y no tiene acceso a la red externa ni a otros contenedores. Tiene la dirección loopback y se puede usar para ejecutar trabajos por lotes.</p>
  </li>
</ul>

<h3 id="almacenamiento-en-docker"><strong>Almacenamiento en Docker</strong></h3>

<p>La información de los contenedores que ejecutamos es efimera, lo que quiere decir que una vez cerramos sesión, toda la informacion se pierde por lo que necesitaremos crear volumenes si queremos que dicha informacion permanezca. Estos volumenes son simplemente directorios que se crean en nuestro sistema de ficheros para que docker pueda almacenar la información.</p>

<p>Para mantener la informacion de los contenedores tendremos varias opciones:</p>

<ul>
  <li>Volumenes docker</li>
  <li>Bind mounts</li>
</ul>

<h4 id="volumenes-docker"><strong>Volumenes docker</strong></h4>

<p>Para gestionar los volumenes docker podemos ejecutar los siguientes comandos:</p>

<ul>
  <li>Creacion de volumenes:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker volume create "nombre del volumen"
</code>
</pre>
</div>

<ul>
  <li>Eliminacion de volumenes:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker volume rm "nombre del volumen"
</code>
</pre>
</div>

<ul>
  <li>Mostrar volumenes que tenemos creados:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker volume ls
</code>
</pre>
</div>

<ul>
  <li>Eliminacion de volumenes que no se estan usando:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker volume prune
</code>
</pre>
</div>

<ul>
  <li>Mostrar detalles sobre los volumenes:</li>
</ul>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
docker volume inspect "nombre del volumen"
</code>
</pre>
</div>

<p>Como ejemplo se va a crear un contenedor con una imagen base de debian haciendo uso de la opción -v para así indicar la ubicación de nuestro volumen creado.</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
#Creamos primero un volumen que usaremos de prueba.

sergioib@debian-sergio:~$ docker volume create prueba
prueba

#Ejecutamos el contenedor indicando tanto el nombre del contenedor, donde se ubicara el volumen y la imagen a usar.

sergioib@debian-sergio:~$ docker run -d --name debian-prueba -v prueba:/usr/share/prueba debian
905c1a3bac1bdce990d459aa9668e90d55135fc29f080a2056286c66b4a2c037

#Comprobamos que se ha creado.

sergioib@debian-sergio:~$ docker ps -a
CONTAINER ID        IMAGE                         COMMAND                  CREATED              STATUS                          PORTS                     NAMES                          prueba-mdb
905c1a3bac1b        debian                        "bash"                   3 minutes ago        UP 3 minutes ago                                  debian-prueba
</code>
</pre>
</div>

<h4 id="bind-mounts"><strong>Bind mounts</strong></h4>

<p>Con el método bind mount hacemos la información persistente y estará gestionada por nosotros mismos, a diferencia de los volúmenes Docker que requieren permisos. Este sistema es muy parecido ya que se trata de montar una parte del sistema de ficheros en el contenedor.</p>

<p>Para poner en practica este método, empezaremos creando un directorio donde se alojara nuestra información. Este volumen se usara más adelante como ejemplo a la hora de usar docker compose, en este caso se ha creado el directorio en la siguiente ruta “docker-bookmedik/Tarea4/”.</p>

<h3 id="docker-compose"><strong>Docker Compose</strong></h3>

<p>Docker-Compose es una herramienta soluciona el problema de tener que repetir cada comando al levantar nuestro contenedores, ya que parte de un fichero YML en el que estan indicados todos los elementos que necesita Docker para montar nuestros escenarios de multicontenedor. Es importante el orden en el que se escriben los parámetros.</p>

<p>Para hacer uso de docker compose, lo primero será instalarlo:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
# Añadimos la clave GPG
curl -fsSL https://download.docker.com/linux/debian/gpg | sudo apt-key add -

# Buscamos el paquete 
sudo apt-cache policy docker-compose

# Lo instalamos
sudo apt-get install docker-compose
</code>
</pre>
</div>

<p>Ejemplo de uso:</p>

<p>Vamos ha hacer una prueba de instalación, instalando como ejemplo un contenedor docker con drupal que use una base de datos mysql.</p>

<p>Para ello crearemos una carpeta deply donde guardaremos nuestro docker compose, a diferencia de con dockerfile que lo guardabamos todo lo relacionado con la instalacion del contenedor en un directorio buil (no es necesaria esta distincion entre directorio build y directorio deploy, es solo para que se entienda mejor).</p>

<p>Nuestro fichero docker compose será el siguiente:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
version: "3.1"

services:
  db:
    container_name: servidor_mysql_drupal
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: drupal
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: drupal_admin
    volumes:
      - /home/sergio/Escritorio/Informatica/Github/docker-bookmedik/Tarea4/vol-maria:/var/lib/mysql

  drupal:
    container_name: drupal
    image: sergioib94/drupal:v1
    restart: always
    ports:
      - 8083:80
    volumes:
      - /home/sergio/Escritorio/Informatica/Github/docker-bookmedik/Tarea4/vol-app:/var/log/apache2
</code>
</pre>
</div>

<p>En este ejemplo estamos creando dos contenedores, uno al que llamamos db que alojara la base de datos de mariadb y otro contenedor en el que se desplegará drupal.</p>

<p>En el contenedor de mariadb, indicamos tanto la imagen que se usará, así como las variables de entorno necesarias para que dicha base de datos funcione correctamente (nombre de la base de datos, usuario, contraseña, contraseña de administrador) y querer que permanezcan persistentes los datos de nuestra base de datos, creamos un volumen persistente haciendo uso de bind mount.</p>

<p>Por otro lado al contenedor de drupal solo será necesario indicar la imagen que en este caso es una imagen drupal configurada por mi ya que la configuración por defecto daba error a la hora de instarse, indicamos los puertos a usar (en mi caso el puerto 8083 ya que los puertos 82, 81 y 80 los tengo ocupados con otros contenedores).</p>

<p>Desplegamos el docker compose ejecutando el siguiente comando en el directorio donde este el fichero:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
sergioib@debian-sergio:~/Escritorio/Informatica/Github/docker-bookmedik/Tarea4/deploy$ docker-compose up -d
Creating servidor_mysql_drupal ... done
Creating drupal                ... done

sergioib@debian-sergio:~$ docker ps
CONTAINER ID        IMAGE                         COMMAND                  CREATED             STATUS              PORTS                     NAMES
205d30bcee2f        mariadb                       "docker-entrypoint.s…"   10 minutes ago      Up About a minute   3306/tcp                  servidor_mysql_drupal
b18afffe8d15        sergioib94/drupal:v1          "/usr/sbin/apache2ct…"   7 months ago        Up About a minute   0.0.0.0:8083-&gt;80/tcp      drupal
                    0.0.0.0:8083-&gt;80/tc
</code>
</pre>
</div>

<p>Una vez desplegado, comenzaremos con la instalación y comprobaremos que funciona correctamente, para ello en nuestro navegador accedemos al puerto indicado anteriormente, es decir a localhost:8083.</p>

<p>Comenzamos con la instalación y comprobamos que podemos usar drupal:</p>

<p><img src="/images/Intro-Docker/idioma.png" alt="Elección de idioma" /></p>

<p><img src="/images/Intro-Docker/instalacion.png" alt="Comenzamos la instalación" /></p>

<p><img src="/images/Intro-Docker/drupal.png" alt="Drupal" /></p>

<h3 id="instalación-de-docker-en-windows"><strong>Instalación de Docker en Windows</strong></h3>

<p>Aunque el proyecto de docker inicialmente era para uso de sistemas Linux, actualmente tambien es posible usarlo en sistemas operativos de windows siempre que nuestro windows cumpla con algunos requisitos:</p>

<ul>
  <li>Windows 10 versión Professional o Enterprise.</li>
  <li>Virtualización activada en nuestro equipo.</li>
  <li>Windows actualizado.</li>
</ul>

<p>La instalación de docker al igual que la mayoria de instalaciones en windows es bastante simple, lo descargamos <a href="https://desktop.docker.com/win/main/amd64/Docker%20Desktop%20Installer.exe">aqui</a>. En mi caso la version de docker que tengo es la 4.1.0.</p>

<p>Una vez descargado, ejecutamos el fichero .exe y comenzara el proceso de instalación.</p>

<p><img src="/images/Intro-Docker/docker1.png" alt="instalación docker" /></p>

<p>Cuando la instalación finalice, debera reiniciarse el equipo para que docker pueda poder usarse (en algunos casos se iniciará y abrirá sin necesidad de reinicio).</p>

<p>A la hora de empezar a usar docker por primera vez, es posible que nos salga un error parecido al siguiente:</p>

<p><img src="/images/Intro-Docker/docker-error.png" alt="error wls2" /></p>

<p>Este error se debe a que docker detecta que nuestra versión de WLS (Windows Subsystem for Linux) es antigua por lo que deberemos instalar la version actual que seria la versión 2 que es la que ahoramismo esta sustituyendo tanto el uso de Hyper-v y VirtualBox en el uso de docker.</p>

<p>Para reparar este error podemos hacer dos cosas, o bien actualizar a WSL2 o utilizar Hyper-V en lugar de WLS2 (Esta última opción en mi caso no ha funcionado con mi version de docker la 4.1.0):</p>

<ul>
  <li>Actualizando WLS2:</li>
</ul>

<p>Empezamos descargandonos la actualización <a href="https://wslstorestorage.blob.core.windows.net/wslblob/wsl_update_x64.msi">aqui</a> (link valido para equipos x64).</p>

<p>Una vez descargado WLS2, ejecutamos el instalador y acabar la instalacion reiniciamos docker.</p>

<p><img src="/images/Intro-Docker/docker3.png" alt="instalación docker" /></p>

<p>Probamos a crear un par de contenedores a traves de la cmd:</p>

<p><img src="/images/Intro-Docker/docker4.png" alt="creación de contenedores" /></p>

<p>Podemos ver que en windows podemos trabajar tanto por linea de comandos como por entorno gráfico.</p>

<p><img src="/images/Intro-Docker/docker5.png" alt="docker desktop" /></p>

<ul>
  <li>Usando Hyper-V:</li>
</ul>

<p>Vamos a la configuración de windows:</p>

<div class="highlight">
<pre class="chroma">
<code class="language-bash" data-lang="bash">
Inicio &gt; Configuración &gt; Aplicaciones &gt; Características Opcionales
</code>
</pre>
</div>

<p>Marcamos “Hyper-V” y damos click en “Aceptar” para reiniciar Windows.</p>

<p><img src="/images/Intro-Docker/docker2.png" alt="instalación Hyper-V" /></p>

<p>Después de reiniciar vamos a la configuración de docker, desmarcamos la opción de “Use the WSL 2 Based engine” y damos click en “Save &amp; Restart”.</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Aplicaciones Web" /><category term="Apuntes" /><summary type="html"><![CDATA[Docker nos permite de forma sencilla crear contenedores ligeros y fáciles de mover donde ejecutar nuestras aplicaciones software sobre cualquier máquina con Docker instalado, independientemente del sistema operativo que la máquina tenga, facilitando así también los despliegues.]]></summary></entry><entry><title type="html">Introducción a PLSQL (Oracle)</title><link href="http://localhost:4000/base%20de%20datos/apuntes/2021/09/13/Introduccion-a-PLSQL-oracle.html" rel="alternate" type="text/html" title="Introducción a PLSQL (Oracle)" /><published>2021-09-13T12:36:20+02:00</published><updated>2021-09-13T12:36:20+02:00</updated><id>http://localhost:4000/base%20de%20datos/apuntes/2021/09/13/Introduccion-a-PLSQL-oracle</id><content type="html" xml:base="http://localhost:4000/base%20de%20datos/apuntes/2021/09/13/Introduccion-a-PLSQL-oracle.html"><![CDATA[<h3 id="introducción-de-plsq"><strong>Introducción de PLSQ</strong></h3>

<ul>
  <li><strong>¿Que es?</strong></li>
</ul>

<p>PL/SQL (Procedural Language/Structured Query Language) es un lenguaje de programación procedimental desarrollado por Oracle como una extensión de SQL. Permite combinar las capacidades de consulta de datos de SQL con estructuras de programación avanzadas como variables, bucles, condiciones, procedimientos, funciones y cursores.</p>

<ul>
  <li><strong>¿Para que sirve?</strong></li>
</ul>

<p>PL/SQL se utiliza principalmente en bases de datos Oracle para escribir bloques de código que pueden ser ejecutados directamente dentro del servidor de la base de datos. Sus aplicaciones incluyen:</p>

<ol>
  <li>
    <p>Automatización de procesos dentro de la base de datos: Permite crear procedimientos almacenados y funciones para realizar cálculos o validaciones sin depender de una aplicación externa.</p>
  </li>
  <li>
    <p>Manejo eficiente de transacciones: PL/SQL permite ejecutar múltiples sentencias SQL en un solo bloque, asegurando que todas se ejecuten correctamente o ninguna en caso de error.</p>
  </li>
  <li>
    <p>Optimización del rendimiento: Como el código se ejecuta directamente en la base de datos, se minimiza el tráfico de red entre la aplicación y el servidor, lo que mejora el rendimiento.</p>
  </li>
  <li>
    <p>Seguridad y control de acceso: Se pueden definir procedimientos con privilegios específicos para restringir el acceso a datos sensibles sin exponer directamente las tablas.</p>
  </li>
  <li>
    <p>Automatización de eventos con triggers: Los triggers en PL/SQL permiten ejecutar código automáticamente cuando ocurre un evento en la base de datos, como insertar o eliminar registros.</p>
  </li>
  <li>
    <p>Integración con aplicaciones empresariales: PL/SQL es ampliamente utilizado en sistemas de gestión empresarial (ERP, CRM, etc.) que requieren lógica de negocio dentro de la base de datos.</p>
  </li>
</ol>

<ul>
  <li>
    <p><strong>Características</strong></p>

    <ul>
      <li>
        <p>Es una extensión de SQL con características de lenguaje de programación.</p>
      </li>
      <li>
        <p>Se ejecuta en el lado del servidor y los procedimientos y funciones se almacenan en la BD.</p>
      </li>
      <li>
        <p>Las sentencias SQL de consulta y manipulación de datos pueden ser incluidas en unidades procedurales de código, pero no pueden usarse instrucciones DDL ni DCL.</p>
      </li>
      <li>
        <p>No tiene instrucciones de entrada por teclado o salida por pantalla. Truco para mostrar por pantalla -&gt; Usando la instrucción para depurar programas.</p>
      </li>
      <li>
        <p>Incluye los tipos de datos y operadores de SQL.</p>
      </li>
      <li>
        <p>Los programas se pueden compilar desde SQL*Plus (comando /) o usar SQL Developer u otros IDEs.</p>
      </li>
      <li>
        <p>Los comentarios comienzan por “–” o se colocan entre “/<em>” y “</em>/”.</p>
      </li>
      <li>
        <p>Trae unas librerías con funciones predefinidas, se llaman paquetes.</p>
      </li>
      <li>
        <p>Para ejecutar los procedimientos almacenados desde SQL*Plus se usa el comando exec.</p>
      </li>
      <li>
        <p>Es solo es propietario de Oracle, en mariadb(SQL/PSM) y Postgres(PG/SQL). Mariadb no es necesario aprenderlo.</p>
      </li>
    </ul>
  </li>
</ul>

<h3 id="estructura-de-un-bloque"><strong>Estructura de un bloque</strong></h3>

<p>Tienen 3 partes:</p>

<ul>
  <li><strong>Declare (opcional)</strong> → cuando se declaran cosas: variables, cursores (guardar resultado de una select), excepciones (posibles errores a lo largo del programa) definidas por el usuario.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	v_usuario 	VARCHAR2(10); 
	v_fecha 	DATE;
</code></pre></div></div>

<ul>
  <li><strong>Begin (obligatorio)</strong> → sentencias SQL sentencias de control PL/SQL (while, for, case, if…).</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	SELECT user_id, fecha 
	INTO v_usuario, v_fecha 
	FROM tabla;
</code></pre></div></div>

<ul>
  <li><strong>Exception (opcional)</strong> → acciones a realizar cuando se producen errores.</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	WHEN nombre_excepcion then
</code></pre></div></div>

<ul>
  <li><strong>End; (obligatorio)</strong> → para cerrar el programa una vez hecho.</li>
</ul>

<h3 id="tipos-de-bloques-de-código"><strong>Tipos de bloques de código</strong></h3>

<ul>
  <li>
    <p><strong>Bloques anónimos:</strong> No se almacenan en la BD. Se ejecutan tras escribirlos (para hacer pruebas).</p>
  </li>
  <li>
    <p><strong>Procedimientos:</strong> Se almacenan en la BD y son invocados. Pueden recibir y devolver múltiples parámetros.</p>
  </li>
  <li>
    <p><strong>Funciones:</strong> Se almacenan en el BD y son invocados. Pueden recibir parámetros y devuelven un valor “en su nombre”. Solo devuelven un parámetro.</p>
  </li>
  <li>
    <p><strong>Triggers:</strong> Se almacenan en la BD y se ejecutan automáticamente cuando ocurre algún evento.</p>
  </li>
</ul>

<h3 id="operaciones-básicas"><strong>Operaciones básicas</strong></h3>

<ul>
  <li><strong>Declaración de variables (nombre tipo)</strong></li>
</ul>

<p>Oracle recomienda que el nombre de las variables empiece por v y el de los procedimientos por para distinguir estos procesos de algunos nombres como de tablas por ejemplo.</p>

<p>Además de variables, pueden declararse constantes. Las constantes pueden ser útiles por ejemplo en un programa que calcule áreas geométricas y tenga que utilizar un valor constante como puede ser el valor de pi, en lugar de repetir varias veces el valor de pi se declara como constante para poder usarse varias veces dicha constante para asi mejorar la legibilidad del código.</p>

<p>A la hora de definir una variable podemos usar dos atributos: %type y %rowtype:</p>

<ul>
  <li>Type sirve para declarar una variable basándonos en otras declaradas previamente o en una columna de la base de datos, es decir, declárame esta variable como esta otra que ya existe.</li>
</ul>

<p>Por lo que antes de %type se puede poner tanto un nombre de tabla como un nombre de columna de una base de datos o el nombre de una variable definida previamente de forma que se copiara para la nueva variable el nuevo dato del dato anterior.</p>

<ul>
  <li>Rowtype para tipos de datos compuestos, un tipo de dato compuesto es cuando necesitas guardar varios datos en una variable, es decir, a esto se le llama una variable registro o compuesta, es una variable que esta divididas en distintas casillas con las distintas informaciones.</li>
</ul>

<p><strong>Asignación de valores a variables → variable := expresión</strong></p>

<p>Ejemplos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>v_fecha := ‘31-oct-2003’
v_apellido := ‘lopez’
</code></pre></div></div>

<p>Se puede asignar un valor desde una consulta de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select sal * 0.10 into v_comision
from emp
where empno =7082;
</code></pre></div></div>

<p>De esta forma estaremos guardando el 10% del salario en la variable comisión del empleado 7082. Hay que hacerlo con cuidado porque si devuelve varios valores no se podra guardar en una unica variable number, para ello usaremos los cursores, si devuelve solo uno si se podra guardar en la variable.</p>

<ul>
  <li><strong>Mostrar por pantalla una variable</strong></li>
</ul>

<p>Para ello usamos el paquete dbms_output, nosotros usaremos la función put_line (solo puede recibir un parámetro). Este método se creo para poder depurar el código, pero lo usaremos para mostrar por pantalla. Ejemplo de uso:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>begin
dbms_output.put_line (‘Mi 1º bloque pl/sql diseñado por ’ || user || ‘el dia ’ || sysdate ||);
end;
</code></pre></div></div>

<table>
  <tbody>
    <tr>
      <td>Como put_line solo muestra una cosa, en el caso de tener que mostrar más de una deberemos usar el  operador de concatenación(</td>
      <td> </td>
      <td>) como en el ejemplo de arriba.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>Recuperar datos de una BD con select</strong></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select lista columnas
into {v_nombre[…]… | nombre_registro}
from nombre_tabla
where condicion
</code></pre></div></div>

<ul>
  <li><strong>Inserción de datos</strong></li>
</ul>

<p>Por ejemplo: añadir información sobre un nuevo empleado en la tabla emp.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Begin

insert into emp(empno, ename, job, deptno)
values(empno_sequence.nextval, ‘HARDING’,’CLERK’,10):

end;
</code></pre></div></div>

<ul>
  <li><strong>Actualizar datos</strong></li>
</ul>

<p>Por ejemplo: aumenta el salario de todos los empleados de la tabla emp que son analistas.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Declare
	v_incre_sal	emp.sal%type := 2000;
Begin
	update emp
	set sal = sal + v_incre_sal
	where job = ‘ANALYST’;
End;
</code></pre></div></div>

<ul>
  <li><strong>Borrar datos</strong></li>
</ul>

<p>Por ejemplo: suprimir los empleados que trabajan en el dpto 10.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Declare
	v_deptno	dept.deptno%type;
Begin
	delete from emp
	where deptno = v_deptno;
End;
</code></pre></div></div>

<h3 id="estructuras-de-control"><strong>Estructuras de control</strong></h3>

<ul>
  <li><strong>Sentencia if</strong></li>
</ul>

<p>Sintaxis:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>if condicion then
	instrucciones;
[elsif condicion then
	instrucciones];
[else
	instrucciones];
end if;
</code></pre></div></div>

<p>Se pueden tener if anidados como en python.</p>

<ul>
  <li><strong>Sentencia case</strong></li>
</ul>

<p>Sintaxis</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case [expresion]
when [condicion|valor] then
	instrucciones;
when [condicion|valor] then
	instrucciones;
….
else
	instrucciones que se ejecuta si no se simple ninguna condición anterior
end case;
</code></pre></div></div>

<p>También es posible usar case con una variable como ejemplo de un menú. Por ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>case tipo
when 1 then
	procesar_pedido_local;
when 2 then
	procesar_pedido_domicilio;
when 3 then
	procesar_pedido_extranjero
else
	procesar_pedido_normal;
end case;
</code></pre></div></div>

<ul>
  <li><strong>Sentencia for</strong></li>
</ul>

<p>Se usa cuando se sabe las vueltas que dara el bucle. Si no se sabe el numero de vueltas, se usara while.</p>

<p>Sintaxis</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for indice in [reverse] valor_inicial...valor_final loop
	instruciones;
….
end loop;
</code></pre></div></div>

<p>El índice se declara de manera implícita, en el momento que se sale del bucle for la variable índice ya no existe.</p>

<p>En mitad del bucle no se debe cambiar el valor de indice.</p>

<p>Ejemplo: inserta las 10 primeras filas del pedido 601.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Declare
v_id	prueba.id%type := 601;
Begin
….
for i in 1 .. 10 loop
	insert into prueba(id, contador)
	values (v_id, i);
end loop;
…
end;
</code></pre></div></div>

<ul>
  <li><strong>Sentencia while</strong></li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>while condicion loop
	instrucciones;
…
end loop;
</code></pre></div></div>

<h3 id="funciones-y-procedimientos"><strong>Funciones y Procedimientos</strong></h3>

<ul>
  <li>
    <p>Para ver errores de compilacion → show err</p>
  </li>
  <li>
    <p>Para ejecutar programa → exec nombre del programa (parametros)</p>
  </li>
  <li>
    <p>Para mostrar por pantalla → set serveroutput on (solo sirve hasta que se cierre la sesion)</p>
  </li>
  <li>
    <p>Para crear un procedimiento siempre utilizamos create or replace para empezar, si no existe lo crea y si ya existe lo reemplaza por el nuevo valor.</p>
  </li>
</ul>

<p>Si el trozo de codigo debe devolver una sola cosa, se usa una funcion, si no tiene porque devolver nada, se usara un procedimiento.</p>

<p>Ejemplo: procedimiento que muestre el nombre del empleado 7082</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create or replace procedure MostrarNom7082
is
	v_nombre	emp.ename%type;
begin
	select ename input v_nombre
	from emp
	where emptno = 7082
	dbms_output.put_line(v_nombre)
end MostrarNom7082;
</code></pre></div></div>

<p><strong>¿Cuando usar funciones o procedimientos?</strong></p>

<table>
  <thead>
    <tr>
      <th><strong>Tipo</strong></th>
      <th><strong>Descripción</strong></th>
      <th><strong>Devuelve un valor?</strong></th>
      <th><strong>Ejemplo de uso</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Procedimiento</strong></td>
      <td>Bloque de código que ejecuta una acción específica.</td>
      <td>No</td>
      <td><code class="language-plaintext highlighter-rouge">EXEC InsertarEmpleado(123, 'Juan')</code></td>
    </tr>
    <tr>
      <td><strong>Función</strong></td>
      <td>Bloque de código que devuelve un valor.</td>
      <td>Sí</td>
      <td><code class="language-plaintext highlighter-rouge">SELECT ObtenerSalario(123) FROM dual;</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li><strong>Programación modular</strong></li>
</ul>

<p>La programación modular es dividir un programa grande, en varios trozos más pequeños de forma cada trozo resuelva una parte del problema (cada trozo preferiblemente debe ser de 12 lineas) de forma que se vea fácilmente el funcionamiento del programa.</p>

<p>La programación modular usa parámetros, los parámetros pueden ser de entrada o salida. De entrada, a un código llega un parámetro de entrada</p>

<ul>
  <li>bloques anónimos</li>
  <li>procedimientos</li>
  <li>funciones</li>
  <li>triggers</li>
</ul>

<h3 id="cursores"><strong>Cursores</strong></h3>

<p>PL/SQL utiliza cursores para gestionar las instrucciones select. Un cursor es un conjunto de registros devueltos por una instrucción select. Hay dos tipos de cursores, los cursores implícitos y los explícitos.</p>

<ul>
  <li>
    <p><strong>Cursores implícitos</strong> → se utiliza para operaciones select into. Se usa cuando la consulta devuelve un único registro.</p>
  </li>
  <li>
    <p><strong>Cursores explícitos</strong> → se utilizan cuando la consulta devuelve un conjunto de registros, aunque también pueden ser usados para consultas que devuelven un único registro ya que de esta forma forma la consulta es más rápida.</p>
  </li>
</ul>

<p>Los cursores explícitos se declaran como cualquier otra variable de pl/sql, sin embargo los cursores implícitos no son necesario declararlos. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>declare
 	cursor c_paises is
 	SELECT CO_PAIS, DESCRIPCION
 	FROM PAISES;
begin
	/* Sentencias del bloque ...*/
end;
</code></pre></div></div>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Base de Datos" /><category term="Apuntes" /><summary type="html"><![CDATA[En este post se comentarán aspectos basicos a tener en cuenta de PLSQL para trabajar con ello en oracle.]]></summary></entry><entry><title type="html">Introducción a las Bases De Datos (Oracle)</title><link href="http://localhost:4000/base%20de%20datos/apuntes/2021/09/07/Introduccion-a-las-bases-de-datos-Oracle.html" rel="alternate" type="text/html" title="Introducción a las Bases De Datos (Oracle)" /><published>2021-09-07T11:33:23+02:00</published><updated>2021-09-07T11:33:23+02:00</updated><id>http://localhost:4000/base%20de%20datos/apuntes/2021/09/07/Introduccion-a-las-bases-de-datos-%5BOracle%5D</id><content type="html" xml:base="http://localhost:4000/base%20de%20datos/apuntes/2021/09/07/Introduccion-a-las-bases-de-datos-Oracle.html"><![CDATA[<h3 id="introducción">**Introducción</h3>

<p>Las bases de datos son una parte fundamental en el almacenamiento y gestión de información en el mundo digital. Oracle Database es uno de los sistemas de gestión de bases de datos más utilizados en entornos empresariales debido a su potencia, escalabilidad y seguridad.</p>

<p>Este post proporciona una introducción clara y estructurada a los conceptos básicos necesarios para trabajar con bases de datos en Oracle. Aprenderás sobre los tipos de sentencias SQL (DDL, DML, DCL), los modelos de bases de datos, los roles y permisos, los tipos de datos, las funciones más comunes y cómo administrar tablas y restricciones.</p>

<p>Si estás comenzando con Oracle o quieres repasar los fundamentos, esta guía te ayudará a comprender cómo interactuar con la base de datos y ejecutar consultas eficientes.</p>

<h3 id="tipos-de-sentencias-en-oracle"><strong>Tipos de sentencias en oracle</strong></h3>

<ul>
  <li>
    <p>DDL → Nos permitirá crear,modificar o eliminar los objetos de la base de datos. Las instrucciones serian Create, Alter (modificar), Drop (eliminar objetos).</p>
  </li>
  <li>
    <p>DML → Permite manipular los datos. Esto se hace con las siguientes instrucciones: Insert, Update, Delete (elimina datos) y Select.</p>
  </li>
  <li>
    <p>DCL → Tiene las siguientes instrucciones: Commit (guardar), Rollback (deshacer hasta el ultimo commit), grant (para dar permisos a un usuario) y revoke (quitar permisos a un usuario).</p>
  </li>
</ul>

<p>SQL es un lenguaje navegacional, no hay que decirle los pasos a dar, sino decirle el objetivo final y sql da los pasos hasta el final.</p>

<h3 id="modelo-ansisparc"><strong>Modelo ansi/sparc</strong></h3>

<ul>
  <li>
    <p>Nivel físico de la base de datos (administradores)→ discos donde nosotros guardamos la información de la base de datos.</p>
  </li>
  <li>
    <p>Nivel conceptual (programadores)→ la base de datos es un conjunto de tablas, no debería importar como estén repartidas las tablas en los distintos discos.</p>
  </li>
  <li>
    <p>Nivel Externo → tenemos distintos usuarios, cada usuario tiene una lista de la base de datos, por lo que un usuario solo vera las tablas que necesita.</p>
  </li>
</ul>

<p>Esquema de usuario es el conjunto de objetos que tiene un usuario.</p>

<p>Diccionario de datos es la base de datos con información de mi base de datos (usuarios que hay, que tablas hay, su contenido…).</p>

<h3 id="tipos-de-roles"><strong>Tipos de Roles</strong></h3>

<ul>
  <li>Rol connect → te permite conectarte a una base de datos, crear tablas…empezar a trabajar.</li>
  <li>Rol Resource → te permite crear funciones, procedimientos, etc.</li>
  <li>Rol DBA → te permite asignar a un usuario permisos de administrados (no sera necesario con sys y system).</li>
</ul>

<h3 id="tipos-de-datos-en-oracle"><strong>Tipos de datos en Oracle</strong></h3>

<ul>
  <li>varchar2 (tamaño) → cadenas de longitud variable.</li>
  <li>Char (tamaño) → cadena de longitud fija.</li>
  <li>Number (precision, escala) → precision(numero entero), escala(los decimales que tendra). Ej:number(4,1): maximo numero 999,9.</li>
  <li>long → cadenas con logitud variable</li>
  <li>date → fechas y horas.</li>
  <li>RAW(tamaño) → cadenas de bytes (para imagenes por ejemplo).</li>
  <li>long raw → graficos,sonidos.</li>
  <li>rowid → cadena hexadecimal, direccion de fila en tabla.</li>
  <li>Clob, nclob, blob → objetos binarios de mas de 2 Gb.</li>
</ul>

<h3 id="operadores-de-oracle"><strong>Operadores de Oracle</strong></h3>

<ul>
  <li>Aritméticos → + - * /</li>
  <li>Comparación → = &gt; &lt; &gt;= &lt;= &lt;&gt; !=</li>
  <li>Logicos → AND, OR, NOT.</li>
  <li>
    <p>Comparación de cadenas con comodines→ like (% → sustituye cualquier cadena y _ sustituye los caracteres individuales).</p>
  </li>
  <li>
    <p>REGEXP_LIKE (nombre,’ expresión regular’) → compara el primer parámetro con la 	expresión regular, si esta bien devolverá un True. Es mas lento que like.</p>
  </li>
  <li>
    <p>La pertenencia a un conjunto → in. Ej: nombre in (‘pepe’,’juan’,’ana’) si nombre pertenece a pepe,juan o ana devolvera un True. Se puede usar con NOT.</p>
  </li>
  <li>La pertenencia a un rango → between(con los extremos incluidos). Ej: edad between 16 and 65.</li>
</ul>

<h3 id="funciones-en-oracle"><strong>Funciones en Oracle</strong></h3>

<p>Trozo de código que ha hecho alguien y que puede usarse,debes saber su nombre, que se va a mandar y que se va a devolver. A los valores de una funcion se les llama parametros, y devuelven un resultado.</p>

<ul>
  <li>
    <p><strong>Aritmeticas:</strong></p>

    <ul>
      <li>abs → devuelve el valor absoluto.</li>
      <li>Ceil → redondea hacia arriba.</li>
      <li>Floor → redondea hacia abajo.</li>
      <li>Mod → resto de la division entera.</li>
      <li>Nvl(valor,expresion) → sustituye valor nulo por otro valor. Por ejemplo para sustituir una columna vacia por 0. se usa solo con numeros enteros (en multiplicaciones se sustituye por 1).</li>
      <li>power → calcula la potencia de un numero.</li>
      <li>Round → redondea numeros con los decimales que se le indiquen. Ej round(76’345,2) → 76’34. se puede usar con numeros negativos. Ej: round(17698’43,-2) → 176’9843.</li>
      <li>sign → indica el signo del valor (1 si es positivo, -1 si en negatvo).</li>
      <li>Sqtr → devuelve la raiz cuadrada.</li>
      <li>trunc → trunca los numeros.</li>
      <li>Variance → devuelve varianza de un conjunto de valores.</li>
    </ul>

    <p>Para probar expresiones → select abs (-15) from dual (tabla por defecto para probar expresiones y funciones); .</p>

    <ul>
      <li>AVG → calcula la media ignorando los nulos.</li>
      <li>Max → devuelve el maximo.</li>
      <li>Min → devuelve el minimo.</li>
      <li>Sum → obtiene la suma de los valores.</li>
      <li>Count → cuenta las filas de una tabla. O bien los valores no nulos de una tabla.</li>
    </ul>
  </li>
  <li>Alter user scott account unlock → desbloquea un usuario oracle.</li>
  <li>
    <p>Alter user scott identified by tiger → cambiar contraseña de usuarios.</p>
  </li>
  <li>
    <p><strong>Funciones de cadenas</strong></p>

    <ul>
      <li>chr(n) → devuelve el carácter ascii de un numero.</li>
      <li>
        <table>
          <tbody>
            <tr>
              <td>Concat (cad1,cad2) → concatena 2 cadenas. Hay un operador que concatena las cadenas (</td>
              <td> </td>
              <td>),se suele usar el operador.</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>Lower (cad) → devuelve la cadena en minúsculas.</li>
      <li>Upper (cad) → devuelve la cadena en mayúscula.</li>
      <li>Initcap → convierte cadena en titulo(iniciales de las palabras en mayusculas).</li>
      <li>Lpad → añade caracteres a la izquierda de la cadena hasta cierta longitud.</li>
      <li>Rpad → añade caracteres a la derecha de la cadena hasta cierta longitud.
  Se suelen usar en listados, para que quede bien.</li>
      <li>Ltrim → suprime un conjunto de elementos a la izquierda.</li>
      <li>Rtrim → suprime un conjunto de elementos a la derecha.</li>
      <li>Replace → sustituye un carácter o caracteres con 0 o mas caracteres.</li>
      <li>Substr → obtiene parte de una cadena.</li>
      <li>Ascii → se le manda un ascii y se devuelve el carácter.</li>
      <li>Instr → permite ver en que posición esta una subcadena en una cadena.</li>
      <li>Length → devuelve el numero de caracteres de la cadena.</li>
    </ul>
  </li>
</ul>

<p>Ejemplo convertir ‘Ruiz Padilla, Raul’ → ‘Raul Ruiz Padilla’ (se pueden usar concat, substr, instr)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select instr(‘Ruiz Padilla, Raul’,’,’) from dual; → cojemos la coma
substr (‘Ruiz Padilla, Raul’,instr(‘Ruiz Padilla, Raul’,’,’) + 2) → extraemos el nombre
substr (‘Ruiz Padilla, Raul’, 1, instr(‘Ruiz Padilla, Raul’,’,’) - 1) → extraemos los apellidos

select substr (‘Ruiz Padilla, Raul’,instr(‘Ruiz Padilla, Raul’,’,’) + 2), ‘  ‘ || substr (‘Ruiz Padilla, Raul’, 1, instr(‘Ruiz Padilla, Raul’,’,’) - 1) from dual;
</code></pre></div></div>

<ul>
  <li>
    <p><strong>Funciones de fechas</strong></p>

    <ul>
      <li>Sysdate → devuelve la fecha del sistema</li>
      <li>Add_months → devuelve la fecha incrementada en n meses.</li>
      <li>months between → meses que hay entre dos fechas. Tambien se puede hacer con la funcion interval.</li>
      <li>Last day → devuelve ultimo dia del mes de la fecha introducida.</li>
      <li>Next day → devuelve el primer dia de la semana indicando por una fecha.</li>
    </ul>

    <p>Se pueden hacer operaciones aritmeticas logicas (sumar y restar dias) con las fechas.</p>
  </li>
  <li>
    <p><strong>Funciones de conversión</strong></p>

    <ul>
      <li>to_char → transforma una fecha o number en una cadena</li>
      <li>to_date → transforma un number o char en date</li>
      <li>to_number → transforma la cadena de caracteres en number</li>
    </ul>
  </li>
  <li>
    <p><strong>Función sobrecargada</strong> → una funcion que puede recibir parámetros diferentes y dependiendo de los tipos de parámetros, la función funcionan de forma distinta.</p>

    <ul>
      <li>Hiredate → fecha de contratacion.</li>
      <li>Mon → mes abreviado(diciembre → dic)</li>
      <li>ddd → dia (4 diciembre → dia 338)</li>
      <li>horas → HH</li>
      <li>minutos → MI</li>
      <li>
        <p>segundos → SS</p>
      </li>
      <li>nls date format → variable de entorno que muestra la fecha por defecto</li>
      <li>alter session set nls date format → cambiar configuracion de esa sesion una variable de entorno por defecto.</li>
    </ul>
  </li>
</ul>

<h3 id="tablas"><strong>Tablas</strong></h3>

<ul>
  <li>Mostrar tablas de un usuario → select * from cat;</li>
  <li>Mostrar columnas de las tablas → desc “nombre de la tabla”</li>
</ul>

<p>Los tipos number se usan en dos casos: si usamos operaciones aritmeticas o si es importante que se ordenen los numeros de forma alfabetica es decir (10,11,8,9,…)</p>

<ul>
  <li>Crear tabla → create table “nombre de la tabla”</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(
columna	tipo(),
);
</code></pre></div></div>

<ul>
  <li>
    <p>Eliminar tabla → drop table “nombre de la tabla”</p>
  </li>
  <li>user_tables → sinónimo de cat (para saber que tablas tiene un usuario)</li>
  <li>all_tables → todas las tablas en las que tiene permiso un usuario</li>
  <li>dba_tables(admin) → ves todas las tablas, de quienes son, etc.</li>
</ul>

<p>Integridad de datos → que los datos tengan valores lógicos.
Integridad referencial → impide que en una tabla se introduzca un valor que no tenga su correspondencia en la tabla.</p>

<p>A las restricciones hay que darles un nombre, no pueden existir dos restricciones con el mismo nombre.</p>

<h3 id="restricciones"><strong>Restricciones</strong></h3>

<ul>
  <li>
    <p>Clave primaria (a nivel de tabla) → constraint “nombre de la restricción” primary key(“columna”)</p>
  </li>
  <li>
    <p>Claves primarias compuestas:
  ◦ No pueden definirse a nivel de columna, pero sí a nivel de tabla..
  ◦ Constraint “nombre de la restriccion” Primary Key (clave1,clave2)</p>
  </li>
  <li>
    <p>Claves ajenas → se pueden poner tantas como sea necesario siempre que existan en la otra tabla.
  ◦ Nivel de columna → constraint “nombre de la restricción” references (tabla)</p>
  </li>
  <li>
    <p>Añadir una clave primaria que se haya olvidado meter</p>
  </li>
  <li>alter table (tabla)</li>
  <li>
    <p>add constraint “nombre de restriccion” primary key (clave/tabla)</p>

    <p>◦ Nivel de tabla → constraint “nombre de restriccion”	foreign key (clave) references (tabla)</p>

    <p>En el caso de claves compuestas es recomendable poner el nombre de los campos de la tabla despues de poner el nombre.</p>
  </li>
  <li>
    <p>On delete cascade → cada vez que se borre una clave, borra los atributos para asegurarse no tener datos sueltos, ej: si borro un alumno, se borraran todas las notas del alumno.</p>
  </li>
  <li>
    <p><strong>Obligatoriedad</strong> → la columna no puede estar en blanco.</p>

    <ul>
      <li>A nivel de columna → Constraint “nombre de restriccion” not null</li>
      <li>A nivel de tabla → Constraint “nombre de restriccion” check(nombre is not null)</li>
      <li>
        <p>check → comprueba que se cumple una restriccion obligaroria siempre. Ej:</p>

        <p>El precio debe estar entre 10 y 1200 → constraint “nombre” check(precio between 10 and 1200)</p>

        <p>El código de un producto debe tener 6 caracteres → constraint “nombre” check(length(codigo)=6)</p>

        <p>El tipo de producto debe ser micro,memoria o disco → constraint “nombre” check(tipo in (‘micro’,’memoria’,’disco’)</p>

        <p>El codigo de producto debe tener dos letras y cuatro números → constraint “nombre” check(regexp_like(codigo,’^[A-Za-z]{2}[0-9]{4}$’))</p>

        <p>El nombre esta en mayuscula → constraint “nombre” check(nombre=upper(nombre))</p>

        <p>Primera letra del nombre en mayuscula → constraint “nombre” check(substr(nombre,1,1) between ‘A’ and ‘Z’</p>

        <p>Productos se hacen en 2019 → constraint “nombre” check(to_char(fechacreacion, ‘YYYY’)=’2019’)</p>

        <p>Productos se crean en primavera→constraint “nombre” check(to_char(fechacreacion,’MM/DD’) between ‘04/21’ and ‘06/20’)</p>
      </li>
      <li>
        <p>Triger → programa que va comprobando si se van dando varias restricciones, se usa cuando se quieren validar restricciones complejas que dependen unas condiciones de otras. El check solo valida restricciones simples.</p>
      </li>
      <li>Meter datos en una tabla → insert into “nombre de tabla”
                           values(filas)
        <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  insert into “nombre de tabla” (campos)
  values(filas)
</code></pre></div>        </div>
      </li>
      <li>
        <p>Los campos que no esten especificados se quedan en blanco.</p>
      </li>
      <li>
        <p>default → pone un valor por defecto, no llevan nombre. incompatible con not null. (No puede ponerse a nivel de tabla, sino a nivel de columna)</p>
      </li>
      <li>Unicidad 
  ◦ Unique→ columna que se sabe que no se deba repetir (una clave candidata), ej: telefono.</li>
    </ul>
  </li>
</ul>

<h3 id="consultas-al-diccionario-de-datos"><strong>Consultas al diccionario de datos</strong></h3>

<p>Oracle almacena la información de las restricciones en el diccionario de datos. En ocasiones se necesitara saber de que va una restriccion por lo que se hacen consultas al diccionario de datos.</p>

<ul>
  <li>Para ver la información de una tabla → select * from “nombre de la tabla”;</li>
  <li>Para saber todas las restricciones → select * from users_constraints;</li>
  <li>Para saber restricciones de una tabla concreta → select * from users_constraints where table_name=”nombre de la tabla”;</li>
</ul>

<p>constraint_name, constraint_type(c → check, p → primary key, r → foreing key, u → unique), search condition → para que muestre el nombre,tipo y condicion de la restriccion.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>* Users_constraints → restricciones que el usuario a creado
* All constraints → todas las restricciones que existen para un usuario(tus tablas y las que tienes permisos)

* Dba_constraints → todas las restricciones de todos las tablas
</code></pre></div></div>

<h3 id="alter-table"><strong>Alter table</strong></h3>

<ul>
  <li>ALTER TABLE nombre_tabla</li>
</ul>

<p><strong>ADD (columna)</strong> → añade columnas en una tabla. 
    * Si la tabla esta rellena no se puede añadir una columna vacia y ponerla como not null, se tendría que rellenar la columna previamente. Ej: ALTER TABLE empleados ADD COLUMN telefono VARCHAR2(15);</p>

<p><strong>[MODIFY (colum [….])]</strong> → modifica columnas. Ejemplo: ALTER TABLE empleados MODIFY COLUMN nombre VARCHAR2(50);. En este caso haciendo uso del ejemplo anterior, estariamos cambiando el valor anterior de varchar 15 a varchar 50.</p>

<p><strong>[DROP COLUMN (colum…..)]</strong> → borra columnas
    * no permite borrar claves primarias refereciadas a claves ajenas
    * no borra ultimas columnas de las tablas
    Ej: ALTER TABLE empleados DROP COLUMN direccion;</p>

<p><strong>[ADD CONSTRAINT restricción]</strong> → añade restricciones
    * Solo pueden añadirse y borrarse primary key, foreing keys, check, unique y not null. Ej: ALTER TABLE empleados ADD CONSTRAINT pk_empleados PRIMARY KEY (id_empleado);</p>

<p><strong>[DROP CONSTRAINT restricción]</strong> → elimina restricciones
    * cada usuario puede borrar sus propias tablas
    * cascade constraint, elimina las restricciones de integridad referencial que remitan a la clave primaria de una tabla borrada.
    * El dba o usuarios con privilegos drop any table, pueden eliminar cualquier tabla</p>

<p><strong>[DISABLE CONSTRAINT restricción]</strong> → desactiva una restriccion
<strong>[ENABLE CONSTRAINT restriccion]</strong> → activa una restriccion</p>

<p>Se activan y desactivan cuando se importa información desde otra base de datos que cuenta con las mismas restricciones, para evitar comprobar restricciones que ya se saben que están bien.</p>

<p>Se puede ver el estado de las restricciones usando Status.</p>

<ul>
  <li>
    <p>Truncate table → elimina las filas de la tabla y además libera el espacio asociado, es decir, que la tabla sigue existiendo y el espacio se libera, solo elimina los datos, la tabla sigue existiendo en el diccionario de datos. El truncate no se puede deshacer.</p>
  </li>
  <li>
    <p>Purge recyclebin; → elimina el contenido de la papelera de reciclaje de la base de datos.</p>
  </li>
</ul>

<p>Insertar valor nulo en tabla</p>

<p>insert into nombre de tabla (columnas que se van a rellenar)
values</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Base de Datos" /><category term="Apuntes" /><summary type="html"><![CDATA[En este post se comentarán y explicarán de la forma mas clara posible los conceptos basicos para poder trabajar con BBDD Oracle.]]></summary></entry><entry><title type="html">Introducción a C++</title><link href="http://localhost:4000/apuntes/2021/06/09/Introduccion-a-C++.html" rel="alternate" type="text/html" title="Introducción a C++" /><published>2021-06-09T16:43:19+02:00</published><updated>2021-06-09T16:43:19+02:00</updated><id>http://localhost:4000/apuntes/2021/06/09/Introduccion-a-C++</id><content type="html" xml:base="http://localhost:4000/apuntes/2021/06/09/Introduccion-a-C++.html"><![CDATA[<h3 id="introducción"><strong>Introducción</strong></h3>

<p>C++ es un lenguaje de programación compilado creado en 1979 derivado del lenguaje C quedándose con lo mejor de C y añadiendo funcionalidades nuevas.</p>

<p>Una de las mejoras que añade C++ es la posibilidad de usar la programación orientada a objetos la cual nos permite ampliar los tipos de datos que podemos utilizar permitiendo definir clases y objetos.</p>

<p>Para escribir un programa en C++ necesitaremos de un editor de texto y un compilador, pero lo normal es utilizar herramientas de entornos integrados de desarrollo o IDEs que básicamente son herramientas como por ejemplo Visual Studio Code que permiten tanto editar el código fuente como compilar el programa una vez acabado.</p>

<h3 id="herramienta-zinjai">Herramienta Zinjai</h3>

<p>Es una herramienta del mismo creador que psinc (para aprender pseudocódigo) para programas en C y C++ esta disponible tanto para Linux como para Windows.</p>

<p>Pasos de instalación en Windows:</p>

<ol>
  <li>Descargar instalador para Windows.</li>
  <li>Ejecutamos el ejecutable descargado.</li>
  <li>Aceptamos los términos y seleccionamos todos los componentes para la instalación.</li>
  <li>Seleccionamos directorio de destino y comenzamos la instalación.</li>
  <li>Configuramos el idioma.</li>
</ol>

<p>Pasos de instalación en Linux</p>

<ol>
  <li>Descargar paquete para GNU/Linux.</li>
  <li>Descomprimimos el archivo descargado y ejecutamos el fichero zinjai para comenzar con la instalación (es posible que se requiera tener instalado xterm, por lo que al instalar, se instalara xterm y al ejecutar de nuevo la instalación se instalara completamente).</li>
</ol>

<h3 id="estructura-en-c">Estructura en C++</h3>

<p>Ejemplo de programa básico:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;iostream&gt;
using namespace std;

int main (int argc, char *argv[])
{
	cout &lt;&lt; “hola mundo”;
	return 0;
}
</code></pre></div></div>

<ul>
  <li>
    <p>La primera linea #include, nos permite añadir una librería, que en este caso se trata de la librería iostream donde se encuentran las funciones para la entrada y salida de datos.</p>
  </li>
  <li>
    <p>Para que no haya problemas ni errores entre las distintas funciones, cada una usa un distinto espacio de nombre por lo que en este caso la función cout usa el espacio de nombres por defecto, std (especificada antes de iniciar la funcion principal).</p>
  </li>
  <li>
    <p>La linea int main hace referencia a la función principal, la función por la que se empieza a ejecutar el programa y posteriormente se van ejecutando las distintas instrucciones en orden dentro de {}. La función principal siempre debe llamarse “main” y en este caso se indica que devuelve un valor entero (int).</p>
  </li>
  <li>
    <p>Cout nos permite escribir en pantalla.</p>
  </li>
  <li>
    <p>Return, devuelve un valor entero al sistema operativo, si la instrucción se ejecuta correctamente devuelve 0, sino dará como resultado devuelve cualquier otro valor.</p>
  </li>
</ul>

<h3 id="tipos-de-datos">Tipos de datos</h3>

<ul>
  <li>
    <p>Datos simples:
  ◦ Numeros enteros (int)
  ◦ Numeros reales (float o double)
  ◦ Valores lógicos (bool)
  ◦ Caracteres (char)</p>
  </li>
  <li>
    <p>Datos complejos: 
  ◦ Arrays
  ◦ Cadenas de caracteres
  ◦ Estructura de datos</p>
  </li>
</ul>

<p>Los datos que nosotros indicamos en un programa lo podemos indicar de varias formas:</p>

<ul>
  <li>
    <p>Literales: nos permiten representar valores, por ejemplo un literal entero será por ejemplo 5.</p>
  </li>
  <li>
    <p>Variables: son identificadores en los que se guarda un valor. Las variables se declaran de un tipo de dato, por ejemplo una variable entera puede guardar datos enteros.</p>
  </li>
  <li>
    <p>Constantes: nos permite declarar un valor de un determinado tipo por medio de de un identificador. Mientras el valor de una variable puede cambiar a lo largo de la ejecución de un programa, las constantes no cambian.</p>
  </li>
  <li>
    <p>Expresiones: las expresiones son operaciones que podemos hacer entre distintos tipos de datos. El tipo de dato de una expresión dependerá del resultado de la operación. Según el tipo de datos con los que trabajemos tenemos distintos tipos de operadores:</p>

    <ul>
      <li>Operadores aritméticos: para hacer operaciones con datos numéricos.</li>
      <li>Operadores relacionales: nos permiten comparar datos y nos devuelve un valor lógico.</li>
      <li>Operadores lógicos: nos permite trabajar con valores lógicos.</li>
      <li>Operadores de asignación: Nos permite asignar valores a variables.</li>
      <li>Otras operadores: operadores para trabajar con bits o punteros.</li>
    </ul>
  </li>
</ul>

<p>La precedencia de operadores es la siguiente:</p>

<ul>
  <li>Paréntesis</li>
  <li>Operadores unarios (+ / - para indicar números positivos y negativos)</li>
  <li>Multiplicaciones, divisiones y módulos</li>
  <li>Sumas y restas</li>
  <li>Operador lógico. &amp;&amp; (Y)</li>
  <li>Operador lógico. || (O)</li>
  <li>Operadores de comparación</li>
  <li>Operadores de asignación</li>
</ul>

<p>Es decir, los operadores dentro de un paréntesis serán los primeros en ejecutarse mientras que los operadores de asignación serán los últimos.</p>

<h3 id="literales-y-constantes">Literales y Constantes</h3>

<h3 id="literales">Literales</h3>

<p>Como se ha dicho anteriormente nos permiten representar valores de diferentes tipos, por lo que contamos con diferentes tipos de literales:</p>

<ul>
  <li>
    <p>Literales enteros: para representar números enteros utilizamos cifras enteras. Ej: 5, -9, números en base octal: 877, base hexadecimal 0xfe, etc.</p>
  </li>
  <li>
    <p>Literales reales: usamos un punto para separar la parte entera de la decimal. Por ejemplo 3.14159. también podemos usar “e” o “E” para representar el exponente.</p>
  </li>
  <li>
    <p>Literales booleanos o lógicos: solo tienen dos valores, false cuando algo es falso y true cuando algo es verdadero.</p>
  </li>
  <li>
    <p>Literales carácter: para indicar un valor de tipo carácter utilizamos las comillas simples (‘’). también podemos usar algunos caracteres especiales como pueden ser \n para indicar un salto de linea o \t para indicar una tabulación.</p>
  </li>
  <li>
    <p>Literales cadenas de caracteres: una cadena de caracteres es un conjunto de caracteres. Para indicar una cadena de caracteres hacemos uso de las comillas dobles (“”).</p>
  </li>
</ul>

<h3 id="constantes">Constantes</h3>

<p>Como se ha dicho anteriormente, las constantes nos permiten declarar un valor de un determinado tipo por medio de de un identificador. Mientras el valor de una variable puede cambiar a lo largo de la ejecución de un programa, las constantes no cambian.</p>

<p>Para crear constantes usamos #define identificador valor (deben declararse antes del programa principal). Por ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;iostream&gt;
using namespace std;
#define ANCHURA 10
#define ALTURA 5
#define NUEVALINEA ‘\n’
int main () {
	int área;
	área = ANCHURA * ALTURA;
	cout &lt;&lt; área;
	cout &lt;&lt; NUEVALINEA;
	return 0;
}
</code></pre></div></div>

<p>Este programa lo que hace es que en programa principal cuando encuentra el identificador de la constante, en este caso altura y anchura, se sustituye el identificador por sus valores correspondientes, en este caso 5 y 10 respectivamente por lo que a la hora de ejecutar el programa principal el programa hará “área = 10 * 5” y el valor entero se mostrará en pantalla a través de cout « y después se mostrará el salto de linea.</p>

<h3 id="variables">Variables</h3>

<p>Las variables nos permiten almacenar información. Las variables tienen un nombre y al crearlas hay que especificar el tipo de datos que se van a almacenar. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int variable1;
</code></pre></div></div>

<p>En este caso en la variable1 solo se almacenaran datos enteros.</p>

<p>El nombre de las variables debe ir en minúsculas para así diferenciarse de las constantes que van en mayúsculas, además el nombre de las variables deben estar compuestos por caracteres, números o subrayados, pero no puede empezar por un numero.</p>

<p>Ejemplos de declaración de variables:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	int variable1; → si no incluimos el valor, este se pondrá por defecto, en el caso de los enteros el valor por defecto es 0. en este caso posteriormente en el programa será necesario inicializar la variable dandole un valor.

	int variable2=10;
	int variable3, variable4;
	int variable5=20, variable6=-10;
</code></pre></div></div>

<p>Contamos con dos tipos o ambitas de variables:</p>

<ul>
  <li>
    <p>Variables locales: se crean dentro de la función es decir si por ejemplo tengo una variable1 cuyo valor es 5 esa variable1 solo existirá en esa función, si tenemos varias funciones en esas otras variable1 no existira, se tendrá que volver a declarar e inicializar.</p>
  </li>
  <li>
    <p>Variables Globales: estas variables sin embargo al contrario que las anteriores se declaran fuera de la función, por lo que es posible usarlas en cada una de las funciones con las que contemos en nuestro programa.</p>
  </li>
</ul>

<h3 id="operadores-de-asignación">Operadores de asignación</h3>

<p>Contamos con dos operadores de asignación en C++:</p>

<ul>
  <li>
    <p>Asignación simple (=): nos permite asignar a una variable tanto valores literales, como numéricos y expresiones. Ej: a = b+7; en este caso guardamos la suma b+7 en la variable a.</p>
  </li>
  <li>
    <p>+=: suma y a continuación hace la asignación. Ej: a+=b es igual que a=a+b, es decir si tenemos a=7 y después tenemos a+=7, entonces nuestra variable a ya no vale 7, sino 14. en este caso también pueden usarse -=, *=, /=, etc.</p>
  </li>
</ul>

<h3 id="tipos-de-datos-numericos">Tipos de datos numericos</h3>

<ul>
  <li>
    <p>int → nos permite guardar valores enteros. Ej: 5, -8, 0…</p>
  </li>
  <li>
    <p>Float → nos permite almacenar numeros reales, es decir con decimales (maximo 7 digitos decimales).</p>
  </li>
  <li>
    <p>Double → es parecido a float solo que permite almacenar numeros reales pero con 16 decimales.</p>
  </li>
</ul>

<p>La diferencia principal entre float y double es espacio que la variable de este tipo ocupa en memoria  ya que float ocupa 4 bytes, mientras que double al contar con 16 digitos decimales, ocupa 8 bytes.</p>

<h3 id="tipo-de-dato-carácter">Tipo de dato carácter</h3>

<ul>
  <li>char: guarda un carácter, aunque realmente la variable es entera ya que internamente se guarda un numero que hace que cada carácter haga referencia a un numero usando la tabla ascii. Por ejemplo a una variable char le podemos asignar un valor de la siguientes formas:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	char variable1=‘a’; o bien char variable2=97 (97 es el valor numerico asignado a ‘a’ en la 	tabla ascii);
</code></pre></div></div>

<h3 id="modificadores-de-tipo">Modificadores de tipo</h3>

<p>Los modificadores de tipo se pueden usar para modificar el tamaño de memoria que se coge para guardar datos o si se quieren guardar numeros positivos o negativos.</p>

<ul>
  <li>
    <p>int: nosotros podemos almacenar numeros desde el -2147483648 al 2147483647 mientras que si por ejemplo queremos la posibilidad de almacenar numeros solo positivos, usariamos unsigned int, que almacena valores de 0 al 4294967295.</p>
  </li>
  <li>
    <p>short int: se usa para el caso en el que queramos redurie el tamaño de almacenamiento en memoria limitando la cantidad de valores posibles, en este caso de -32768 a 32767. en este caso en lugar de 4 bytes, ocupa 2 bytes.</p>
  </li>
  <li>
    <p>unsigned short int: es una combinacion de las dos anteriores, por un lado limita el rango de valores de forma que ocupa menos espacio en memoria y a la vez permite solo valores positivos. Los valores van desde 0 a 65535.</p>
  </li>
  <li>
    <p>long int: al igual que hay un short int para que los valores ocupen menos espacio en memoria, tambien contamos un long int que amplia el rango de valores al doble ocupando asu 8 bytes en memoria. El rango de vlores va desde -9223372036854775808 a 9223372036854775807.</p>
  </li>
</ul>

<p>Al declarar las variables podemos usar notaciones cortas donde no es necesario indicar el tipo int. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>unsigned short var1;
long var2;
short var3;
</code></pre></div></div>

<p>Podemos usar sufijos para indicar literales numéricos largos (con el sufijo L) y sin signo (con el sufijo U). Por ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>var1=123U; var2=123L;
</code></pre></div></div>

<h3 id="conversion-de-tipos">Conversion de tipos</h3>

<p>Por defecto C++ hace conversiones entre algunos tipos de datos como por ejemplo entre cgar e int o de int a float. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int var1=10
float var2=var1
</code></pre></div></div>

<p>En este caso por defecto el valor entero 10 se convierte en valor real 10,0.</p>

<p>Si tenemos expresiones donde hacemos operaciones entre datos del mismo tipo, el resultado de la expresión será del mismo tipo.</p>

<p>Si tenemos expresiones donde hacemos operaciones entre datos de distintos tipos el resultado de la expresión será del tipo con más precisión de los datos operados.</p>

<p>Por último podemos hacer una conversión explicita usando una expresión de typecast, por ejemplo para convertir un int a un float:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>int num1=10,num2=3; 
float res; 
res=(float)num1 / float(num2)
</code></pre></div></div>

<h3 id="operadores-aritmeticos">Operadores aritmeticos</h3>

<ul>
  <li>+: suma dos numeros.</li>
  <li>-: resta dos numeros.</li>
  <li>*: multiplica dos numeros.</li>
  <li>/: divide dos numeros.</li>
  <li>%: modulo o resto de la division.</li>
  <li>+, -: operadores unarios positivo y negativo.</li>
  <li>++: operador de incremento, suma 1 a la variable, 1++ es lo mismo a 1=1+1.</li>
  <li>–: operador de decremento, resta 1 a la variable.</li>
</ul>

<h3 id="funciones-matematicas">Funciones matematicas</h3>

<p>En la librería cmath tenemos distintas funciones matemática. Las más útiles que podemos usar en nuestros programas son:</p>

<ul>
  <li>
    <p>double pow(double, double);: Realiza la potencia, la base es el primer parámetro y el exponente el segundo. Recibe datos de tipo double y devuelve también una valor double.</p>
  </li>
  <li>
    <p>double sqrt(double);: Realiza la raíz cuadrada del parámetro double que recibe. Devuelve un valor `double.</p>
  </li>
  <li>
    <p>int abs(int);: Devuelve el valor absoluto (valor entero) del número entero que recibe como parámetro.</p>
  </li>
</ul>

<p>Veamos un ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#include &lt;iostream&gt;
#include &lt;cmath&gt;
using namespace std;

int main(int argc, char *argv[]) {
    int num1=4, num2=2;
    cout &lt;&lt; "Potencia:" &lt;&lt; pow(num1,num2) &lt;&lt; endl; //Potencia
    cout &lt;&lt; "Raíz Cuadrada:" &lt;&lt; sqrt(num1) &lt;&lt; endl; //Raíz cuadrada
    num1=-4;
    cout &lt;&lt; "Valor absoluto:" &lt;&lt; abs(num1) &lt;&lt; endl; //Valor absoluto
    return 0;
}
</code></pre></div></div>

<h3 id="cadenas-de-caracteres">Cadenas de caracteres</h3>

<p>Tenemos dos formas de trabajar con cadenas de caracteres:</p>

<ul>
  <li>
    <p>La tradicional usada en C, que es entender  como una cadena de caracteres como un conjunto de variables de tipo carácter (arrays).</p>
  </li>
  <li>
    <p>C++ nos ofrece la clase string que nos permite trabajar con cadenas de caracteres.</p>
  </li>
</ul>

<p>Podemos declarar una cadena string de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>string cadena1;
string cadena2=“Hola mundo”;
</code></pre></div></div>

<p>Las cadenas de caracteres se pueden indexar, es decir que podemos obtener el valor de cada carácter, para ello tenemos que indicar la posicion, de izquierda a derecha empezando por el 0. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cadena2[0] nos devolveria el carácter H de Hola mundo.
</code></pre></div></div>

<p>Otra operación que podemos hacer con las cadenas de caracteres es saber cuantos caracteres tiene la cadena, para ello usamos el metodo length. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cadena2.length() nos devolvera 10 ya que “Hola mundo” cuenta con 10 caracteres.
</code></pre></div></div>

<p>Podemos tambien concatenar cadenas de caracteres usando +. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>string nombre=“sergio”;
string apellido=“ibañez”;
string nombre_completo;
nombre_completo=nombre+“ ”+apellido
</code></pre></div></div>

<p>El resultado de la concatenacion será “sergio ibañez”.</p>

<h3 id="entrada-y-salida-de-datos">Entrada y salida de datos</h3>

<p>Las instrucciones que nos permiten leer y mostrar informacion por pantalla estan en la librería iostream.</p>

<ul>
  <li>cout: representa el dispositivo de salida (la pantalla), el operador que escribe en pantalla es « lo que hace es enviar el mensaje al dispositivo de salida estándar a traves de cout. Ej:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	cout &lt;&lt; “bienvenido al sistema” end1; (end1 indica el final de linea)
</code></pre></div></div>

<ul>
  <li>cin: valor para leer por teclado. Ej:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	int edad;
	cout &lt;&lt; “dime tu edad: ”;
	cin &gt;&gt; edad;
</code></pre></div></div>

<p>De esta forma por pantalla se nos muestra la pregunta sobre nuestra edad mientras que la edad que introduzcamos por pantalla se guardara como valor de la variable edad a traves de ».</p>

<p>Sin embargo, cin no es capaz de leer variables de tipo cadena de carcteres, por lo que en caso de querer o necesitar leer cadenas de caracteres usamos la funcion getline. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>string nombre;
getline(cin,nombre);
</code></pre></div></div>

<p>De esta forma podremos introducir el valor que tendra la variable nombre.</p>

<ul>
  <li>cin.ignore: lo usamos para borrar valores introducidos por teclado.</li>
</ul>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Apuntes" /><summary type="html"><![CDATA[C++ es un lenguaje de programación compilado creado en 1979 derivado del lenguaje C quedándose con lo mejor de C y añadiendo funcionalidades nuevas.]]></summary></entry><entry><title type="html">Active Directory</title><link href="http://localhost:4000/sistemas/apuntes/2021/05/23/Active-directory.html" rel="alternate" type="text/html" title="Active Directory" /><published>2021-05-23T15:28:17+02:00</published><updated>2021-05-23T15:28:17+02:00</updated><id>http://localhost:4000/sistemas/apuntes/2021/05/23/Active-directory</id><content type="html" xml:base="http://localhost:4000/sistemas/apuntes/2021/05/23/Active-directory.html"><![CDATA[<h3 id="que-es"><strong>¿Que es?</strong></h3>

<p>Active Directory es un servicio de directorio que almacena objetos de datos en su entorno de red local. El servicio registra datos en los usuarios, dispositivos, aplicaciones, grupos, y dispositivos en una estructura jerárquica.</p>

<p>La estructura jerárquica de Active Directory facilita la localización y administración de los recursos de la red desde un único punto. En esencia, Active Directory actúa como un directorio telefónico para su red, por lo que puede buscar y administrar dispositivos fácilmente.</p>

<p><strong>Bosque</strong></p>

<p>Es el nivel más alto de organizacion en active directory. Un bosque es un grupo de dominios, cuando múltiples árboles se agrupan juntos se convierten en un bosque.</p>

<p><strong>Árbol</strong></p>

<p>El árbol es una entidad con un solo dominio o grupo de objetos seguido por dominios secundarios. Los distintos árboles en un bosque se conectan entre sí a través de relaciones de confianza, permitiendo compartir información entre dominios de manera automática (la confianza entre los distintos dominios se hara de forma automatica) que permite que los distintos dominios compartan la información.</p>

<p><strong>Dominios</strong></p>

<p>Un dominio de Active Directory es un contenedor lógico utilizado para administrar usuarios, grupos y computadoras entre otros objetos.</p>

<p>Todos estos objetos son contenidos en una partición específica dentro de la base de datos de Active Directory (ADDS).</p>

<p><strong>Unidad Organizativa</strong></p>

<p>Las unidades organizativas (OU) son contenedores de Active Diretory dentro de un dominio con los que podemos agrupar para organizar multitud de objetos de active directory como pueden ser: usuarios de dominios, grupos de dominios, equipos e incluso otras unidades organizativas.</p>

<p><img src="/images/Active-Directory/jerarquia.png" alt="jerarquia active directory" /></p>

<table>
  <thead>
    <tr>
      <th><strong>Elemento</strong></th>
      <th><strong>Descripción</strong></th>
      <th><strong>Ejemplo</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Bosque</strong></td>
      <td>Grupo de uno o más dominios que comparten un esquema y configuración.</td>
      <td><code class="language-plaintext highlighter-rouge">Empresa.com</code> y <code class="language-plaintext highlighter-rouge">Filial.empresa.com</code> forman parte del mismo bosque.</td>
    </tr>
    <tr>
      <td><strong>Árbol</strong></td>
      <td>Conjunto de dominios organizados jerárquicamente dentro de un bosque.</td>
      <td><code class="language-plaintext highlighter-rouge">ventas.empresa.com</code>, <code class="language-plaintext highlighter-rouge">soporte.empresa.com</code> son parte del mismo árbol.</td>
    </tr>
    <tr>
      <td><strong>Dominio</strong></td>
      <td>Contenedor lógico que administra objetos como usuarios y equipos.</td>
      <td><code class="language-plaintext highlighter-rouge">dominio.local</code></td>
    </tr>
    <tr>
      <td><strong>Unidad Organizativa (OU)</strong></td>
      <td>Contenedor dentro de un dominio que agrupa objetos y facilita la gestión.</td>
      <td><code class="language-plaintext highlighter-rouge">Usuarios</code>, <code class="language-plaintext highlighter-rouge">Equipos</code>, <code class="language-plaintext highlighter-rouge">Grupos</code></td>
    </tr>
  </tbody>
</table>

<h3 id="instalacion-en-windows-server-2016">Instalacion (En windows server 2016)</h3>

<ol>
  <li>Nos dirigimos al Administrador de Servidor o Server Manager y hacemos clic en Agregar roles o características.</li>
</ol>

<p><img src="/images/Active-Directory/ws-1.png" alt="agregar roles" /></p>

<ol>
  <li>En la ventana inicial hacemos clic en siguiente y elegimos la opción de la Instalación basada en roles.</li>
</ol>

<p><img src="/images/images/Active-Directory/ws-2.png" alt="" /></p>

<ol>
  <li>Hacemos clic en siguiente y elegimos el servidor donde queremos instalar nuestro rol de AD DS.</li>
</ol>

<p><img src="/images/Active-Directory/ws-3.png" alt="" /></p>

<ol>
  <li>Hacemos clic en siguiente y elegimos el rol solicitado (Servicios de dominio de Active Directory), agregamos las características.</li>
</ol>

<p><img src="/images/Active-Directory/ws-4.png" alt="" /></p>

<ol>
  <li>
    <p>Hacemos clic en siguiente seleccionamos las características y clic en siguiente y se desplegarán las caracteristicas que se van a instalar.</p>
  </li>
  <li>
    <p>Hacemos clic en siguiente y comenzamos con la instalacion.</p>
  </li>
</ol>

<p><img src="/images/Active-Directory/ws-6.png" alt="" /></p>

<ol>
  <li>
    <p>Una vez instalado nuestro rol de Active Directory reiniciamos el servidor para aplicar los cambios. Antes de iniciar nuestro asistente de AD DS debemos promover nuestro servidor a controlador de dominio.</p>
  </li>
  <li>
    <p>Para promover el servidor a DC nos dirigimos a nuestro Administrador de Servidor y desplegamos el flag de información (la bandera) e indicamos la opcion “promover este servidor a controlador de dominio”.</p>
  </li>
</ol>

<p>Hacemos clic en esta opción y se desplegará el asistente para configuración de servicios de dominio de Directorio Activo.</p>

<p>Veremos que contamos con 3 opciones de configuración:</p>

<ul>
  <li>Agregar un controlador de dominio a un dominio existente:</li>
  <li>Agregar un nuevo dominio a un bosque existente:</li>
  <li>Agregar un nuevo bosque:</li>
</ul>

<p>En nuestro caso elegiremos la opción Agregar un nuevo bosque, elegiremos el nombre para nuestro domino y damos clic en Siguiente.</p>

<p><img src="/images/Active-Directory/ws-8.png" alt="" /></p>

<ol>
  <li>Después que el sistema valide si el nombre de dominio es válido, se desplegarán las opciones del controlador de dominio, donde contamos con algunas opciones muy importantes que debemos tener en cuenta a nivel de funcionalidad de nuestro servidor.</li>
</ol>

<p>El nivel funcional que se indique debe ser siempre el más bajo de la red, es decir, en mi caso el servidor con Active Directory cuenta con windows server 2012 por lo que el nivel funcional tanto de dominio como de bosque, será de windows 2012, sin embargo si en nuestra red contamos con algun otro servidor con windows server 2008 por ejemplo, el nivel funcional se debe de establecer en windows server 2008.</p>

<p><img src="/images/Active-Directory/ws-10.png" alt="" /></p>

<ol>
  <li>En la siguiente ventana tenemos las opciones de DNS.</li>
</ol>

<p><img src="/images/Active-Directory/ws-11.png" alt="" /></p>

<ol>
  <li>Hacemos clic en siguiente, y veremos el nombre de NETBIOS asignado por el sistema, nosotros decidimos si lo cambiamos o dejamos ése por defecto.</li>
</ol>

<p><img src="/images/Active-Directory/ws-12.png" alt="" /></p>

<ol>
  <li>Clic en Siguiente, se desplegará la ventana informativa de ubicación de la base de datos de AD DS.</li>
</ol>

<p><img src="/images/Active-Directory/ws-13.png" alt="" /></p>

<ol>
  <li>Clic en Siguiente, a continuación se desplegará una ventana informativa con el proceso a realizar, si notamos en la parte inferior podemos realizar este mismo procedimiento usando Powershell, Windows Server nos da la opción de ver y copiar el script.</li>
</ol>

<p><img src="/images/Active-Directory/ws-14.png" alt="" /></p>

<ol>
  <li>Hacemos clic en siguiente, y Windows Server realizará una validación para que todos los requisitos de instalación estén correctos y así poder comenzar la instalación.</li>
</ol>

<p><img src="/images/Active-Directory/ws-15.png" alt="" /></p>

<ol>
  <li>
    <p>Hacemos clic en Instalar para iniciar el proceso de promover nuestro servidor a controlador de dominio.</p>
  </li>
  <li>
    <p>El sistema se reiniciará para guardar la configuración y veremos en el panel del Administrador del Servidor que ya contamos con las opciones relacionadas al Directorio Activo.</p>
  </li>
</ol>

<p>En caso de que necesitemos borrar un controlador de dominio de nuestra estructura de red, debemos seguir los siguientes pasos:</p>

<ol>
  <li>
    <p>Entramos al menú Administrar y elegimos “Quitar roles y funciones”.</p>
  </li>
  <li>
    <p>Se desplegará la ventana informativa, Hacemos clic en Siguiente</p>
  </li>
  <li>
    <p>Seleccionamos el servidor donde tenemos instalado el rol de AD DS</p>
  </li>
  <li>
    <p>En la ventana de Roles de servidor seleccionamos la opción Servicios de dominio de directorio activo (debe quedar desactivada), quitamos las características de AD DS.</p>
  </li>
  <li>
    <p>Hacemos clic en siguiente, seleccionamos las características que deseemos eliminar y hacemos clic en siguiente, se mostrará un resumen de la tarea que estamos por ejecutar y hacemos clic en Quitar.</p>
  </li>
</ol>

<h2 id="creación-y-administración-de-usuarios-y-equipos">Creación y administración de usuarios y equipos</h2>

<p>Podemos crear un usuario a través de diferentes herramientas como lo son: Los asistentes de la consola de AD DS, el comando DSADD.EXE, PowerShell entre otros, en nuestro ejemplo usaremos el asistente de AD DS. Para ello vamos a realizar los siguientes pasos:</p>

<ul>
  <li>
    <p>Ingresamos al administrador del servidor, elegimos en el menú Herramientas la opción “Centro de administración de Active Directory”.</p>
  </li>
  <li>
    <p>Se desplegará la consola del centro de administración de AD.</p>
  </li>
  <li>
    <p>Seleccionamos nuestro servidor en el panel lateral izquierdo podremos ver que se despliegan una serie de opciones, como por ejemplo, equipos, usuarios, sistema, dispositivos TPM entre otros.</p>
  </li>
  <li>
    <p>En el panel lateral derecho, en la parte inferior veremos que se abren las opciones referentes al objeto Users.</p>
  </li>
</ul>

<p>Allí podremos elegir lo que deseemos crear, usuarios, equipos, grupos, etc. Elegimos Usuario y podremos ver cómo cambia la estructura de creación comparada con versiones anteriores (a nivel de apariencia).</p>

<p><img src="/images/Active-Directory/ad-3.png" alt="" /></p>

<p>Una vez tengamos los cambios necesarios en el perfil del usuario damos clic en Aceptar para guardar dicha configuración.</p>

<p><img src="/images/Active-Directory/ad-5.png" alt="" /></p>

<p>Si deseamos crear nuestros usuarios o equipos a través de cmd, podemos ejecutar el comando DCA.MSC o dirigirnos al menú Herramientas y elegir la opción Usuarios y equipos de Active Directory.</p>

<p>El mismo procedimiento realizamos para la creación de cualquier otro objeto en nuestro Directorio Activo, equipos, OUs, etc. Por ejemplo para la creación de un equipo nos dirigimos al menú inferior derecho del Centro de administración de Active Directory y elegimos Nuevo / Equipo.</p>

<p>En la ventana desplegada ingresamos información del equipo, así mismo indicamos a que dominio se va a incluir dicho equipo y para guardar los cambios damos clic en Aceptar.</p>

<p><img src="/images/Active-Directory/ad-4.png" alt="" /></p>

<p>En el centro de administración de Active Directory podemos gestionar otras funciones de nuestro rol, en el panel lateral derecho podemos encontrar lo siguiente:</p>

<ul>
  <li>
    <p>Cambiar el controlador de dominio: nos da la posibilidad de modificar nuestro DC.</p>
  </li>
  <li>
    <p>Elevar el nivel funcional del bosque: nos permite elevar la funcionalidad del bosque de nuestro servidor.</p>
  </li>
  <li>
    <p>Elevar el nivel funcional del dominio: da la posibilidad de elevar la funcionalidad de nuestro dominio.</p>
  </li>
  <li>
    <p>Habilitar la papelera de reciclaje: permite recuperar objetos eliminados en AD</p>
  </li>
</ul>

<h3 id="creación-y-administración-de-ous-unidades-organizacioneales"><strong>Creación y administración de OUs (unidades organizacioneales)</strong></h3>

<p>Dentro de nuestro dominios podemos crear Unidades Organizacionales para tener un control más específico de los usuarios u objetos, así mismo podemos crear diferentes perfiles para cada OU.</p>

<p>Para ello abrimos el Centro de administración de Active Directory desde el menú Herramientas y elegiremos del panel lateral derecho la opción Nuevo / Unidad Organizativa.</p>

<p>Allí debemos especificar el nombre de la OU (en este caso usemos Pruebas) y podemos agregar comentarios y en la opción superior derecha Crear en: podemos definir en qué parte de nuestro Árbol vamos a crear dicha OU.</p>

<p>Podríamos incluir Pruebas dentro de la OU:</p>

<ul>
  <li>Ingresamos los datos en la ventana del Centro de administración:</li>
</ul>

<p><img src="/images/Active-Directory/ad-6.png" alt="" /></p>

<ul>
  <li>Podremos ver que nuestra OU Pruebas ha sido creada correctamente dentro de nuestro árbol:</li>
</ul>

<p><img src="/images/Active-Directory/ad-7.png" alt="" /></p>

<h2 id="tareas-active-directory"><strong>Tareas Active Directory</strong></h2>

<ul>
  <li>
    <h4 id="crear-cuentas-de-usuario"><strong>Crear cuentas de usuario</strong></h4>
  </li>
</ul>

<p>Esta vez crearemos un usuario de forma distinta al creado anteriormente. Esta vez entramos en el administrador del servidor y accedemos a las herramientas, pero esta vez no elegiremos la opcion de configuracion de administracion de active directory, sino que elegiremos la opcion de usuarios y equipos de active directory.</p>

<p>Una vez estemos en la ventana de usuarios y equipos de active directory podremos crear un usuario haciendo clic derecho en cualquier lugar de la ventana y eligiendo la opción “nuevo” y despues la opcion de “usuario”. Por ejemplo en mi caso si quiero crear un usuario dentro de mi dominio de pruebas lo que haria seria hacer clic en el nombre de mi dominio para que al crear el usuario, se crease el usuario dentro del dominio. Ej:</p>

<p><img src="/images/Active-Directory/usuario1.png" alt="" /></p>

<p><img src="/images/Active-Directory/usuario2.png" alt="" /></p>

<p>Cuando se nos abra la ventana para crearnos el usuarios e introduzcamos los datos, tendremos que ponerle una contraseña (la contraseña que se pone incialmente suele ser una contraseña temporal) aunque tendremos varias opciones de configuracion de la cuenta:</p>

<p><img src="/images/Active-Directory/usuario3.png" alt="" /></p>

<ul>
  <li>
    <p>La primera opción que encontramos es la que nos permite que el usuario cambie la contraseña por la que el quiera al loguearse ya que la contraseña con la que el admin creo su cuenta seria temporal y de un solo uso.</p>
  </li>
  <li>
    <p>La segunda opción es para que el usuario no pueda cambiar la contraseña aunque esta expire, por lo que solo el admin tendra autoridad para cambiarla.</p>
  </li>
  <li>
    <p>La tercera opción hace que las contraseñas no expiren.</p>
  </li>
  <li>
    <p>La ultima opción que encontramos es para indicar que la cuenta del usuario esta deshabilitada, por ejemplo si estamos en una empresa y ese empleado a dejado el trabajo.</p>
  </li>
</ul>

<p>Una vez creados los usuario lo siguiente será agregar dichos usuarios a los grupos apropiados en caso de que sea necesario.</p>

<table>
  <thead>
    <tr>
      <th><strong>Opción</strong></th>
      <th><strong>Descripción</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>El usuario debe cambiar la contraseña al iniciar sesión</strong></td>
      <td>Se usa para forzar el cambio en el primer inicio de sesión.</td>
    </tr>
    <tr>
      <td><strong>El usuario no puede cambiar la contraseña</strong></td>
      <td>Solo un administrador podrá modificarla.</td>
    </tr>
    <tr>
      <td><strong>La contraseña nunca expira</strong></td>
      <td>Se usa en cuentas de servicio o equipos sin usuarios.</td>
    </tr>
    <tr>
      <td><strong>La cuenta está deshabilitada</strong></td>
      <td>Se usa cuando un empleado deja la empresa.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <h4 id="crear-grupos"><strong>Crear grupos</strong></h4>
  </li>
</ul>

<p>Cuando un usuario inicia sesión en el dominio, Active Directory crea un token o una especie de identidad que indica automáticamente en que grupos está incluido este usuario; Un grupo puede crearse para fines distintos, por ejemplo, para acceder a ciertas rutas, para poder imprimir, para que le lleguen determinados correos etc.</p>

<p>Hacemos clic en la raíz de nuestro dominio, en mi caso el dominio Practicas y haciendo clic derecho elegimos la opción “nuevo” y despues la opción “grupo”. Una vez que se nos abra la ventana para crear el grupo tendremos que asignarle un nombre así como elegir el ambito y el tipo de grupo que será. Ej:</p>

<p><img src="/images/Active-Directory/grupos1.png" alt="" /></p>

<p>Los ámbitos de grupos son los sigientes:</p>

<ul>
  <li><strong>Dominio Local</strong></li>
</ul>

<p>Es el grupo más restrictivo ya que solo será accesible por usuarios que esten en el mismo dominio.
 </p>
<ul>
  <li><strong>Global</strong></li>
</ul>

<p>En este caso el grupo global permite que el grupo sea accesible por cuelaquier dominio siempre y cuando esten dentro del mismo bosque.</p>

<ul>
  <li><strong>Universal</strong></li>
</ul>

<p>Este es el tipo menos restrictivo ya que permite el acceso a cualquier dominio de cualquier bosque, es decir acceso a todo el mundo.</p>

<p>Por otro lado tenemos dos tipos de grupos:</p>

<ul>
  <li>Distribución: Son creados básicamente para el envío de información a una o más personas.</li>
  <li>Seguridad: Son creados para garantizar el acceso a los recursos de la organización (permitir/restringir acceso a archivos otorgandoles permisos a usuarios concretos).</li>
</ul>

<p>En este ejemplo para tener mejor organizados los grupos, he creado una Unidad Organizativa (OU), llamada grupo donde estan alojados varios grupos (como si fuese una empresa real):</p>

<p><img src="/images/Active-Directory/grupos2.png" alt="" /></p>

<p><img src="/images/Active-Directory/grupos3.png" alt="" /></p>

<table>
  <thead>
    <tr>
      <th><strong>Tipo de Grupo</strong></th>
      <th><strong>Descripción</strong></th>
      <th><strong>Ejemplo de uso</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Grupo de Seguridad</strong></td>
      <td>Se usa para asignar permisos de acceso a recursos.</td>
      <td>Acceso a carpetas compartidas o permisos en aplicaciones.</td>
    </tr>
    <tr>
      <td><strong>Grupo de Distribución</strong></td>
      <td>Se usa para enviar correos electrónicos a múltiples usuarios.</td>
      <td>Grupo de correo para empleados de un departamento.</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <h4 id="agregar-usuarios-a-grupos"><strong>Agregar usuarios a grupos</strong></h4>
  </li>
</ul>

<p>Para ello hacemos clic en el usuario que se haya creado y abrimos las propiedades del usuario. Una vez se nos habra la ventana de propiedades, vamos a la pestaña “miembro de” y hacemos clic en agregar.</p>

<p>Después de agregar tendremos que indicar a que grupo se agregara el usuario, por ejemplo si mi dominio se llama Pruebas y en la empresa será uno de los administradores, seria Admin (para ello debe existir previamente el grupo que especifiquemos sino obviamente no podremos agregar ningun usuario). Ej:</p>

<p><img src="/images/Active-Directory/ug1.png" alt="" /></p>

<ul>
  <li>
    <h4 id="restablecer-cuentas-de-usuario"><strong>Restablecer cuentas de usuario</strong></h4>
  </li>
</ul>

<p>Esta opción es bastante util ya que a la gente se les suele olvidar a menudo la contraseña, al quedarse la centa bloqueada, el admin puede restablecer la contraseña por defecto para que así el usuario pueda volver a tener acceso con otra contraseña.</p>

<p>En el caso de que la cuenta haya sido bloqueada por algun motivo y el suaurio no puede acceder a ella la solución seria bastante facil ya que lo unico que habria que hacer es abrir las propiedades de la cuenta de usuario y en la pestaña “cuenta/account” seleccionar la opción desbloquear cuenta.</p>

<p>Por otro lado en el caso de que la cuenta no este bloqueada sino que se haya olvidado la contraseña y haya que restablecerla, se haria lo siguiente:</p>

<ul>
  <li>
    <p>Comprobar primero que el usuario al que vamos a resyablecerle la contraseña es el usuario correcto ya que en entornos empresariales por ejemplo es probable encontrar a uno o varios empleados que se llamen igual (para ello podemos hacer uso de la busqueda de usuarios, contactos y grupos).</p>
  </li>
  <li>
    <p>Cuando estemos sehuro del usuario al que restablecer la contraseña, lo que hacemos es hacer clic en el y elegir la opción de restablecer contraseña lo cual nos permitirá indicar una contraseña nueva con la opción de que el usuario deba cambiarla una vez logeado.</p>
  </li>
  <li>
    <h4 id="eliminacion-de-cuenta-de-usuario"><strong>Eliminacion de cuenta de usuario</strong></h4>
  </li>
</ul>

<p>Basicamente la eliminacion de una cuenta de usuario es batante simple ya que basta con hacer clic en el usuario y elegir la opcion de eliminar cuenta.</p>

<ul>
  <li>
    <h4 id="configurar-ficheros-compartidos"><strong>Configurar ficheros compartidos</strong></h4>
  </li>
</ul>

<p>Hacemos clic en la raíz de nuestro dominio, en mi caso el dominio Practicas y haciendo clic derecho elegimos la opción “nuevo” y despues la opción “objeto”.</p>

<p>Empezamos poniendole un nombre a la carpeta compartida y luego pasamos a indicar la ruta de la carpeta a esta carpeta podemos añadirle los permisos necesarios para que solo un grupo del dominio pueda accedes a ella por ejemplo.</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Sistemas" /><category term="Apuntes" /><summary type="html"><![CDATA[Active Directory es un servicio de directorio que almacena objetos de datos en su entorno de red local. El servicio registra datos en los usuarios, dispositivos, aplicaciones, grupos, y dispositivos en una estructura jerárquica.]]></summary></entry><entry><title type="html">Conceptos Basicos de Mongodb</title><link href="http://localhost:4000/base%20de%20datos/apuntes/2021/04/03/Conceptos-basicos-mongodb.html" rel="alternate" type="text/html" title="Conceptos Basicos de Mongodb" /><published>2021-04-03T13:25:45+02:00</published><updated>2021-04-03T13:25:45+02:00</updated><id>http://localhost:4000/base%20de%20datos/apuntes/2021/04/03/Conceptos-basicos-mongodb</id><content type="html" xml:base="http://localhost:4000/base%20de%20datos/apuntes/2021/04/03/Conceptos-basicos-mongodb.html"><![CDATA[<h3 id="introducción"><strong>Introducción</strong></h3>

<p>En este post se va a explicar tanto la instalación y configuración de mongodb ademas de varios de los conceptos basicos como pueden ser el uso de proyecciones y operadores CRUD.</p>

<p>Este post son una serie de explicaciones y apuntes realizados siguiendo varios cursos online. Se usarán varias herramientas como pueden ser mongo shell (cliente de linea de comandos), mongo compass (cliente grafico) y un servidor Atlas de Mongodb (proporcionado en el curso de mongo university).</p>

<h3 id="instalación-de-mongodb-debian-10">Instalación de mongodb (debian 10)</h3>

<p>Para descargar mongodb en debian, necesitaremos tener instalado el paquete gnupg, por lo que si no  lo tenemos, tendremos que instalarlo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install gnupg
</code></pre></div></div>

<p>Como los paquetes que vamos a descargarnos de mongo estan firmados, lo primero que haremos sera importar la clave publica del certificado:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>wget https://www.mongodb.org/static/pgp/server-4.4.asc -qO- | sudo apt-key add -
</code></pre></div></div>

<p>Cuando tengamos la clave en nuestro equipo, añadiremos el repositorio de mongo de la siguiente forma, editamos el fichero /etc/apt/sources.list.d/mongodb-org.list y añadimos la siguiente linea:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>deb http://repo.mongodb.org/apt/debian buster/mongodb-org/4.4 main
</code></pre></div></div>

<p>Una vez que tengamos listo el repositorio, ya podremos instalar mongo en el equipo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>apt install mongodb-org
</code></pre></div></div>

<p>Arrancamos el servicio de forma manual y lo habilitamos para que se inicie automaticamente en el arranque:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systemctl enable --now mongod
</code></pre></div></div>

<p>Ya tendremos mongo instalado y listo para usar.</p>

<h3 id="configuración-basica-y-conexion-de-herramientas">Configuración basica y conexion de herramientas</h3>

<h3 id="mongodb-compass">Mongodb compass</h3>

<p>Compass cuenta con una interfaz visual para MongoDB que permite explorar y gestionar los datos de la base de datos.</p>

<h3 id="mongo-shell">Mongo shell</h3>

<p>La shell de mongo es una interfaz javascript interactiva para mongodb. La shell mongo para consultar y actualizar datos, así como para realizar operaciones administrativas.</p>

<p>Instalación de la shell en Linux</p>

<ul>
  <li>
    <p>Para ello, vamos al centro de descargas de mongodb (https://www.mongodb.com/try/download/shell) y al seleccionar nuestro sistema operativo, descargamos el archivo.</p>
  </li>
  <li>
    <p>Movemos el archivo al directorio principal.</p>
  </li>
  <li>Lo descomprimimos y actualizamos la ruta de la shell.
    <ul>
      <li>Exec bash</li>
    </ul>
  </li>
  <li>
    <p>Abrimos /etc/path (con nano)</p>
  </li>
  <li>
    <p>El terminal pedira una contraseña e introduciremos nuestra contraseña de admin.</p>
  </li>
  <li>
    <p>Accedemos al directorio principal y abrimos la carpeta extraida donde veremos un directorio bin. Copiaremos la ruta del directorio bin en /etc/path.</p>
  </li>
  <li>Comprobamos que la shell funciona sin problemas ejecutando el siguiente comando:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo --nodb
</code></pre></div></div>

<p>Con esto lo que haremos sera iniciar la mongo shell sin necesidad de conectarse a ninguna instancia de mongodb. Si todo funciono correctamente se nos mostrara la version de mongo shell que tenemos instalada.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo --nodb
MongoDB shell version v4.4.4
&gt; 
</code></pre></div></div>

<h3 id="atlas">Atlas</h3>

<p>Atlas es una base de datos de mongodb como solucion de servicio que proporciona funcionalidad para configurar la base de datos en la nube sin necesidad de usar la shell. Tambien maneja las replicas, es decir que mantiene copias redundantes de los datos.</p>

<p>Funcionamiento:</p>

<p>En Atlas los usuarios pueden implementar un cluster, estos servidores configurados en un conjunto de replicas, esto quiere decir que cada vez que se inserte o actualicen los documentos, los cambios se almacenaran de forma redundante.</p>

<p>Uno de los principales motivos para el uso de atlas es lo facil que es de configurar, ademas administra la creacion de clusteres por lo que la implementacion del sistema se hace mucho mas facil.</p>

<p>La interfaz de atlas facilita tanto la administracion e implementacion de mongodb en los proveedores y en la nube.</p>

<p>Para esta introduccion a mongodb se va a usar el nivel gratuito de atlas (en el cual el cluster que podremos usar con 512 mb de almacenamiento nunca caducara).</p>

<p>Inicio atlas:</p>

<p>En colecciones podremos ver los datos que tenemos en nuestro cluster, en colecciones podremos ver todos los documentos dentro de nuestra base de datos asi como buscar documentos especificos. Atlas tambien nos permite configurar usuarios con distintos privilegios.</p>

<p><img src="/images/Mongo-01/inicio_atlas.png" alt="Inicio Atlas" /></p>

<h3 id="conexion-a-mongo-compass">Conexion a Mongo compass</h3>

<p>Mongo Compass es un cliente de mongo al igual que mongo shell, solo que este cuenta con interfaz grafica.</p>

<p>Descargamos compass en el siguiente enlace (https://www.mongodb.com/try/download/compass) es recomendable usar la version estable, o de lo contrario actualizarla una vez instalada.</p>

<p>Al abrir mongo compass, nos debera salir una ventana que ponga “nueva conexion”, esta conexión podemos hacerla de dos formas:</p>

<ul>
  <li>Usando una cadena:</li>
</ul>

<p>Añadimos la siguiente cadena para facilitar la conexión cada vez que entremos en compass.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongodb + srv: // m001-student: m001-mongodb-basics@cluster0-jxeqq.mongodb.net/test
</code></pre></div></div>

<ul>
  <li>Completando los campos individuales:</li>
</ul>

<p>Hacemos clic en “fill in connection fields individually” y pegamos la cadena srv (como la puesta en el caso anterior). Antes de conectarse tendremos que rellenar los siguientes campos:</p>

<p>nombre de host → nombre de nuestro cluster.
puerto → por defecto mongo utiliza el 27017.
autentificacion → username/password
nombre de usuario → por defecto m001-student
contraseña del usuario → por defecto m001-mongodb-basics
base de datos de autentificacion → admin</p>

<p>Mas opciones:</p>

<p>Replica set name → cluster0-shard-0
Read preference → Primary preferred
ssl → system ca/atlas deployment
ssh tunel → none</p>

<p>En mi caso me conecte usando la cadena ya que es mas facil a la hora de entrar varias veces:</p>

<p><img src="/images/Mongo-01/compass.png" alt="Mongo compass conexion" /></p>

<p><img src="/images/Mongo-01/compass2.png" alt="Mongo compass" /></p>

<h3 id="conexion-de-cluster-con-mongo-compass">Conexion de cluster con Mongo Compass</h3>

<p>En la ventana de cluster sandbox al igual que cuando conectamos atlas a mongo shell, hacemos clic en “connect”, pero esta vez eligiendo la opcion “connect using mongodb compass”.</p>

<p>En el caso de no tenerlo instalado, elegimos la opcion “i do not have mongodb compass” lo descargamos e instalamos, pero como no es este caso, copiamos la cadena que se nos da en mongo compass cambiando la parte <password> por nuestra contraseña y ya tendremos conectado nuestro cluster con mongo compass.</password></p>

<p><img src="/images/Mongo-01/compass-cluster.png" alt="Compass conectado al cluster" /></p>

<h3 id="panel-principal-de-mongo-compass">Panel principal de mongo compass</h3>

<p>En este panel principal podemos ver todas las bases de datos con las que contamos en el cluster. En mongodb una base de datos sirve como espacio de nombres para las colecciones, las colecciones almacenan los registros individuales o documentos. Hacemos referecia a una colección poniendo primero el nombre de la base de datos a la que pertenece,“.” y el nombre de la colección. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>city.neighborhoods
</code></pre></div></div>

<p>Ademas de el listados de las bases de datos con las que contamos, podremos ver el tamaño que ocupa cada una, el numero de colecciones que contiene y los indices que contienen dichas direcciones.</p>

<h3 id="colecciones-en-compass">Colecciones en compass</h3>

<p>En el menu izquierdo, hacemos clic sobre una de las bases de datos que queramos explorar y despues hacemos clic en la colección, por ejemplo videos.movies. La pestaña schema es bastante util ya que nos proporciona una lista de campos encontrados en documentos de la colección como por ejemplo los id de las peliculas, director, genre (genero), etc.</p>

<p>En la pestaña documents, encontraremos una lista de documentos que componen esa colección. Mas adelante podremos ver como insertar datos nuevos, actualizarlos, filtrarlos, etc.</p>

<p>En los documentos de mongo, podemos encontrarnos valores:</p>

<ul>
  <li>
    <p>Escalables, como las cadenas/strings.</p>
  </li>
  <li>
    <p>Enteros y dobles</p>
  </li>
  <li>
    <p>Anidaciones de documentos → es el valor de un documento dentro de otro. Por ejemplo, en base de datos de temperaturas al ver la temperatura del aire encontramos dos campos, calidad que es string y temperatura que es number.</p>
  </li>
  <li>
    <p>Matrices o arrays → campos que contienen un conjunto particular de campos suplementarios. Estos campos suplementarios se indican con un indice numerico, por lo que a la hora de filtrar la busqueda se hace muy facil.</p>
  </li>
</ul>

<p>Estos dos ultimos tipos, anidacion y matrices pueden encontrarse juntos como en el siguiente ejemplo:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>skycoverlayer o position
</code></pre></div></div>

<h3 id="consultas-mongo-compass">Consultas mongo compass</h3>

<p>En mongo compass una de las formas que tenemos de filtrar documentos, es poner en el apartado “Filter” una consulta, por ejemplo usando la colección tips de la base de datos citibike:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'end station name': 'Broadway &amp; E 22 St'}
</code></pre></div></div>

<p>Las consultas que se hagan para filtrar siempre deben ir entre llaves, en ese caso estamos filtrando para que se muestren todos los documentos en los que la estacion final, el nombre tenga el valor Brodway y East 22 street. En este caso el filtro aplicado es un filtro de igualdad, lo que quiere decir que filtrara todos los documentos donde el nombre de la estacion final sea Brodway &amp; East 22 street.</p>

<p>Otro tipo de filtros es el filtrado por rangos, por ejemplo mostrar los documentos en los que el ciclista haya nacido entre 1985 y 1990:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{'birth year': {$gte: 1985,$lt: 1990}}
</code></pre></div></div>

<p>En este caso para filtrar por un rango se utilizan los operadores, indicandolos con “$”.</p>

<h3 id="conexion-mongo-shell---atlas">Conexion Mongo shell - Atlas</h3>

<p>Para esta conexión usaremos el siguiente comando:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo "mongodb+srv://cluster0-jxeqq.mongodb.net/test" --username m001-student -password m001-mongodb-basics
</code></pre></div></div>

<p>El resultado sera algo como esto:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB shell version v4.4.4
connecting to: mongodb://cluster0-shard-00-01-jxeqq.mongodb.net:27017,cluster0-shard-00-02-jxeqq.mongodb.net:27017,cluster0-shard-00-00-jxeqq.mongodb.net:27017/test?authSource=admin&amp;compressors=disabled&amp;gssapiServiceName=mongodb&amp;replicaSet=Cluster0-shard-0&amp;ssl=true
Implicit session: session { "id" : UUID("030690e8-f6dc-43b1-b66a-a8b49baee295") }
MongoDB server version: 4.2.12
WARNING: shell and server versions do not match
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; 
</code></pre></div></div>

<p>En este caso nos salta un error ya que la shell descargada y el server son de versiones distintas (4.4.4.) y (4.2.12), pero aun asi podemos acceder sin problemas al nodo principal del cluster.</p>

<p>En el caso de que no funcione, probar este otro:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mongo "mongodb://cluster0-shard-00-00-jxeqq.mongodb.net:27017,cluster0-shard-00-01-jxeqq.mongodb.net:27017,cluster0-shard-00-02-jxeqq.mongodb.net:27017/test?replicaSet=Cluster0-shard-0" --authenticationDatabase admin --ssl --username m001-student --password m001-mongodb-basics
</code></pre></div></div>

<h3 id="conexion-atlas---mongo-shell">Conexion Atlas - Mongo shell</h3>

<ol>
  <li>Iniciar sesion en el cluster Atlas</li>
  <li>En la ventana “clusters” hacer clic en “connect”</li>
</ol>

<p><img src="/images/Mongo-01/connect_atlas.png" alt="Atlas cluster" /></p>

<ol>
  <li>Una vez le demos a connect, elegimos la opcion “connect with the mongo shell”.</li>
  <li>Elegimos “i have the mongo shell instaled” en caso de tener mongo shell ya instalado en el equipo y copiamos el comando que se nos da.</li>
  <li>Pegamos el comando en la terminal.</li>
  <li>Añadimos la opcion de password al comando obtenido anteriormente y comprobamos el acceso.</li>
</ol>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~$ mongo "mongodb+srv://cluster0.hqn5x.mongodb.net/myFirstDatabase" --username m001-student --password m001-mongodb-basics
MongoDB shell version v4.4.4
connecting to: mongodb://cluster0-shard-00-01.hqn5x.mongodb.net:27017,cluster0-shard-00-02.hqn5x.mongodb.net:27017,cluster0-shard-00-00.hqn5x.mongodb.net:27017/myFirstDatabase?authSource=admin&amp;compressors=disabled&amp;gssapiServiceName=mongodb&amp;replicaSet=Cluster0-shard-0&amp;ssl=true
Implicit session: session { "id" : UUID("07c7b3ff-c7fe-493d-91a4-07777d316bff") }
MongoDB server version: 4.4.4
Welcome to the MongoDB shell.
For interactive help, type "help".
For more comprehensive documentation, see
	https://docs.mongodb.com/
Questions? Try the MongoDB Developer Community Forums
	https://community.mongodb.com
Error while trying to show server startup warnings: user is not allowed to do action [getLog] on [admin.]
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; 
</code></pre></div></div>

<p>Si es como en este caso y nos sale “MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; ” significara que nos hemos podido conectar correctamente.</p>

<h3 id="carga-de-datos-en-atlas">Carga de datos en Atlas</h3>

<p>Comandos mongo shell:</p>

<ul>
  <li>Ver bases de datos → show dbs</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; show dbs
admin     0.000GB
local     3.784GB
</code></pre></div></div>

<ul>
  <li>Carga de datos:</li>
</ul>

<p>En mi caso al realizar el curso de mongodb, cargue un fichero de una base de datos llamada videos con colecciones de peliculas (parecido a la base da datos de peliculas que se ha visto anteriormente con mongo compass). Al descargar el fichero zip los descomprimi en un directorio que hice para tenerlo organizado y bien ubicado y cargue la base de datos al cluster ejecutando load(“nombre del fichero.js”).</p>

<p>Una vez cargado, volvemos a ejecutar show dbs al igual que antes y comprobamos si se ha cargadao correctamente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; show dbs
admin     0.000GB
local     3.784GB
video     0.001GB
</code></pre></div></div>

<p>Para acceder a los datos de la base de datos, usamos primero la base de datos, despues vemos las colecciones que hay y por ultimo realizamos una busqueda usando la colección:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; use video
switched to db video
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; show collections
movieDetails
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find().pretty()
{
	"_id" : ObjectId("5e7754bbff453565d25411a9"),
	"title" : "Slow West",
	"year" : 2015,
	"rated" : "R",
	"runtime" : 84,
	"countries" : [
		"UK",
		"New Zealand"
	],
	"genres" : [
		"Action",
		"Thriller",
		"Western"
	],
	"director" : "John Maclean",
	"writers" : [
		"John Maclean"
	],
	"actors" : [
		"Kodi Smit-McPhee",
		"Michael Fassbender",
		"Ben Mendelsohn",
		"Aorere Paki"
	],
	"plot" : "A young Scottish man travels across America in pursuit of the woman he loves, attracting the attention of an outlaw who is willing to serve as a guide.",
	"poster" : "http://ia.media-imdb.com/images/M/MV5BNTYxNDA5ODk5NF5BMl5BanBnXkFtZTgwNzMwMzIwNTE@._V1_SX300.jpg",
	"imdb" : {
		"id" : "tt3205376",
		"rating" : 7,
		"votes" : 19101
	},
	"tomato" : {
		"meter" : 92,
		"image" : "certified",
		"rating" : 7.5,
		"reviews" : 115,
		"fresh" : 106,
		"consensus" : "Slow West serves as an impressive calling card for first-time writer-director John M. Maclean -- and offers an inventive treat for fans of the Western.",
		"userMeter" : 75,
		"userRating" : 3.7,
		"userReviews" : 9850
	},
	"metacritic" : 72,
	"awards" : {
		"wins" : 2,
		"nominations" : 9,
		"text" : "2 wins &amp; 9 nominations."
	},
	"type" : "movie"
}
{
	"_id" : ObjectId("5e7754bbff453565d25411d4"),
	"title" : "The Adventures of Buckaroo Banzai Across the 8th Dimension",
	"year" : 1984,
	"rated" : "PG",
	"runtime" : 103,
	"countries" : [
		"USA"
	],
	"genres" : [
		"Adventure",
		"Comedy",
		"Romance"
	],
	"director" : "W.D. Richter",
	"writers" : [
		"Earl Mac Rauch"
	],
	"actors" : [
		"Peter Weller",
		"John Lithgow",
		"Ellen Barkin",
		"Jeff Goldblum"
	],
	"plot" : "Adventurer/surgeon/rock musician Buckaroo Banzai and his band of men, the Hong Kong Cavaliers, take on evil alien invaders from the 8th dimension.",
	"poster" : "http://ia.media-imdb.com/images/M/MV5BMTk3OTAwNDQwOF5BMl5BanBnXkFtZTgwOTE0MzQxMDE@._V1_SX300.jpg",
	"imdb" : {
		"id" : "tt0086856",
		"rating" : 6.4,
		"votes" : 17154
	},
	"awards" : {
		"wins" : 0,
		"nominations" : 5,
		"text" : "5 nominations."
	},
	"type" : "movie"
}
{
	"_id" : ObjectId("5e7754bbff453565d25411ac"),
	"title" : "How the West Was Won",
	"year" : 1962,
	"rated" : "APPROVED",
	"runtime" : 164,
	"countries" : [
		"USA"
	],
	"genres" : [
		"Western"
	],
	"director" : "John Ford, Henry Hathaway, George Marshall, Richard Thorpe",
	"writers" : [
		"James R. Webb"
	],
	"actors" : [
		"Carroll Baker",
		"Lee J. Cobb",
		"Henry Fonda",
		"Carolyn Jones"
	],
	"plot" : "A family saga covering several decades of Westward expansion in the nineteenth century--including the Gold Rush, the Civil War, and the building of the railroads.",
	"poster" : "http://ia.media-imdb.com/images/M/MV5BNTk2NDk1NjY0MV5BMl5BanBnXkFtZTgwMzkzNTcxMTE@._V1_SX300.jpg",
	"imdb" : {
		"id" : "tt0056085",
		"rating" : 7.1,
		"votes" : 13640
	},
	"awards" : {
		"wins" : 7,
		"nominations" : 5,
		"text" : "Won 3 Oscars. Another 7 wins &amp; 5 nominations."
	},
	"type" : "movie"
}
...
Type "it" for more
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt;
</code></pre></div></div>

<h3 id="que-es-mongodb">¿Que es mongodb?</h3>

<p>Mongodb es una base de datos de documentos en el que sera necesarios cierto nivel de comprension de json para su uso, ya que tanto los el lenguaje de los documentos que usa la base de datos, asi como gran parte de la administracion de mongo, se hace en formato json.</p>

<p>Hay dos tipos de datos con los que trabajaremos en mongodb:</p>

<ul>
  <li>
    <p>Datos simples</p>

    <ul>
      <li>números → enteros (negativos y positivos), decimales, etc…</li>
      <li>cadenas de texto</li>
      <li>fecha</li>
      <li>hora</li>
      <li>boleanos</li>
    </ul>
  </li>
  <li>
    <p>Datos Complejos</p>

    <ul>
      <li>arrays → listas</li>
      <li>objetos → documento incrustado o añadido en el documento principal.</li>
      <li>binarios → almacenar elementos multimedia</li>
      <li>objectid → clave unica que asigna mongo a cada documento si el usuario no la especifica.</li>
      <li>expresiones regulares</li>
    </ul>
  </li>
</ul>

<h3 id="conceptos-basicos-de-operaciones-crud-create-read-delete-update">Conceptos basicos de operaciones CRUD (Create Read Delete Update)</h3>

<h3 id="create">Create</h3>

<p>En mongodb se entiende a crear operaciones como la insercion de documentos o simplemente hacer inserciones.</p>

<p>Inserción de colecciones y documentos:</p>

<ul>
  <li>Mongo compass</li>
</ul>

<p>Usando la vista de la base de datos en compas, podemos crear una colección simplemente haciendo clic en alguna base de datos que tengamos, y despues haciendo clic en “create collection”. Por ejemplo en la base de datos peliculas, he creado la colección peliculas_prueba.</p>

<p>Al crear una nueva colección obviamente estara vacia, pero con compass podemos insertar un documento de forma sencilla haciendo clc en “add data” → “insert document”.</p>

<p><img src="/images/Mongo-01/ejemplo_insert.png" alt="insercion de documentos" /></p>

<p>Creamos un pequeño documento a modo de prueba.</p>

<ul>
  <li>Mongo shell</li>
</ul>

<p>En mongo shell podemos realizar la misma insercion de datos que en compass, pero al no tener entorno grafico esto se hara a traves del uso de los metodos, concretamente el metodo insertOne, que es un metodo de colecciones.</p>

<p>Para usar insertOne, primero tendremos que especificar la base de datos a usar, en este caso como ejemplo se usara la base de datos de videos, y una vez especificada insertamos el documento. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; show databases
admin     0.000GB
local     3.837GB
practica  0.002GB
video     0.001GB
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; use video
switched to db video
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; show collections
movieDetails
peliculas_prueba
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.peliculas_prueba.insertOne({title: "Rogue One", year: 2016})
{
	"acknowledged" : true,
	"insertedId" : ObjectId("605b1d03653110148a9b1edf")
}
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.peliculas_prueba.find().pretty()
{
	"_id" : ObjectId("605b14c6798aa68ea3f5e7cd"),
	"title" : "The Avengers EndGame",
	"year" : 2019
}
{
	"_id" : ObjectId("605b1993798aa68ea3f5e7ce"),
	"title" : "Raya",
	"year" : 2021
}
{
	"_id" : ObjectId("605b1d03653110148a9b1edf"),
	"title" : "Rogue One",
	"year" : 2016
}
</code></pre></div></div>

<p>Con este mismo metodo, si la colección peliculas_prueba no existiese se crearia de forma automatica al crear el documento.</p>

<p>Como se puede ver en el ejemplo anterior, si no especificamos ningun id (todo objeto en la colección debe tener un identificador unico), el propio mongo o el cliente que se este usando le especifica uno por defecto. En el caso de introducir manualmente la id, tendremos que asegurarnos de que no se repita en ningun momento en la colección, sino nos saltara un mensaje de error como “duplicate key error collection”.</p>

<p>Seguramente, despues de ver el ejemplo de insertOne mas de uno piense por ejemplo ¿y si por ejemplo quiero una base de datos para saber que canciones o videojuegos tengo? ¿que hago un insertOne por cada uno de ellos?</p>

<p>Pues no, para ello mongo cuenta con otro metodo llamado insertMany, con el que es posible insertar varios documentos a la vez. Ej:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.peliculas_prueba.insertMany([{title: "Star Wars: Episodio I - La amenaza fantasma", year: 1999}, {title: "Star Wars: Episodio II - El ataque de los clones", year: 2002}, {title: "Star Wars: Episodio III - La venganza de los Sith", year: 2005}])

{
	"acknowledged" : true,
	"insertedIds" : [
		ObjectId("605b21f2653110148a9b1ee3"),
		ObjectId("605b21f2653110148a9b1ee4"),
		ObjectId("605b21f2653110148a9b1ee5")
	]
}
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.peliculas_prueba.find().pretty()
{
	"_id" : ObjectId("605b14c6798aa68ea3f5e7cd"),
	"title" : "The Avengers EndGame",
	"year" : 2019
}
{
	"_id" : ObjectId("605b1993798aa68ea3f5e7ce"),
	"title" : "Raya",
	"year" : 2021
}
{
	"_id" : ObjectId("605b1d03653110148a9b1edf"),
	"title" : "Rogue One",
	"year" : 2016
}
{
	"_id" : ObjectId("605b21f2653110148a9b1ee3"),
	"title" : "Star Wars: Episodio I - La amenaza fantasma",
	"year" : 1999
}
{
	"_id" : ObjectId("605b21f2653110148a9b1ee4"),
	"title" : "Star Wars: Episodio II - El ataque de los clones",
	"year" : 2002
}
{
	"_id" : ObjectId("605b21f2653110148a9b1ee5"),
	"title" : "Star Wars: Episodio III - La venganza de los Sith",
	"year" : 2005
}
</code></pre></div></div>

<p>InsertMany hace una insercion ordenada de los datos por defecto, lo que significa que si por ejemplo introducimos 10 documentos, si al insertar salta un error en el documento 4 por ejemplo, solo se introducen los 3 primeros. Esto podemos cambiarlo haciendo que insertMany no haga una insercion ordenada, sino una insercion desordenada.</p>

<p>Para cambiar la forma de actuar del metodo insertMany, itroducimos la siguiente instrucción en la insercion:</p>

<p>{“ordered”: false}</p>

<p>De esta forma, aunque salgan errores, insertMany continuara insertando documentos.</p>

<h3 id="read">Read</h3>

<h3 id="filtros">Filtros</h3>

<ul>
  <li>Filtros de igualdad:</li>
</ul>

<p>Anteriormente vimos ya algún ejemplo de filtro de igualdad, ahora veremos varios ejemplos de filtros tanto en compass como en shell:</p>

<p><strong>Compass</strong></p>

<p>En el caso de compass la consulta es bastante sencilla ya que simplemente tendremos que introducir la consulta y hacer clic en filtrar. Por ejemplo filtraremos en la base de datos de peliculas las que esten calificadas como PG-13.</p>

<p>Si en lugar de un valor de busqueda ponemos varios, solo se mostraran aquellos documentos que contengan ambos valores.</p>

<p><strong>Shell</strong></p>

<p>En shell utilizamos para el filtro de igualdad el metodo find, este metodo ya se ha usado anteriormente. Como ejemplo realizaremos la misma consulta que en compass.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; use video
switched to db video
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({mpaaRating: "PG-13"})
{ "_id" : ObjectId("58c59c6c99d4ee0af9e10b9d"), "title" : "Wings", "year" : 1927, "imdbId" : "tt0018578", "mpaaRating" : "PG-13", "genre" : "Drama, Romance, War", "viewerRating" : 7.8, "viewerVotes" : 7196, "runtime" : 144, "director" : "William A. Wellman, Harry d'Abbadie d'Arrast", "cast" : [ "Clara Bow", "Charles 'Buddy' Rogers", "Richard Arlen", "Jobyna Ralston" ], "plot" : "Two young men, one rich, one middle class, who are in love with the same woman, become fighter pilots in World War I.", "language" : "English" }
{ "_id" : ObjectId("58c59c6d99d4ee0af9e14d35"), "title" : "Kate &amp; Leopold", "year" : 2001, "imdbId" : "tt0035423", "mpaaRating" : "PG-13", "genre" : "Comedy, Fantasy, Romance", "viewerRating" : 6.3, "viewerVotes" : 59951, "runtime" : 118, "director" : "James Mangold", "cast" : [ "Meg Ryan", "Hugh Jackman", "Liev Schreiber", "Breckin Meyer" ], "plot" : "Kate and her actor brother live in N.Y. in the 21st Century. Her ex-boyfriend, Stuart, lives above her apartment. Stuart finds a space near the Brooklyn Bridge where there is a gap in time....", "language" : "English, French" }
{ "_id" : ObjectId("58c59c6f99d4ee0af9e17da0"), "title" : "Rebel Without a Cause", "year" : 1955, "imdbId" : "tt0048545", "mpaaRating" : "PG-13", "genre" : "Drama", "viewerRating" : 7.8, "viewerVotes" : 58627, "runtime" : 111, "director" : "Nicholas Ray", "cast" : [ "James Dean", "Natalie Wood", "Sal Mineo", "Jim Backus" ], "plot" : "A rebellious young man with a troubled past comes to a new town, finding friends and enemies.", "language" : "English" }
…
</code></pre></div></div>

<p>De esta forma se ve muy mal la informacion, para que se vea mejor usamos .pretty()</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({mpaaRating: "PG-13"}).pretty()
{
	"_id" : ObjectId("58c59c6c99d4ee0af9e10b9d"),
	"title" : "Wings",
	"year" : 1927,
	"imdbId" : "tt0018578",
	"mpaaRating" : "PG-13",
	"genre" : "Drama, Romance, War",
	"viewerRating" : 7.8,
	"viewerVotes" : 7196,
	"runtime" : 144,
	"director" : "William A. Wellman, Harry d'Abbadie d'Arrast",
	"cast" : [
		"Clara Bow",
		"Charles 'Buddy' Rogers",
		"Richard Arlen",
		"Jobyna Ralston"
	],
	"plot" : "Two young men, one rich, one middle class, who are in love with the same woman, become fighter pilots in World War I.",
	"language" : "English"
}
{
	"_id" : ObjectId("58c59c6d99d4ee0af9e14d35"),
	"title" : "Kate &amp; Leopold",
	"year" : 2001,
	"imdbId" : "tt0035423",
	"mpaaRating" : "PG-13",
	"genre" : "Comedy, Fantasy, Romance",
	"viewerRating" : 6.3,
	"viewerVotes" : 59951,
	"runtime" : 118,
	"director" : "James Mangold",
	"cast" : [
		"Meg Ryan",
		"Hugh Jackman",
		"Liev Schreiber",
		"Breckin Meyer"
	],
	"plot" : "Kate and her actor brother live in N.Y. in the 21st Century. Her ex-boyfriend, Stuart, lives above her apartment. Stuart finds a space near the Brooklyn Bridge where there is a gap in time....",
	"language" : "English, French"
}
</code></pre></div></div>

<p>En el caso de no introducir ningun parametro en el filtro con find, se mostraran todos los documentos de la colección. Hay algunos casos en los que a lo mejor queremos filtrar algo que a su vez se divide en varios campos. Este caso lo podemos encontrar varias veces en la base de datos del tiempo como por ejemplo el viento que a su vez tiene el campo type por lo que si queremos filtrar por tipo de viento seria de la siguiente forma:</p>

<p><strong>Compass</strong></p>

<p><img src="/images/Mongo-01/filtro1.png" alt="Primer filtro" /></p>

<p><strong>Shell</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; use 100YWeatherSmall
switched to db 100YWeatherSmall
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.data.find({"wind.type": "N"}).pretty()
{
	"_id" : ObjectId("5553a98ce4b02cf7150dee3c"),
	"st" : "x-00700+086000",
	"ts" : ISODate("1984-01-01T00:00:00Z"),
	"position" : {
		"type" : "Point",
		"coordinates" : [
			86,
			-0.7
		]
	},
	"elevation" : 9999,
	"callLetters" : "PHQK",
	"qualityControlProcess" : "V020",
	"dataSource" : "4",
	"type" : "FM-13",
	"airTemperature" : {
		"value" : 27.5,
		"quality" : "1"
	},
	"dewPoint" : {
		"value" : 999.9,
		"quality" : "9"
	},
	"pressure" : {
		"value" : 1012.2,
		"quality" : "1"
	},
	"wind" : {
		"direction" : {
			"angle" : 290,
			"quality" : "1"
		},
		"type" : "N",
		"speed" : {
			"rate" : 2.6,
			"quality" : "1"
		}
	},
	"visibility" : {
		"distance" : {
			"value" : 20000,
			"quality" : "1"
		},
	...
</code></pre></div></div>

<p>A esta forma de filtrar se le llama notación de puntos y este tipo de filtro se puede usar tanto para filtrar campos dentro de un objeto así como para filtrar en campos anidados.</p>

<h3 id="filtrado-en-listas">Filtrado en listas</h3>

<p>Para filtrar en una lista utilizamos los índices. Por ejemplo en la base de datos de películas tenemos varias listas en el campo cast (reparto), en el ejemplo se mostraran todas las peliculas en el que en el reparto Jeff Bridges sea el primero de la lista.</p>

<p><strong>Compass</strong></p>

<p><img src="/images/Mongo-01/filtros5.png" alt="Filtrado de lista" /></p>

<p><strong>Shell</strong></p>

<p>En la shell se filtra de igual forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; use video
switched to db video
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({"cast.0": "Jeff Bridges"}).pretty()
{
	"_id" : ObjectId("58c59c7199d4ee0af9e1c2ee"),
	"title" : "Bad Company",
	"year" : 1972,
	"imdbId" : "tt0068245",
	"mpaaRating" : "PG",
	"genre" : "Drama, Western",
	"viewerRating" : 7.1,
	"viewerVotes" : 2423,
	"runtime" : 93,
	"director" : "Robert Benton",
	"cast" : [
		"Jeff Bridges",
		"Barry Brown",
		"Jim Davis",
		"David Huddleston"
	],
	"plot" : "A god-fearing Ohio boy dodging the Civil War draft arrives in Jefferson City where he joins up with a hardscrabble group of like runaways heading west.",
	"language" : "English"
}
{
	"_id" : ObjectId("58c59c7199d4ee0af9e1ca26"),
	"title" : "The Last American Hero",
	"year" : 1973,
	"imdbId" : "tt0070287",
	"mpaaRating" : "PG",
	"genre" : "Drama, Sport",
	"viewerRating" : 6.3,
	"viewerVotes" : 1016,
	"runtime" : 95,
	"director" : "Lamont Johnson",
	"cast" : [
		"Jeff Bridges",
		"Valerie Perrine",
		"Geraldine Fitzgerald",
		"Ned Beatty"
	],
	"plot" : "A young hellraiser quits his moonshine business to try to become the best NASCAR racer the south had ever seen.",
	"language" : "English"
}
…
</code></pre></div></div>

<h3 id="cursores">Cursores</h3>

<p>Los métodos de búsqueda como find, devuelven cursores. Los cursores son básicamente un puntero a la ubicación actual en un conjunto de resultados.</p>

<p>En mongo shell el cursor se itera de forma automática mostrando los primeros 20 resultados. En el caso de necesitar mostrar mas resultados de busqueda, la shell proporciona un 
“metodo” para mostrar los siguientes 20 resultados, esto se haria escribiendo “it” (abreviatura de iterar) al mostrar los primeros resultados, de esta forma podemos iterar un conjunto completo de resultados de busqueda.</p>

<h3 id="proyecciones">Proyecciones</h3>

<p>Las proyecciones la sobrecarga y el procesamiento de la red requisitos, limitando los campos que son devueltos en los documentos de resultados.</p>

<p>Por defecto mongodb devuelve todos los campos en todos los documentos que coinciden con las consultas.</p>

<p>Las proyecciones son un segundo argumento al argumento de busqueda, por ejemplo si en lugar de mostrar todos los datos de todas las peliculas de un genero en especifico, solo queremos mostrar los titulos, esto se haria de la siguiente forma:</p>

<p><strong>Shell</strong></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({genre: "Action"}, {title: 1})
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d24c"), "title" : "The Exploits of Elaine" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d2f1"), "title" : "The Hazards of Helen" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d3ce"), "title" : "Lucille Love: The Girl of Mystery" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d486"), "title" : "The Perils of Pauline" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d836"), "title" : "The Girl and the Game" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfbc"), "title" : "The Shielding Shadow" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e0d5"), "title" : "The Yellow Menace" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfa6"), "title" : "The Secret of the Submarine" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfa3"), "title" : "The Scarlet Runner" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e20c"), "title" : "The Fatal Ring" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e42b"), "title" : "The Purple Mask" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e991"), "title" : "The Adventures of Ruth" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e702"), "title" : "The House of Hate" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ea70"), "title" : "Elmo, the Mighty" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0eb83"), "title" : "The Lion Man" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee14"), "title" : "The Branded Four" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0eeac"), "title" : "The Evil Eye" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee92"), "title" : "The Dragon's Net" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee68"), "title" : "Daredevil Jack" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0efb2"), "title" : "King of the Circus" }
Type "it" for more
</code></pre></div></div>

<p>Vemos como en lugar de mostrar toda la información, solo muestra la id (por defecto) y el titulo, que es lo que hemos especificado. Tambien vemos lo explicado anteriormente en los cursores, el “it”, si escribimos it obtenemos los siguientes 20 titulos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({genre: "Action"}, {title: 1})
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d24c"), "title" : "The Exploits of Elaine" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d2f1"), "title" : "The Hazards of Helen" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d3ce"), "title" : "Lucille Love: The Girl of Mystery" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d486"), "title" : "The Perils of Pauline" }
{ "_id" : ObjectId("58c59c6a99d4ee0af9e0d836"), "title" : "The Girl and the Game" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfbc"), "title" : "The Shielding Shadow" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e0d5"), "title" : "The Yellow Menace" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfa6"), "title" : "The Secret of the Submarine" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0dfa3"), "title" : "The Scarlet Runner" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e20c"), "title" : "The Fatal Ring" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e42b"), "title" : "The Purple Mask" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e991"), "title" : "The Adventures of Ruth" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0e702"), "title" : "The House of Hate" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ea70"), "title" : "Elmo, the Mighty" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0eb83"), "title" : "The Lion Man" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee14"), "title" : "The Branded Four" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0eeac"), "title" : "The Evil Eye" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee92"), "title" : "The Dragon's Net" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0ee68"), "title" : "Daredevil Jack" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0efb2"), "title" : "King of the Circus" }
Type "it" for more
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; it
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0efef"), "title" : "The Mystery of 13" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f16a"), "title" : "The Whirlwind" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f22a"), "title" : "Cameron of the Royal Mounted" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f223"), "title" : "Cold Steel" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f5ac"), "title" : "The Boss of Camp Four" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f3b6"), "title" : "Miracles of the Jungle" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f485"), "title" : "The Secret Four" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f557"), "title" : "The Yellow Arm" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f623"), "title" : "The Cub Reporter" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f6a3"), "title" : "Great Alone" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f9c0"), "title" : "The Eagle's Talons" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f7fb"), "title" : "Reckless Chances" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f845"), "title" : "Smiles Are Trumps" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0f843"), "title" : "Speed" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0fbd2"), "title" : "The Thrill Chaser" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0fd22"), "title" : "Dynamite Dan" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0fc6a"), "title" : "American Manners" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0fced"), "title" : "The Cyclone Rider" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e0fd3d"), "title" : "A Fighting Heart" }
{ "_id" : ObjectId("58c59c6b99d4ee0af9e10109"), "title" : "The Great Jewel Robbery" }
</code></pre></div></div>

<p>En las proyecciones se usa el valor 1 para incluir campos a la busqueda y el valor 0 para excluir campos de la busqueda, por lo que si quisieramos quitar el id de la busqueda anterior podriamos hacerlo de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movies.find({genre: "Action"}, {title: 1, _id: 0})
{ "title" : "The Exploits of Elaine" }
{ "title" : "The Hazards of Helen" }
{ "title" : "Lucille Love: The Girl of Mystery" }
{ "title" : "The Perils of Pauline" }
{ "title" : "The Girl and the Game" }
{ "title" : "The Shielding Shadow" }
{ "title" : "The Yellow Menace" }
{ "title" : "The Secret of the Submarine" }
{ "title" : "The Scarlet Runner" }
{ "title" : "The Fatal Ring" }
{ "title" : "The Purple Mask" }
{ "title" : "The Adventures of Ruth" }
{ "title" : "The House of Hate" }
{ "title" : "Elmo, the Mighty" }
{ "title" : "The Lion Man" }
{ "title" : "The Branded Four" }
{ "title" : "The Evil Eye" }
{ "title" : "The Dragon's Net" }
{ "title" : "Daredevil Jack" }
{ "title" : "King of the Circus" }
</code></pre></div></div>

<h3 id="operadores-de-mongodb">Operadores de Mongodb</h3>

<ul>
  <li>
    <p>Operadores de comparacion: Como su propio nombre indica, nos permiten comparar dos valores en una consulta.</p>

    <ul>
      <li>$gt (mayor que): se utiliza para hacer una consulta comparando un campo de los documentos de la colección con uno mayor. Por ejemplo, mostrar el titulo de todas las peliculas que duren mas de 90 min:</li>
    </ul>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>      MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({runtime: {$gt: 90}}, {_id: 0, title: 1, runtime: 1})
      { "title" : "Once Upon a Time in the West", "runtime" : 175 }
      { "title" : "A Million Ways to Die in the West", "runtime" : 116 }
      { "title" : "Wild Wild West", "runtime" : 106 }
      { "title" : "West Side Story", "runtime" : 152 }
      { "title" : "Red Rock West", "runtime" : 98 }
      { "title" : "How the West Was Won", "runtime" : 164 }
      { "title" : "Journey to the West", "runtime" : 110 }
      { "title" : "West of Memphis", "runtime" : 147 }
      { "title" : "Star Wars: Episode IV - A New Hope", "runtime" : 121 }
      { "title" : "Star Wars: Episode V - The Empire Strikes Back", "runtime" : 124 }
      { "title" : "Star Wars: Episode VI - Return of the Jedi", "runtime" : 131 }
      { "title" : "Star Wars: Episode I - The Phantom Menace", "runtime" : 136 }
      { "title" : "Star Wars: Episode III - Revenge of the Sith", "runtime" : 140 }
      { "title" : "Star Trek", "runtime" : 127 }
      { "title" : "Star Wars: Episode II - Attack of the Clones", "runtime" : 142 }
      { "title" : "Star Trek Into Darkness", "runtime" : 132 }
      { "title" : "Star Trek: First Contact", "runtime" : 111 }
      { "title" : "Star Trek II: The Wrath of Khan", "runtime" : 113 }
      { "title" : "Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb", "runtime" : 95 }
      { "title" : "Love Actually", "runtime" : 135 }
      Type "it" for more
</code></pre></div>    </div>
  </li>
</ul>

<p>Como vemos, todas las peliculas que se muestran tienen una duracion mayor de 90 min. De la misma forma que existe $gt, tambien existe $lt (menor que), que se usar para filtrar por valores inferiores. Haciendo uso de los dos a la vez podemos ser capaces de filtrar en un rango, por ejemplo, peliculas que duren mas de 90 min, y menos de 100.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({runtime: {$gt: 90, $lt: 100}}, {_id: 0, title: 1, runtime: 1})
{ "title" : "Red Rock West", "runtime" : 98 }
{ "title" : "Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb", "runtime" : 95 }
{ "title" : "Punch-Drunk Love", "runtime" : 95 }
{ "title" : "From Paris with Love", "runtime" : 92 }
{ "title" : "I Love You Phillip Morris", "runtime" : 98 }
{ "title" : "2001: A Space Travesty", "runtime" : 99 }
{ "title" : "The Adventures of Sharkboy and Lavagirl 3-D", "runtime" : 93 }
{ "title" : "The Adventures of Rocky &amp; Bullwinkle", "runtime" : 92 }
{ "title" : "Shaun of the Dead", "runtime" : 99 }
{ "title" : "Evil Dead", "runtime" : 91 }
{ "title" : "Night of the Living Dead", "runtime" : 96 }
{ "title" : "Treasure Planet", "runtime" : 95 }
{ "title" : "Planet 51", "runtime" : 91 }
{ "title" : "Forbidden Planet", "runtime" : 98 }
{ "title" : "Beneath the Planet of the Apes", "runtime" : 95 }
{ "title" : "Alien Nation", "runtime" : 91 }
{ "title" : "Alien Autopsy", "runtime" : 95 }
{ "title" : "Diary of a Wimpy Kid", "runtime" : 94 }
{ "title" : "Trail of the Pink Panther", "runtime" : 96 }
{ "title" : "Crossfire Trail", "runtime" : 92 }
Type "it" for more
</code></pre></div></div>

<p>Sin embargo, este filtro muestra solo las que duran mas de 90 y menos de 100, es decir, si una pelicula dura 90 min o 100 min, no aparecera ya que solo se muestran valores superiores e inferiores. Para incluir a las peliculas de 90 y 100 min, usamos los operadores $gte (mayor o igual que) y $lt3 (menor o igual que):</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({runtime: {$gte: 90, $lte: 100}}, {_id: 0, title: 1, runtime: 1})
{ "title" : "Red Rock West", "runtime" : 98 }
{ "title" : "Dr. Strangelove or: How I Learned to Stop Worrying and Love the Bomb", "runtime" : 95 }
{ "title" : "Punch-Drunk Love", "runtime" : 95 }
{ "title" : "From Paris with Love", "runtime" : 92 }
{ "title" : "I Love You Phillip Morris", "runtime" : 98 }
{ "title" : "2001: A Space Travesty", "runtime" : 99 }
{ "title" : "The Adventures of Sharkboy and Lavagirl 3-D", "runtime" : 93 }
{ "title" : "The Adventures of Rocky &amp; Bullwinkle", "runtime" : 92 }
{ "title" : "The Rocky Horror Picture Show", "runtime" : 100 }
{ "title" : "Best in Show", "runtime" : 90 }
{ "title" : "Shaun of the Dead", "runtime" : 99 }
{ "title" : "Evil Dead", "runtime" : 91 }
{ "title" : "Night of the Living Dead", "runtime" : 96 }
{ "title" : "Treasure Planet", "runtime" : 95 }
{ "title" : "Planet 51", "runtime" : 91 }
{ "title" : "Forbidden Planet", "runtime" : 98 }
{ "title" : "Beneath the Planet of the Apes", "runtime" : 95 }
{ "title" : "Alien Nation", "runtime" : 91 }
{ "title" : "Alien Autopsy", "runtime" : 95 }
{ "title" : "Alien Outpost", "runtime" : 90 }
Type "it" for more
</code></pre></div></div>

<p>En el caso de querer mostrar solo un resultado igual, se usa $eq (igual que)</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>◦ $ne (no igual): Es lo contrario a $eq, si por ejemplo si usando db.movieDetails.find({runtime: {$eq: 90}}, {_id: 0, title: 1, runtime: 1}) se nos muestran las peliculas que duran exactamente 90 min, con $ne se nos mostraran todas menos las de 90 min:
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({runtime: {$eq: 90}}, {_id: 0, title: 1, runtime: 1})
{ "title" : "Best in Show", "runtime" : 90 }
{ "title" : "Alien Outpost", "runtime" : 90 }
{ "title" : "Bill &amp; Ted's Excellent Adventure", "runtime" : 90 }
{ "title" : "Trouble Bound", "runtime" : 90 }
{ "title" : "Little Nicky", "runtime" : 90 }
{ "title" : "Il Bi e il Ba", "runtime" : 90 }
{ "title" : "Fink fährt ab", "runtime" : 90 }
{ "title" : "Die Post geht ab", "runtime" : 90 }
{ "title" : "Ao qi xiong ying", "runtime" : 90 }
{ "title" : "Shou zhi ao chu", "runtime" : 90 }
{ "title" : "Enchantress Eo-eul", "runtime" : 90 }
{ "title" : "Babylon A.D.", "runtime" : 90 }
{ "title" : "B.J.: Black Jocks", "runtime" : 90 }
{ "title" : "Ed Gein: The Butcher of Plainfield", "runtime" : 90 }
{ "title" : "Il trucido e lo sbirro", "runtime" : 90 }
{ "title" : "Tout le monde n'a pas eu la chance d'avoir des parents communistes", "runtime" : 90 }
{ "title" : "Eu Não Faço a Menor Ideia do Que Eu Tô Fazendo Com a Minha Vida", "runtime" : 90 }
{ "title" : "The Death of J.P. Cuenca", "runtime" : 90 }
{ "title" : "Class of Nuke 'Em High Part II: Subhumanoid Meltdown", "runtime" : 90 }
{ "title" : "KJ: Music and Life", "runtime" : 90 }
Type "it" for more
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({runtime: {$ne: 90}}, {_id: 0, title: 1, runtime: 1})
{ "title" : "Once Upon a Time in the West", "runtime" : 175 }
{ "title" : "A Million Ways to Die in the West", "runtime" : 116 }
{ "title" : "Wild Wild West", "runtime" : 106 }
{ "title" : "West Side Story", "runtime" : 152 }
{ "title" : "Slow West", "runtime" : 84 }
{ "title" : "An American Tail: Fievel Goes West", "runtime" : 75 }
{ "title" : "Red Rock West", "runtime" : 98 }
{ "title" : "How the West Was Won", "runtime" : 164 }
{ "title" : "Journey to the West", "runtime" : 110 }
{ "title" : "West of Memphis", "runtime" : 147 }
{ "title" : "Star Wars: Episode IV - A New Hope", "runtime" : 121 }
{ "title" : "Star Wars: Episode V - The Empire Strikes Back", "runtime" : 124 }
{ "title" : "Star Wars: Episode VI - Return of the Jedi", "runtime" : 131 }
{ "title" : "Star Wars: Episode I - The Phantom Menace", "runtime" : 136 }
{ "title" : "Star Wars: Episode III - Revenge of the Sith", "runtime" : 140 }
{ "title" : "Star Trek", "runtime" : 127 }
{ "title" : "Star Wars: Episode II - Attack of the Clones", "runtime" : 142 }
{ "title" : "Star Trek Into Darkness", "runtime" : 132 }
{ "title" : "Star Trek: First Contact", "runtime" : 111 }
{ "title" : "Star Trek II: The Wrath of Khan", "runtime" : 113 }
Type "it" for more
</code></pre></div></div>

<table>
  <thead>
    <tr>
      <th><strong>Operador</strong></th>
      <th><strong>Descripción</strong></th>
      <th><strong>Ejemplo</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$gt</code></td>
      <td>Mayor que</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({edad: {$gt: 18}})</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$lt</code></td>
      <td>Menor que</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({edad: {$lt: 60}})</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$gte</code></td>
      <td>Mayor o igual que</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({edad: {$gte: 21}})</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$lte</code></td>
      <td>Menor o igual que</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({edad: {$lte: 65}})</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$eq</code></td>
      <td>Igual a</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({nombre: {$eq: "Pedro"}})</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">$ne</code></td>
      <td>No igual a</td>
      <td><code class="language-plaintext highlighter-rouge">db.usuarios.find({nombre: {$ne: "Pedro"}})</code></td>
    </tr>
  </tbody>
</table>

<ul>
  <li>
    <p>Operadores lógicos</p>

    <ul>
      <li>
        <p>$and y $or: ambos operadores unen dos valores de una consulta, sin embargo $and mostrara todos los documentos que coincidan con ambos valores mientras que $or mostrara todos los documentos que coincidan con uno de los dos valores.</p>
      </li>
      <li>
        <p>$not: devuelve los documentos que no esten relacionados con los valores de consulta.</p>
      </li>
      <li>
        <p>$nor: devuelve los documentos que no coinciden con ambos valores de busqueda.</p>
      </li>
    </ul>
  </li>
  <li>
    <p>Operadores de elementos</p>

    <ul>
      <li>$exists: muestra los documentos que coinciden con la busqueda.</li>
      <li>$type: muestra los documentos si un campo es del typo especificado.</li>
    </ul>
  </li>
  <li>
    <p>Operadores de matrices</p>

    <ul>
      <li>$all: coincide con las matrices o arrays que contienen todos los elementos especificados en una consulta.</li>
      <li>$size: muestra los documentos siempre que la array tenga el tamaño especificado.</li>
      <li>$elemMatch: muestra los documentos si el elemento del campo array coincide con los valores especificados</li>
    </ul>
  </li>
  <li>
    <p>Operadores de evaluación</p>

    <ul>
      <li>$regexp: muestra documentos donde los valores coinciden con la expresion regular especificada.</li>
    </ul>
  </li>
</ul>

<h3 id="metodo-para-contabilizar-los-resultados-de-busqueda">Metodo para contabilizar los resultados de busqueda</h3>

<p>En mongodb hay dos formas bastante parecidas de contabilizar los resultados de una busqueda:</p>

<ul>
  <li>Usando el metodo count. Ej contar las peliculas que hay en la base de datos de peliculas:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.count()
2295
</code></pre></div></div>

<ul>
  <li>Usando el metodo count junto al metodo find:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find().count()
2295
</code></pre></div></div>

<p>Ambas formas dan el mismo resultado, sin embargo la diferencia entre estos dos metodos, es que usando solamente count no es posible filtrar, es decir no puedo pedir contar las peliculas de un genero especifico, ya que count solo lo que hace es mostrar la cantidad de documentos que componen la colección de la base de datos.</p>

<p>Esto actualmente parece que ya no es asi, ya que he podido comprobar que en ambos es posible filtrar:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.count({genres: "Comedy"})
749
MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({genres: "Comedy"}).count()
749
</code></pre></div></div>

<h3 id="metodo-limit">Metodo limit</h3>

<p>El metodo limit, limitara el numero de resultado en un filtro, por ejemplo si en lugar de mostrar todas las peliculas, solo quieres mostrar las 3 o 4 primeras.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.find({genres: "Comedy"}).limit(2).pretty()
{
	"_id" : ObjectId("5e7754bbff453565d25411d4"),
	"title" : "The Adventures of Buckaroo Banzai Across the 8th Dimension",
	"year" : 1984,
	"rated" : "PG",
	"runtime" : 103,
	"countries" : [
		"USA"
	],
	"genres" : [
		"Adventure",
		"Comedy",
		"Romance"
	],
	"director" : "W.D. Richter",
	"writers" : [
		"Earl Mac Rauch"
	],
	"actors" : [
		"Peter Weller",
		"John Lithgow",
		"Ellen Barkin",
		"Jeff Goldblum"
	],
	"plot" : "Adventurer/surgeon/rock musician Buckaroo Banzai and his band of men, the Hong Kong Cavaliers, take on evil alien invaders from the 8th dimension.",
	"poster" : "http://ia.media-imdb.com/images/M/MV5BMTk3OTAwNDQwOF5BMl5BanBnXkFtZTgwOTE0MzQxMDE@._V1_SX300.jpg",
	"imdb" : {
		"id" : "tt0086856",
		"rating" : 6.4,
		"votes" : 17154
	},
	"awards" : {
		"wins" : 0,
		"nominations" : 5,
		"text" : "5 nominations."
	},
	"type" : "movie"
}
{
	"_id" : ObjectId("5e7754bbff453565d25411ba"),
	"title" : "Love Actually",
	"year" : 2003,
	"rated" : "R",
	"runtime" : 135,
	"countries" : [
		"UK",
		"USA",
		"France"
	],
	"genres" : [
		"Comedy",
		"Drama",
		"Romance"
	],
	"director" : "Richard Curtis",
	"writers" : [
		"Richard Curtis"
	],
	"actors" : [
		"Bill Nighy",
		"Gregor Fisher",
		"Rory MacGregor",
		"Colin Firth"
	],
	"plot" : "Follows the lives of eight very different couples in dealing with their love lives in various loosely interrelated tales all set during a frantic month before Christmas in London, England.",
	"poster" : "http://ia.media-imdb.com/images/M/MV5BMTY4NjQ5NDc0Nl5BMl5BanBnXkFtZTYwNjk5NDM3._V1_SX300.jpg",
	"imdb" : {
		"id" : "tt0314331",
		"rating" : 7.7,
		"votes" : 306036
	},
	"tomato" : {
		"meter" : 63,
		"image" : "fresh",
		"rating" : 6.4,
		"reviews" : 192,
		"fresh" : 120,
		"consensus" : "A sugary tale overstuffed with too many stories. Still, the cast charms.",
		"userMeter" : 72,
		"userRating" : 3.1,
		"userReviews" : 31625241
	},
	"metacritic" : 55,
	"awards" : {
		"wins" : 10,
		"nominations" : 24,
		"text" : "Nominated for 2 Golden Globes. Another 10 wins &amp; 24 nominations."
	},
	"type" : "movie"
}
</code></pre></div></div>

<p>Anteriormente vimos que de genero comedy habia 749 resultados, sin embargo ahora solo se muestran 2 por estar limiado a 2.</p>

<h3 id="update">Update</h3>

<p>Una de las cosas que distingue a mongodb de los gestores de datos relaciones, es la flexibilidad que tiene, ya que por ejemplo en mongodb no es necesario que los documentos de una misma colección tengan el mismo esquema, al contrario que en las bases de datos relacionales. Por ejemplo en la bases de datos de peliculas, todos los documentos tienen los mismos campos basicos, sin embargo hay campos que solo tienen algunas, como por ejemplo el campo premios que obviamente solo tienen las peliculas que ganaron alguno o por ejemplo el campo poster.</p>

<p>Usando compass es muy facil actualizar un documento ya que lo podemos editar a mano y simplemente podemos hacer clic en actualizar.</p>

<p>En shell por otro lado, la actualización de un documento se hace a traves del metodo updateOne(). Para ello primero se hace un filtro para concretar el documento a actualizar, hay que tener en cuenta que este metodo solo actualizara el primer documento que coincida con el filtro.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.updateOne({title: “The Martian”}, {$set: {poster: https://www.google.com/url?sa=i&amp;url=http%3A%2F%2Fwww.sensacine.com%2Fpeliculas%2Fpelicula-221524%2F&amp;psig=AOvVaw1MypUGK_TXWkglEMdCNTXV&amp;ust=1616771781342000&amp;source=images&amp;cd=vfe&amp;ved=2ahUKEwiJs_mu3svvAhUJxOAKHXI0BEMQjRx6BAgAEAc}})
</code></pre></div></div>

<p>En este caso hacemos uso del operador $set para indicar el campo que se va a añadir a la pelicula con el titulo “The Martian”. En el caso de que el campo poster ya exista, si usamos $set se modificara el campo poster con el nuevo valor que hemos añadido.</p>

<p>Este metodo seguramente resulte familiar al uso de insertOne e insertMany y al igual que ocurre con insert, tambien existe un updateMany.</p>

<p>La diferencia entre updateOne y updateMany es que updateMany actualizara o modificara todos aquellos documentos que coincidan con el filtro, mientras updateOne solo actualiza o modifica el primero. Por ejemplo en la base de datos de peliculas, en algunos de los documentos se encuentrar campos que aparecen nulos (nulls) y se van a eliminar de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>MongoDB Enterprise Cluster0-shard-0:PRIMARY&gt; db.movieDetails.updateMany({rated: null}, {$unset: {rated: “”}})
</code></pre></div></div>

<p>En este caso se usa el operador $unset para eliminar el contenido, en este caso a todas las peliculas cuyo campo rated sea null se le eliminara el campo rated.</p>

<h3 id="remplazar">Remplazar</h3>

<p>ReplaceOne lo podemos usar tanto para modificar la informacion de la base de datos como para añadir contenido nuevo usando para ello upset.</p>

<p>La sintaxis de replaceOne seria la siguiente, replaceOne({Objeto a reemplazar},{reemplazo}). Por ejemplo, si contamos con una base de datos de alumnos y queremos reemplazar la informacion de un alumno que tenga como apellido “Gonzalez” y lo queramos sustituir por “nombre: sergio, apellido: ibañez”, seria de la siguiente forma:</p>

<p>db.alumnos.replaceOne({apellido: Gonzalez},{nombre: sergio, apellido: ibañez})</p>

<h3 id="delete">Delete</h3>

<p>Para eliminar datos en mongodb, tenemos dos opciones al igual que con insert y update, deleteOne y deleteMany.</p>

<p>deleteOne elimina solo el primer documento que coincida con el filtro realizado, es decir, que si por ejemplo haciendo uso de nuestra base de datos de peliculas queremos eliminar todas aquellas peliculas de un genero especifico como Comedy, seria de la siguiente forma:</p>

<p>db.peliculas.deleteOne(genre: “Comedy”)</p>

<p>Sin embargo, de este genero hay varias peliculas, pero solo se eliminaria el primer resultado ya que deleteOne lo que hace es eliminar solo la primera coincidencia.</p>

<p>Es aqui donde entra en juego el uso de deleteMany, ya que elimina todos aquellos documentos que coincidan con el filtro, es decir, que en este caso hacemos lo mismo que en el caso anterior, pero esta vez eliminariamos todas las peliculas del genero especificado en el filtro.</p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Base de Datos" /><category term="Apuntes" /><summary type="html"><![CDATA[En este post se va a explicar tanto la instalación y configuración de mongodb ademas de varios de los conceptos basicos como pueden ser el uso de proyecciones y operadores CRUD.]]></summary></entry><entry><title type="html">Aplicaciones web PHP en Docker</title><link href="http://localhost:4000/aplicaciones%20web/2021/03/14/Aplicaciones-web-php-en-docker.html" rel="alternate" type="text/html" title="Aplicaciones web PHP en Docker" /><published>2021-03-14T13:26:35+01:00</published><updated>2021-03-14T13:26:35+01:00</updated><id>http://localhost:4000/aplicaciones%20web/2021/03/14/Aplicaciones-web-php-en-docker</id><content type="html" xml:base="http://localhost:4000/aplicaciones%20web/2021/03/14/Aplicaciones-web-php-en-docker.html"><![CDATA[<h3 id="introduccion"><strong>Introduccion</strong></h3>

<p>En esta practica haciendo uso de docker, vamos a desplegar distintas aplicaciones en contenedores, en los primeros ejercicios se trabajara con bookmedik (aplicacion para organizar citas medicas) y en las dos ultimas se usara drupal y joomla.</p>

<p>La forma de trabajar sera la siguiente, en nuestro equipo tendremos un directorio con todo lo necesario para los distintos ejercicios y dentro de este directorio habra otros dos (en los casos que sea necesario), tendremos un directorio buil donde tendremos tanto el directorio de la aplicacion con los ficheros necesarios para su ejecucion, un dockerfile que usaremos para crear los contenedores y un fichero script ue modificara y añadira los datos necesario en los contenedores.</p>

<p>Aparte tendremos un fichero deploy en el que lo unico que tendremos sera un fichero docker-compose.</p>

<p>Para los ejercicios usaremos dos contenedores, uno donde se alojara la plaicacion que vamos a usar y otro que alojara la base de datos que usara la aplicacion.</p>

<p>La estructura de ficheros quedara de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>├── Tareax
│   ├── build
│   │   ├── bookmedik
│   │   ├── dockerfile
│   │   └── script.sh
│   ├── deploy
│   │   └── docker-compose.yaml
</code></pre></div></div>

<h3 id="tarea-1-ejecución-de-la-aplicación-web-en-docker">Tarea 1: Ejecución de la aplicación web en docker</h3>

<ul>
  <li>Queremos ejecutar en un contenedor docker la aplicación web escrita en PHP: bookMedik (https://github.com/evilnapsis/bookmedik).</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/evilnapsis/bookmedik
</code></pre></div></div>

<ul>
  <li>
    <p>Es necesario tener un contenedor con mariadb donde vamos a crear la base de datos y los datos de la aplicación. El script para generar la base de datos y los registros lo encuentras en el repositorio y se llama schema.sql. Debes crear un usuario con su contraseña en la base de datos. La base de datos se llama bookmedik y se crea al ejecutar el script</p>
  </li>
  <li>
    <p>Ejecuta el contenedor mariadb y carga los datos del script schema.sql. Para más información.
Para que funcione la carga de datos tendremos que eliminar o comentar la linea create database bookmedik, de lo contrario ono podremos cargar los datos ya que ya hay una tabla bookmedik creada.</p>
  </li>
  <li>
    <p>El contenedor mariadb debe tener un volumen para guardar la base de datos.</p>
  </li>
  <li>
    <p>El contenedor que creas debe tener un volumen para guardar los logs de apache2.</p>
  </li>
  <li>
    <p>Crea una imagen docker con la aplicación desde una imagen base de debian o ubuntu. Ten en cuenta que el fichero de configuración de la base de datos (core\controller\Database.php) lo tienes que configurar utilizando las variables de entorno del contenedor mariadb. (Nota: Para obtener las variables de entorno en PHP usar la función getenv. Para más infomación).</p>
  </li>
  <li>
    <p>La imagen la tienes que crear en tu máquina con el comando docker build.</p>
  </li>
  <li>
    <p>Crea un script con docker compose que levante el escenario con los dos contenedores.(Usuario: admin, contraseña: admin).</p>
  </li>
</ul>

<p>Enpezamos la tarea creando y configurando nuestro dockerfile de la siguiente forma:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM debian
RUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php7.3 php7.3 php7.3-mysql &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
RUN rm /var/www/html/index.html

ENV MARIADB_USER admin
ENV MARIADB_PASS admin
ENV MARIADB_HOST servidor_mysql
ENV DB_NAME bookmedik

EXPOSE 80

COPY bookmedik/ /var/www/html

ADD script.sh /usr/local/bin/script.sh

RUN chmod +x /usr/local/bin/script.sh

CMD ["script.sh"]
</code></pre></div></div>

<p>Con esto lo que hacemos basicamente es configurar los contenedores con un sistema debian indicando que se realicen tanto un update como la instalacion de varios paquetes para que la aplicacion funcione correctamente.</p>

<p>Indicamos tambien las variables de nuestra base de datos con el atributo “ENV”. Por otro lado, con “copy” copiamos el directorio bokkmedik en build al /var/www/html del contenedor (en lugar de copy tambien se podria usar workdir).</p>

<p>Por ultimo añadimos en el contenedor nuestro fichero script.sh que tendremos en el build y le damos permisos al contenedor para que se ejecute. Con la orden cmd nuestro script sera lo primero que se ejecute al arrancar el contenedor.</p>

<p>Pasemos ahora a la configuracion del fichero script.sh:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>#!/bin/bash

sed -i "s/$this-&gt;user=\"root\";/$this-&gt;user=\"$MARIADB_USER\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;pass=\"\";/$this-&gt;pass=\"$MARIADB_PASS\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;host=\"localhost\";/$this-&gt;host=\"$MARIADB_HOST\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;ddbb=\"bookmedik\";/$this-&gt;ddbb=\"$DB_NAME\";/g" /var/www/html/core/controller/Database.php

apache2ctl -D FOREGROUND
</code></pre></div></div>

<p>¿Que hace esto? pues esto lo que hace es coger los datos de las variables indicadas con “$” en este caso las variables indicadas en dokerfile (usuario, contraseña, contenedor y nombre de la base de datos).</p>

<h3 id="creacion-de-la-imagen">Creacion de la imagen</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~/bookmedik/build$ docker build -t sergioib94/bookmedik:v1 .
Sending build context to Docker daemon  3.667MB
Step 1/12 : FROM debian
 ---&gt; 5890f8ba95f6
Step 2/12 : RUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php7.3 php7.3 php7.3-mysql &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
 ---&gt; Running in 80716c56547d
Get:1 http://deb.debian.org/debian buster InRelease [122 kB]
Get:2 http://security.debian.org/debian-security buster/updates InRelease [65.4 kB]
Get:3 http://deb.debian.org/debian buster-updates InRelease [51.9 kB]
Get:4 http://deb.debian.org/debian buster/main amd64 Packages [7907 kB]
Get:5 http://security.debian.org/debian-security buster/updates/main amd64 Packages [267 kB]
Get:6 http://deb.debian.org/debian buster-updates/main amd64 Packages [9504 B]
Fetched 8422 kB in 2s (3712 kB/s)
Reading package lists...
Reading package lists...
Building dependency tree...
Reading state information...
The following additional packages will be installed:
  apache2-bin apache2-data apache2-utils bzip2 ca-certificates file
  krb5-locales libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap
  libargon2-1 libbrotli1 libbsd0 libcurl4 libedit2 libexpat1 libgdbm-compat4
  libgdbm6 libgpm2 libgssapi-krb5-2 libicu63 libjansson4 libk5crypto3
  libkeyutils1 libkrb5-3 libkrb5support0 libldap-2.4-2 libldap-common
  liblua5.2-0 libmagic-mgc libmagic1 libncurses6 libnghttp2-14 libpcre2-8-0
  libperl5.28 libprocps7 libpsl5 librtmp1 libsasl2-2 libsasl2-modules
  libsasl2-modules-db libsodium23 libsqlite3-0 libssh2-1 libssl1.1 libxml2
  lsb-base mime-support netbase openssl perl perl-modules-5.28 php-common
  php7.3-cli php7.3-common php7.3-json php7.3-opcache php7.3-readline procps
  psmisc publicsuffix sensible-utils ssl-cert ucf xz-utils
Suggested packages:
  apache2-doc apache2-suexec-pristine | apache2-suexec-custom www-browser
  bzip2-doc php-pear gdbm-l10n gpm krb5-doc krb5-user
  libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal
  libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql perl-doc
  libterm-readline-gnu-perl | libterm-readline-perl-perl make libb-debug-perl
  liblocale-codes-perl openssl-blacklist
The following NEW packages will be installed:
  apache2 apache2-bin apache2-data apache2-utils bzip2 ca-certificates file
  krb5-locales libapache2-mod-php7.3 libapr1 libaprutil1
  libaprutil1-dbd-sqlite3 libaprutil1-ldap libargon2-1 libbrotli1 libbsd0
  libcurl4 libedit2 libexpat1 libgdbm-compat4 libgdbm6 libgpm2
  libgssapi-krb5-2 libicu63 libjansson4 libk5crypto3 libkeyutils1 libkrb5-3
  libkrb5support0 libldap-2.4-2 libldap-common liblua5.2-0 libmagic-mgc
  libmagic1 libncurses6 libnghttp2-14 libpcre2-8-0 libperl5.28 libprocps7
  libpsl5 librtmp1 libsasl2-2 libsasl2-modules libsasl2-modules-db libsodium23
  libsqlite3-0 libssh2-1 libssl1.1 libxml2 lsb-base mime-support netbase
  openssl perl perl-modules-5.28 php-common php7.3 php7.3-cli php7.3-common
  php7.3-json php7.3-mysql php7.3-opcache php7.3-readline procps psmisc
  publicsuffix sensible-utils ssl-cert ucf xz-utils
0 upgraded, 70 newly installed, 0 to remove and 1 not upgraded.
Need to get 30.3 MB of archives.
After this operation, 132 MB of additional disk space will be used.
Get:1 http://deb.debian.org/debian buster/main amd64 perl-modules-5.28 all 5.28.1-6+deb10u1 [2873 kB]
Get:2 http://security.debian.org/debian-security buster/updates/main amd64 libssl1.1 amd64 1.1.1d-0+deb10u5 [1539 kB]
Get:3 http://security.debian.org/debian-security buster/updates/main amd64 libldap-common all 2.4.47+dfsg-3+deb10u6 [90.0 kB]
Get:4 http://security.debian.org/debian-security buster/updates/main amd64 libldap-2.4-2 amd64 2.4.47+dfsg-3+deb10u6 [224 kB]
Get:5 http://security.debian.org/debian-security buster/updates/main amd64 openssl amd64 1.1.1d-0+deb10u5 [844 kB]
Get:6 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-common amd64 7.3.27-1~deb10u1 [960 kB]
Get:7 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-json amd64 7.3.27-1~deb10u1 [18.6 kB]
Get:8 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-opcache amd64 7.3.27-1~deb10u1 [184 kB]
Get:9 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-readline amd64 7.3.27-1~deb10u1 [12.0 kB]
Get:10 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-cli amd64 7.3.27-1~deb10u1 [1414 kB]
Get:11 http://deb.debian.org/debian buster/main amd64 libgdbm6 amd64 1.18.1-4 [64.7 kB]
Get:12 http://deb.debian.org/debian buster/main amd64 libgdbm-compat4 amd64 1.18.1-4 [44.1 kB]
Get:13 http://deb.debian.org/debian buster/main amd64 libperl5.28 amd64 5.28.1-6+deb10u1 [3894 kB]
Get:14 http://security.debian.org/debian-security buster/updates/main amd64 libapache2-mod-php7.3 amd64 7.3.27-1~deb10u1 [1362 kB]
Get:15 http://security.debian.org/debian-security buster/updates/main amd64 php7.3 all 7.3.27-1~deb10u1 [46.8 kB]
Get:16 http://security.debian.org/debian-security buster/updates/main amd64 php7.3-mysql amd64 7.3.27-1~deb10u1 [119 kB]
Get:17 http://deb.debian.org/debian buster/main amd64 perl amd64 5.28.1-6+deb10u1 [204 kB]
Get:18 http://deb.debian.org/debian buster/main amd64 libapr1 amd64 1.6.5-1+b1 [102 kB]
Get:19 http://deb.debian.org/debian buster/main amd64 libexpat1 amd64 2.2.6-2+deb10u1 [106 kB]
Get:20 http://deb.debian.org/debian buster/main amd64 libaprutil1 amd64 1.6.1-4 [91.8 kB]
Get:21 http://deb.debian.org/debian buster/main amd64 libsqlite3-0 amd64 3.27.2-3+deb10u1 [641 kB]
Get:22 http://deb.debian.org/debian buster/main amd64 libaprutil1-dbd-sqlite3 amd64 1.6.1-4 [18.7 kB]
Get:23 http://deb.debian.org/debian buster/main amd64 libsasl2-modules-db amd64 2.1.27+dfsg-1+deb10u1 [69.1 kB]
Get:24 http://deb.debian.org/debian buster/main amd64 libsasl2-2 amd64 2.1.27+dfsg-1+deb10u1 [106 kB]
Get:25 http://deb.debian.org/debian buster/main amd64 libaprutil1-ldap amd64 1.6.1-4 [16.8 kB]
Get:26 http://deb.debian.org/debian buster/main amd64 libbrotli1 amd64 1.0.7-2+deb10u1 [269 kB]
Get:27 http://deb.debian.org/debian buster/main amd64 libkeyutils1 amd64 1.6-6 [15.0 kB]
Get:28 http://deb.debian.org/debian buster/main amd64 libkrb5support0 amd64 1.17-3+deb10u1 [65.8 kB]
Get:29 http://deb.debian.org/debian buster/main amd64 libk5crypto3 amd64 1.17-3+deb10u1 [122 kB]
Get:30 http://deb.debian.org/debian buster/main amd64 libkrb5-3 amd64 1.17-3+deb10u1 [369 kB]
Get:31 http://deb.debian.org/debian buster/main amd64 libgssapi-krb5-2 amd64 1.17-3+deb10u1 [158 kB]
Get:32 http://deb.debian.org/debian buster/main amd64 libnghttp2-14 amd64 1.36.0-2+deb10u1 [85.0 kB]
Get:33 http://deb.debian.org/debian buster/main amd64 libpsl5 amd64 0.20.2-2 [53.7 kB]
Get:34 http://deb.debian.org/debian buster/main amd64 librtmp1 amd64 2.4+20151223.gitfa8646d.1-2 [60.5 kB]
Get:35 http://deb.debian.org/debian buster/main amd64 libssh2-1 amd64 1.8.0-2.1 [140 kB]
Get:36 http://deb.debian.org/debian buster/main amd64 libcurl4 amd64 7.64.0-4+deb10u1 [331 kB]
Get:37 http://deb.debian.org/debian buster/main amd64 libjansson4 amd64 2.12-1 [38.0 kB]
Get:38 http://deb.debian.org/debian buster/main amd64 liblua5.2-0 amd64 5.2.4-1.1+b2 [110 kB]
Get:39 http://deb.debian.org/debian buster/main amd64 libicu63 amd64 63.1-6+deb10u1 [8300 kB]
Get:40 http://deb.debian.org/debian buster/main amd64 libxml2 amd64 2.9.4+dfsg1-7+deb10u1 [689 kB]
Get:41 http://deb.debian.org/debian buster/main amd64 apache2-bin amd64 2.4.38-3+deb10u4 [1307 kB]
Get:42 http://deb.debian.org/debian buster/main amd64 apache2-data all 2.4.38-3+deb10u4 [165 kB]
Get:43 http://deb.debian.org/debian buster/main amd64 apache2-utils amd64 2.4.38-3+deb10u4 [237 kB]
Get:44 http://deb.debian.org/debian buster/main amd64 lsb-base all 10.2019051400 [28.4 kB]
Get:45 http://deb.debian.org/debian buster/main amd64 mime-support all 3.62 [37.2 kB]
Get:46 http://deb.debian.org/debian buster/main amd64 libncurses6 amd64 6.1+20181013-2+deb10u2 [102 kB]
Get:47 http://deb.debian.org/debian buster/main amd64 libprocps7 amd64 2:3.3.15-2 [61.7 kB]
Get:48 http://deb.debian.org/debian buster/main amd64 procps amd64 2:3.3.15-2 [259 kB]
Get:49 http://deb.debian.org/debian buster/main amd64 apache2 amd64 2.4.38-3+deb10u4 [251 kB]
Get:50 http://deb.debian.org/debian buster/main amd64 netbase all 5.6 [19.4 kB]
Get:51 http://deb.debian.org/debian buster/main amd64 sensible-utils all 0.0.12 [15.8 kB]
Get:52 http://deb.debian.org/debian buster/main amd64 bzip2 amd64 1.0.6-9.2~deb10u1 [48.4 kB]
Get:53 http://deb.debian.org/debian buster/main amd64 libmagic-mgc amd64 1:5.35-4+deb10u2 [242 kB]
Get:54 http://deb.debian.org/debian buster/main amd64 libmagic1 amd64 1:5.35-4+deb10u2 [118 kB]
Get:55 http://deb.debian.org/debian buster/main amd64 file amd64 1:5.35-4+deb10u2 [66.4 kB]
Get:56 http://deb.debian.org/debian buster/main amd64 krb5-locales all 1.17-3+deb10u1 [95.4 kB]
Get:57 http://deb.debian.org/debian buster/main amd64 ucf all 3.0038+nmu1 [69.0 kB]
Get:58 http://deb.debian.org/debian buster/main amd64 xz-utils amd64 5.2.4-1 [183 kB]
Get:59 http://deb.debian.org/debian buster/main amd64 ca-certificates all 20200601~deb10u2 [166 kB]
Get:60 http://deb.debian.org/debian buster/main amd64 libbsd0 amd64 0.9.1-2 [99.5 kB]
Get:61 http://deb.debian.org/debian buster/main amd64 libedit2 amd64 3.1-20181209-1 [94.0 kB]
Get:62 http://deb.debian.org/debian buster/main amd64 psmisc amd64 23.2-1 [126 kB]
Get:63 http://deb.debian.org/debian buster/main amd64 php-common all 2:69 [15.0 kB]
Get:64 http://deb.debian.org/debian buster/main amd64 libargon2-1 amd64 0~20171227-0.2 [19.6 kB]
Get:65 http://deb.debian.org/debian buster/main amd64 libpcre2-8-0 amd64 10.32-5 [213 kB]
Get:66 http://deb.debian.org/debian buster/main amd64 libsodium23 amd64 1.0.17-1 [158 kB]
Get:67 http://deb.debian.org/debian buster/main amd64 libgpm2 amd64 1.20.7-5 [35.1 kB]
Get:68 http://deb.debian.org/debian buster/main amd64 libsasl2-modules amd64 2.1.27+dfsg-1+deb10u1 [104 kB]
Get:69 http://deb.debian.org/debian buster/main amd64 publicsuffix all 20190415.1030-1 [116 kB]
Get:70 http://deb.debian.org/debian buster/main amd64 ssl-cert all 1.0.39 [20.8 kB]
debconf: delaying package configuration, since apt-utils is not installed
Fetched 30.3 MB in 3s (11.6 MB/s)
Selecting previously unselected package perl-modules-5.28.
(Reading database ... 6677 files and directories currently installed.)
Preparing to unpack .../00-perl-modules-5.28_5.28.1-6+deb10u1_all.deb ...
Unpacking perl-modules-5.28 (5.28.1-6+deb10u1) ...
Selecting previously unselected package libgdbm6:amd64.
Preparing to unpack .../01-libgdbm6_1.18.1-4_amd64.deb ...
Unpacking libgdbm6:amd64 (1.18.1-4) ...
Selecting previously unselected package libgdbm-compat4:amd64.
Preparing to unpack .../02-libgdbm-compat4_1.18.1-4_amd64.deb ...
Unpacking libgdbm-compat4:amd64 (1.18.1-4) ...
Selecting previously unselected package libperl5.28:amd64.
Preparing to unpack .../03-libperl5.28_5.28.1-6+deb10u1_amd64.deb ...
Unpacking libperl5.28:amd64 (5.28.1-6+deb10u1) ...
Selecting previously unselected package perl.
Preparing to unpack .../04-perl_5.28.1-6+deb10u1_amd64.deb ...
Unpacking perl (5.28.1-6+deb10u1) ...
Selecting previously unselected package libapr1:amd64.
Preparing to unpack .../05-libapr1_1.6.5-1+b1_amd64.deb ...
Unpacking libapr1:amd64 (1.6.5-1+b1) ...
Selecting previously unselected package libexpat1:amd64.
Preparing to unpack .../06-libexpat1_2.2.6-2+deb10u1_amd64.deb ...
Unpacking libexpat1:amd64 (2.2.6-2+deb10u1) ...
Selecting previously unselected package libssl1.1:amd64.
Preparing to unpack .../07-libssl1.1_1.1.1d-0+deb10u5_amd64.deb ...
Unpacking libssl1.1:amd64 (1.1.1d-0+deb10u5) ...
Selecting previously unselected package libaprutil1:amd64.
Preparing to unpack .../08-libaprutil1_1.6.1-4_amd64.deb ...
Unpacking libaprutil1:amd64 (1.6.1-4) ...
Selecting previously unselected package libsqlite3-0:amd64.
Preparing to unpack .../09-libsqlite3-0_3.27.2-3+deb10u1_amd64.deb ...
Unpacking libsqlite3-0:amd64 (3.27.2-3+deb10u1) ...
Selecting previously unselected package libaprutil1-dbd-sqlite3:amd64.
Preparing to unpack .../10-libaprutil1-dbd-sqlite3_1.6.1-4_amd64.deb ...
Unpacking libaprutil1-dbd-sqlite3:amd64 (1.6.1-4) ...
Selecting previously unselected package libsasl2-modules-db:amd64.
Preparing to unpack .../11-libsasl2-modules-db_2.1.27+dfsg-1+deb10u1_amd64.deb ...
Unpacking libsasl2-modules-db:amd64 (2.1.27+dfsg-1+deb10u1) ...
Selecting previously unselected package libsasl2-2:amd64.
Preparing to unpack .../12-libsasl2-2_2.1.27+dfsg-1+deb10u1_amd64.deb ...
Unpacking libsasl2-2:amd64 (2.1.27+dfsg-1+deb10u1) ...
Selecting previously unselected package libldap-common.
Preparing to unpack .../13-libldap-common_2.4.47+dfsg-3+deb10u6_all.deb ...
Unpacking libldap-common (2.4.47+dfsg-3+deb10u6) ...
Selecting previously unselected package libldap-2.4-2:amd64.
Preparing to unpack .../14-libldap-2.4-2_2.4.47+dfsg-3+deb10u6_amd64.deb ...
Unpacking libldap-2.4-2:amd64 (2.4.47+dfsg-3+deb10u6) ...
Selecting previously unselected package libaprutil1-ldap:amd64.
Preparing to unpack .../15-libaprutil1-ldap_1.6.1-4_amd64.deb ...
Unpacking libaprutil1-ldap:amd64 (1.6.1-4) ...
Selecting previously unselected package libbrotli1:amd64.
Preparing to unpack .../16-libbrotli1_1.0.7-2+deb10u1_amd64.deb ...
Unpacking libbrotli1:amd64 (1.0.7-2+deb10u1) ...
Selecting previously unselected package libkeyutils1:amd64.
Preparing to unpack .../17-libkeyutils1_1.6-6_amd64.deb ...
Unpacking libkeyutils1:amd64 (1.6-6) ...
Selecting previously unselected package libkrb5support0:amd64.
Preparing to unpack .../18-libkrb5support0_1.17-3+deb10u1_amd64.deb ...
Unpacking libkrb5support0:amd64 (1.17-3+deb10u1) ...
Selecting previously unselected package libk5crypto3:amd64.
Preparing to unpack .../19-libk5crypto3_1.17-3+deb10u1_amd64.deb ...
Unpacking libk5crypto3:amd64 (1.17-3+deb10u1) ...
Selecting previously unselected package libkrb5-3:amd64.
Preparing to unpack .../20-libkrb5-3_1.17-3+deb10u1_amd64.deb ...
Unpacking libkrb5-3:amd64 (1.17-3+deb10u1) ...
Selecting previously unselected package libgssapi-krb5-2:amd64.
Preparing to unpack .../21-libgssapi-krb5-2_1.17-3+deb10u1_amd64.deb ...
Unpacking libgssapi-krb5-2:amd64 (1.17-3+deb10u1) ...
Selecting previously unselected package libnghttp2-14:amd64.
Preparing to unpack .../22-libnghttp2-14_1.36.0-2+deb10u1_amd64.deb ...
Unpacking libnghttp2-14:amd64 (1.36.0-2+deb10u1) ...
Selecting previously unselected package libpsl5:amd64.
Preparing to unpack .../23-libpsl5_0.20.2-2_amd64.deb ...
Unpacking libpsl5:amd64 (0.20.2-2) ...
Selecting previously unselected package librtmp1:amd64.
Preparing to unpack .../24-librtmp1_2.4+20151223.gitfa8646d.1-2_amd64.deb ...
Unpacking librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2) ...
Selecting previously unselected package libssh2-1:amd64.
Preparing to unpack .../25-libssh2-1_1.8.0-2.1_amd64.deb ...
Unpacking libssh2-1:amd64 (1.8.0-2.1) ...
Selecting previously unselected package libcurl4:amd64.
Preparing to unpack .../26-libcurl4_7.64.0-4+deb10u1_amd64.deb ...
Unpacking libcurl4:amd64 (7.64.0-4+deb10u1) ...
Selecting previously unselected package libjansson4:amd64.
Preparing to unpack .../27-libjansson4_2.12-1_amd64.deb ...
Unpacking libjansson4:amd64 (2.12-1) ...
Selecting previously unselected package liblua5.2-0:amd64.
Preparing to unpack .../28-liblua5.2-0_5.2.4-1.1+b2_amd64.deb ...
Unpacking liblua5.2-0:amd64 (5.2.4-1.1+b2) ...
Selecting previously unselected package libicu63:amd64.
Preparing to unpack .../29-libicu63_63.1-6+deb10u1_amd64.deb ...
Unpacking libicu63:amd64 (63.1-6+deb10u1) ...
Selecting previously unselected package libxml2:amd64.
Preparing to unpack .../30-libxml2_2.9.4+dfsg1-7+deb10u1_amd64.deb ...
Unpacking libxml2:amd64 (2.9.4+dfsg1-7+deb10u1) ...
Selecting previously unselected package apache2-bin.
Preparing to unpack .../31-apache2-bin_2.4.38-3+deb10u4_amd64.deb ...
Unpacking apache2-bin (2.4.38-3+deb10u4) ...
Selecting previously unselected package apache2-data.
Preparing to unpack .../32-apache2-data_2.4.38-3+deb10u4_all.deb ...
Unpacking apache2-data (2.4.38-3+deb10u4) ...
Selecting previously unselected package apache2-utils.
Preparing to unpack .../33-apache2-utils_2.4.38-3+deb10u4_amd64.deb ...
Unpacking apache2-utils (2.4.38-3+deb10u4) ...
Selecting previously unselected package lsb-base.
Preparing to unpack .../34-lsb-base_10.2019051400_all.deb ...
Unpacking lsb-base (10.2019051400) ...
Selecting previously unselected package mime-support.
Preparing to unpack .../35-mime-support_3.62_all.deb ...
Unpacking mime-support (3.62) ...
Selecting previously unselected package libncurses6:amd64.
Preparing to unpack .../36-libncurses6_6.1+20181013-2+deb10u2_amd64.deb ...
Unpacking libncurses6:amd64 (6.1+20181013-2+deb10u2) ...
Selecting previously unselected package libprocps7:amd64.
Preparing to unpack .../37-libprocps7_2%3a3.3.15-2_amd64.deb ...
Unpacking libprocps7:amd64 (2:3.3.15-2) ...
Selecting previously unselected package procps.
Preparing to unpack .../38-procps_2%3a3.3.15-2_amd64.deb ...
Unpacking procps (2:3.3.15-2) ...
Selecting previously unselected package apache2.
Preparing to unpack .../39-apache2_2.4.38-3+deb10u4_amd64.deb ...
Unpacking apache2 (2.4.38-3+deb10u4) ...
Selecting previously unselected package netbase.
Preparing to unpack .../40-netbase_5.6_all.deb ...
Unpacking netbase (5.6) ...
Selecting previously unselected package sensible-utils.
Preparing to unpack .../41-sensible-utils_0.0.12_all.deb ...
Unpacking sensible-utils (0.0.12) ...
Selecting previously unselected package bzip2.
Preparing to unpack .../42-bzip2_1.0.6-9.2~deb10u1_amd64.deb ...
Unpacking bzip2 (1.0.6-9.2~deb10u1) ...
Selecting previously unselected package libmagic-mgc.
Preparing to unpack .../43-libmagic-mgc_1%3a5.35-4+deb10u2_amd64.deb ...
Unpacking libmagic-mgc (1:5.35-4+deb10u2) ...
Selecting previously unselected package libmagic1:amd64.
Preparing to unpack .../44-libmagic1_1%3a5.35-4+deb10u2_amd64.deb ...
Unpacking libmagic1:amd64 (1:5.35-4+deb10u2) ...
Selecting previously unselected package file.
Preparing to unpack .../45-file_1%3a5.35-4+deb10u2_amd64.deb ...
Unpacking file (1:5.35-4+deb10u2) ...
Selecting previously unselected package krb5-locales.
Preparing to unpack .../46-krb5-locales_1.17-3+deb10u1_all.deb ...
Unpacking krb5-locales (1.17-3+deb10u1) ...
Selecting previously unselected package ucf.
Preparing to unpack .../47-ucf_3.0038+nmu1_all.deb ...
Moving old data out of the way
Unpacking ucf (3.0038+nmu1) ...
Selecting previously unselected package xz-utils.
Preparing to unpack .../48-xz-utils_5.2.4-1_amd64.deb ...
Unpacking xz-utils (5.2.4-1) ...
Selecting previously unselected package openssl.
Preparing to unpack .../49-openssl_1.1.1d-0+deb10u5_amd64.deb ...
Unpacking openssl (1.1.1d-0+deb10u5) ...
Selecting previously unselected package ca-certificates.
Preparing to unpack .../50-ca-certificates_20200601~deb10u2_all.deb ...
Unpacking ca-certificates (20200601~deb10u2) ...
Selecting previously unselected package libbsd0:amd64.
Preparing to unpack .../51-libbsd0_0.9.1-2_amd64.deb ...
Unpacking libbsd0:amd64 (0.9.1-2) ...
Selecting previously unselected package libedit2:amd64.
Preparing to unpack .../52-libedit2_3.1-20181209-1_amd64.deb ...
Unpacking libedit2:amd64 (3.1-20181209-1) ...
Selecting previously unselected package psmisc.
Preparing to unpack .../53-psmisc_23.2-1_amd64.deb ...
Unpacking psmisc (23.2-1) ...
Selecting previously unselected package php-common.
Preparing to unpack .../54-php-common_2%3a69_all.deb ...
Unpacking php-common (2:69) ...
Selecting previously unselected package php7.3-common.
Preparing to unpack .../55-php7.3-common_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-common (7.3.27-1~deb10u1) ...
Selecting previously unselected package php7.3-json.
Preparing to unpack .../56-php7.3-json_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-json (7.3.27-1~deb10u1) ...
Selecting previously unselected package php7.3-opcache.
Preparing to unpack .../57-php7.3-opcache_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-opcache (7.3.27-1~deb10u1) ...
Selecting previously unselected package php7.3-readline.
Preparing to unpack .../58-php7.3-readline_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-readline (7.3.27-1~deb10u1) ...
Selecting previously unselected package libargon2-1:amd64.
Preparing to unpack .../59-libargon2-1_0~20171227-0.2_amd64.deb ...
Unpacking libargon2-1:amd64 (0~20171227-0.2) ...
Selecting previously unselected package libpcre2-8-0:amd64.
Preparing to unpack .../60-libpcre2-8-0_10.32-5_amd64.deb ...
Unpacking libpcre2-8-0:amd64 (10.32-5) ...
Selecting previously unselected package libsodium23:amd64.
Preparing to unpack .../61-libsodium23_1.0.17-1_amd64.deb ...
Unpacking libsodium23:amd64 (1.0.17-1) ...
Selecting previously unselected package php7.3-cli.
Preparing to unpack .../62-php7.3-cli_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-cli (7.3.27-1~deb10u1) ...
Selecting previously unselected package libapache2-mod-php7.3.
Preparing to unpack .../63-libapache2-mod-php7.3_7.3.27-1~deb10u1_amd64.deb ...
Unpacking libapache2-mod-php7.3 (7.3.27-1~deb10u1) ...
Selecting previously unselected package libgpm2:amd64.
Preparing to unpack .../64-libgpm2_1.20.7-5_amd64.deb ...
Unpacking libgpm2:amd64 (1.20.7-5) ...
Selecting previously unselected package libsasl2-modules:amd64.
Preparing to unpack .../65-libsasl2-modules_2.1.27+dfsg-1+deb10u1_amd64.deb ...
Unpacking libsasl2-modules:amd64 (2.1.27+dfsg-1+deb10u1) ...
Selecting previously unselected package php7.3.
Preparing to unpack .../66-php7.3_7.3.27-1~deb10u1_all.deb ...
Unpacking php7.3 (7.3.27-1~deb10u1) ...
Selecting previously unselected package php7.3-mysql.
Preparing to unpack .../67-php7.3-mysql_7.3.27-1~deb10u1_amd64.deb ...
Unpacking php7.3-mysql (7.3.27-1~deb10u1) ...
Selecting previously unselected package publicsuffix.
Preparing to unpack .../68-publicsuffix_20190415.1030-1_all.deb ...
Unpacking publicsuffix (20190415.1030-1) ...
Selecting previously unselected package ssl-cert.
Preparing to unpack .../69-ssl-cert_1.0.39_all.deb ...
Unpacking ssl-cert (1.0.39) ...
Setting up perl-modules-5.28 (5.28.1-6+deb10u1) ...
Setting up libexpat1:amd64 (2.2.6-2+deb10u1) ...
Setting up lsb-base (10.2019051400) ...
Setting up libkeyutils1:amd64 (1.6-6) ...
Setting up libpsl5:amd64 (0.20.2-2) ...
Setting up libsodium23:amd64 (1.0.17-1) ...
Setting up libgpm2:amd64 (1.20.7-5) ...
Setting up mime-support (3.62) ...
Setting up libmagic-mgc (1:5.35-4+deb10u2) ...
Setting up psmisc (23.2-1) ...
Setting up libssl1.1:amd64 (1.1.1d-0+deb10u5) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline
Setting up libargon2-1:amd64 (0~20171227-0.2) ...
Setting up libprocps7:amd64 (2:3.3.15-2) ...
Setting up libbrotli1:amd64 (1.0.7-2+deb10u1) ...
Setting up libsqlite3-0:amd64 (3.27.2-3+deb10u1) ...
Setting up libsasl2-modules:amd64 (2.1.27+dfsg-1+deb10u1) ...
Setting up libnghttp2-14:amd64 (1.36.0-2+deb10u1) ...
Setting up libmagic1:amd64 (1:5.35-4+deb10u2) ...
Setting up libapr1:amd64 (1.6.5-1+b1) ...
Setting up krb5-locales (1.17-3+deb10u1) ...
Setting up file (1:5.35-4+deb10u2) ...
Setting up bzip2 (1.0.6-9.2~deb10u1) ...
Setting up libldap-common (2.4.47+dfsg-3+deb10u6) ...
Setting up libicu63:amd64 (63.1-6+deb10u1) ...
Setting up libjansson4:amd64 (2.12-1) ...
Setting up libkrb5support0:amd64 (1.17-3+deb10u1) ...
Setting up libsasl2-modules-db:amd64 (2.1.27+dfsg-1+deb10u1) ...
Setting up librtmp1:amd64 (2.4+20151223.gitfa8646d.1-2) ...
Setting up libncurses6:amd64 (6.1+20181013-2+deb10u2) ...
Setting up xz-utils (5.2.4-1) ...
update-alternatives: using /usr/bin/xz to provide /usr/bin/lzma (lzma) in auto mode
Setting up libpcre2-8-0:amd64 (10.32-5) ...
Setting up libk5crypto3:amd64 (1.17-3+deb10u1) ...
Setting up libsasl2-2:amd64 (2.1.27+dfsg-1+deb10u1) ...
Setting up liblua5.2-0:amd64 (5.2.4-1.1+b2) ...
Setting up sensible-utils (0.0.12) ...
Setting up procps (2:3.3.15-2) ...
update-alternatives: using /usr/bin/w.procps to provide /usr/bin/w (w) in auto mode
Setting up libssh2-1:amd64 (1.8.0-2.1) ...
Setting up netbase (5.6) ...
Setting up libkrb5-3:amd64 (1.17-3+deb10u1) ...
Setting up apache2-data (2.4.38-3+deb10u4) ...
Setting up openssl (1.1.1d-0+deb10u5) ...
Setting up libbsd0:amd64 (0.9.1-2) ...
Setting up publicsuffix (20190415.1030-1) ...
Setting up libxml2:amd64 (2.9.4+dfsg1-7+deb10u1) ...
Setting up libgdbm6:amd64 (1.18.1-4) ...
Setting up libaprutil1:amd64 (1.6.1-4) ...
Setting up php-common (2:69) ...
Setting up libedit2:amd64 (3.1-20181209-1) ...
Setting up libldap-2.4-2:amd64 (2.4.47+dfsg-3+deb10u6) ...
Setting up libaprutil1-ldap:amd64 (1.6.1-4) ...
Setting up libaprutil1-dbd-sqlite3:amd64 (1.6.1-4) ...
Setting up ca-certificates (20200601~deb10u2) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline
Updating certificates in /etc/ssl/certs...
137 added, 0 removed; done.
Setting up ssl-cert (1.0.39) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline
Setting up libgssapi-krb5-2:amd64 (1.17-3+deb10u1) ...
Setting up libgdbm-compat4:amd64 (1.18.1-4) ...
Setting up ucf (3.0038+nmu1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline
Setting up libperl5.28:amd64 (5.28.1-6+deb10u1) ...
Setting up libcurl4:amd64 (7.64.0-4+deb10u1) ...
Setting up apache2-utils (2.4.38-3+deb10u4) ...
Setting up perl (5.28.1-6+deb10u1) ...
Setting up php7.3-common (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/calendar.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/ctype.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/exif.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/fileinfo.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/ftp.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/gettext.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/iconv.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/pdo.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/phar.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/posix.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/shmop.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/sockets.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/sysvmsg.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/sysvsem.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/sysvshm.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/tokenizer.ini with new version
Setting up php7.3-mysql (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/mysqlnd.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/mysqli.ini with new version
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/pdo_mysql.ini with new version
Setting up php7.3-opcache (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/opcache.ini with new version
Setting up php7.3-json (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/json.ini with new version
Setting up php7.3-readline (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/mods-available/readline.ini with new version
Setting up apache2-bin (2.4.38-3+deb10u4) ...
Setting up php7.3-cli (7.3.27-1~deb10u1) ...
update-alternatives: using /usr/bin/php7.3 to provide /usr/bin/php (php) in auto mode
update-alternatives: using /usr/bin/phar7.3 to provide /usr/bin/phar (phar) in auto mode
update-alternatives: using /usr/bin/phar.phar7.3 to provide /usr/bin/phar.phar (phar.phar) in auto mode
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/cli/php.ini with new version
Setting up apache2 (2.4.38-3+deb10u4) ...
Enabling module mpm_event.
Enabling module authz_core.
Enabling module authz_host.
Enabling module authn_core.
Enabling module auth_basic.
Enabling module access_compat.
Enabling module authn_file.
Enabling module authz_user.
Enabling module alias.
Enabling module dir.
Enabling module autoindex.
Enabling module env.
Enabling module mime.
Enabling module negotiation.
Enabling module setenvif.
Enabling module filter.
Enabling module deflate.
Enabling module status.
Enabling module reqtimeout.
Enabling conf charset.
Enabling conf localized-error-pages.
Enabling conf other-vhosts-access-log.
Enabling conf security.
Enabling conf serve-cgi-bin.
Enabling site 000-default.
invoke-rc.d: could not determine current runlevel
invoke-rc.d: policy-rc.d denied execution of start.
Setting up libapache2-mod-php7.3 (7.3.27-1~deb10u1) ...
debconf: unable to initialize frontend: Dialog
debconf: (TERM is not set, so the dialog frontend is not usable.)
debconf: falling back to frontend: Readline

Creating config file /etc/php/7.3/apache2/php.ini with new version
Module mpm_event disabled.
Enabling module mpm_prefork.
apache2_switch_mpm Switch to prefork
invoke-rc.d: could not determine current runlevel
invoke-rc.d: policy-rc.d denied execution of restart.
apache2_invoke: Enable module php7.3
invoke-rc.d: could not determine current runlevel
invoke-rc.d: policy-rc.d denied execution of restart.
Setting up php7.3 (7.3.27-1~deb10u1) ...
Processing triggers for libc-bin (2.28-10) ...
Processing triggers for ca-certificates (20200601~deb10u2) ...
Updating certificates in /etc/ssl/certs...
0 added, 0 removed; done.
Running hooks in /etc/ca-certificates/update.d...
done.
Removing intermediate container 80716c56547d
 ---&gt; 2723e70cd2c7
Step 3/12 : RUN rm /var/www/html/index.html
 ---&gt; Running in 06a58a81d544
Removing intermediate container 06a58a81d544
 ---&gt; c363f5d843d6
Step 4/12 : ENV MARIADB_USER admin
 ---&gt; Running in 75b746ba409f
Removing intermediate container 75b746ba409f
 ---&gt; a564277b53c6
Step 5/12 : ENV MARIADB_PASS admin
 ---&gt; Running in a692407299b3
Removing intermediate container a692407299b3
 ---&gt; c793207d01db
Step 6/12 : ENV MARIADB_HOST servidor_mysql
 ---&gt; Running in ef4fb2624c0b
Removing intermediate container ef4fb2624c0b
 ---&gt; 881f667093e9
Step 7/12 : ENV DB_NAME bookmedik
 ---&gt; Running in d18484892e70
Removing intermediate container d18484892e70
 ---&gt; 0f271ef9e447
Step 8/12 : EXPOSE 80
 ---&gt; Running in 9610f9eccaac
Removing intermediate container 9610f9eccaac
 ---&gt; 33f677a12dcc
Step 9/12 : COPY bookmedik/ /var/www/html
 ---&gt; 14764194a08e
Step 10/12 : ADD script.sh /usr/local/bin/script.sh
 ---&gt; b8ab84f7cee6
Step 11/12 : RUN chmod +x /usr/local/bin/script.sh
 ---&gt; Running in ed9fee5e8f9c
Removing intermediate container ed9fee5e8f9c
 ---&gt; 898867530d13
Step 12/12 : CMD ["script.sh"]
 ---&gt; Running in b28221c15921
Removing intermediate container b28221c15921
 ---&gt; 3d1d3ed847f8
Successfully built 3d1d3ed847f8
Successfully tagged sergioib94/bookmedik:v1
</code></pre></div></div>

<p>Como podemos ver se ejecuta todo lo indicado en el dockerfile sin ningun problema, sergioib94/bookmedik:v1 sera el nombre que tendra la imagen y con “.” indicamos que se haga en el mismo directorio build.</p>

<p>Una vez que tenemos la imagen vamos al directorio deploy y ejecutamos el docker-compose.yaml.</p>

<p>Configuracion de docker-compose:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.1'

services:

  app:
    container_name: bookmedik
    image: sergioib94/bookmedik:v1
    restart: always
    environment:
      DB_HOST: db
      DB_USER: admin
      DB_PASSWORD: admin
      DB_NAME: bookmedik
    ports:
      - 80:8080
    volumes:
      - /home/sergioib//bookmedik/vol-app:/var/log/apache2

  db:
    container_name: servidor_mysql
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: bookmedik
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: bookmedik_admin
    volumes:
      - /home/sergioib//bookmedik/vol-maria:/var/lib/mysql
</code></pre></div></div>

<p>En el docker-compose, indicamos los dos contenedores que se van a despleguar, si usara alguna imagen, las variables que usaran dichos contenedores y donde se almacenaran los datos. Es imporatante indicar que la informacion de los contenedores es efimera, por lo que si no se les indica una ubicacion para que se almacena la informacion, esta se perdera una vez se apague el contenedor.</p>

<h3 id="despliegue-del-docker-compose">Despliegue del docker-compose</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~//bookmedik/deploy$ docker-compose up -d
Creating network "deploy_default" with the default driver
Pulling app (sergioib94/bookmedik:v1)...
v1: Pulling from sergioib94/bookmedik
0ecb575e629c: Already exists
cbd4c501590f: Pull complete
cd0be11536e1: Pull complete
f36ad0cac2ed: Pull complete
6790c859e7e3: Pull complete
4e0f6c5b1952: Pull complete
Digest: sha256:3e1c1cd5a79d94fb1f69686dcb06d6901e0606cf03e3f165b0a771ebb1ccff37
Status: Downloaded newer image for sergioib94/bookmedik:v1
Pulling db (mariadb:)...
latest: Pulling from library/mariadb
83ee3a23efb7: Pull complete
db98fc6f11f0: Pull complete
f611acd52c6c: Pull complete
aa2333e25466: Pull complete
f53ac4b825fd: Pull complete
c20afcf9b055: Pull complete
54c5dc6dcf19: Pull complete
b1c71d744483: Pull complete
863a8cc01d1c: Pull complete
ea6c59f9e205: Pull complete
6aa441240c22: Pull complete
c1fee6e1dead: Pull complete
Digest: sha256:a13b01d9af44097efeca7a3808a524c8052870e59a1eeef074857ba01e70c1f2
Status: Downloaded newer image for mariadb:latest
Creating bookmedik      ... done
Creating servidor_mysql ... done
</code></pre></div></div>

<p>Una vez echo esto cargamos el schema.sql en la base de datos mariadb:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~//bookmedik$ cat build/bookmedik/schema.sql | docker exec -i servidor_mysql /usr/bin/mysql -u root --password=bookmedik_admin bookmedik
</code></pre></div></div>

<p>Comprobacion de funcionamiento:</p>

<p><img src="/images/tarea-docker/Tarea1.png" alt="bookmedik_1" /></p>

<h3 id="tarea-2-ejecución-de-una-aplicación-web-php-en-docker">Tarea 2: Ejecución de una aplicación web PHP en docker</h3>

<ul>
  <li>
    <p>Realiza la imagen docker de la aplicación a partir de la imagen oficial PHP que encuentras en docker hub.</p>
  </li>
  <li>
    <p>Lee la documentación de la imagen para configurar una imagen con apache2 y php, además seguramente tengas que instalar alguna extensión de php.</p>
  </li>
  <li>
    <p>Crea esta imagen en docker hub.</p>
  </li>
  <li>
    <p>Crea un script con docker compose que levante el escenario con los dos contenedores.</p>
  </li>
</ul>

<p>Configuracion de dockerfile:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM php:7.4-apache

ENV MARIADB_USER admin
ENV MARIADB_PASS admin
ENV MARIADB_HOST servidor_mysql2

RUN apt-get update
RUN docker-php-ext-install pdo pdo_mysql mysqli json
RUN a2enmod rewrite

EXPOSE 80

WORKDIR /var/www/html

COPY bookmedik/ /var/www/html

ADD script.sh /usr/local/bin/script.sh

RUN chmod +x /usr/local/bin/script.sh

CMD ["script.sh"]
</code></pre></div></div>

<p>Configuracion script.sh:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sed -i "s/$this-&gt;user=\"root\";/$this-&gt;user=\"$MARIADB_USER\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;pass=\"\";/$this-&gt;pass=\"$MARIADB_PASS\";/g" /var/www/html/core/controller/Database.php
sed -i "s/$this-&gt;host=\"localhost\";/$this-&gt;host=\"$MARIADB_HOST\";/g" /var/www/html/core/controller/Database.php

apache2ctl -D FOREGROUND
</code></pre></div></div>

<p>Generamos la imagen nueva:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sergioib@debian-sergio:~/docker-bookmedik/Tarea2/build$ docker build -t sergioib94/bookmedik-php:v1 .
Sending build context to Docker daemon  3.667MB
Step 1/13 : FROM php:7.4-apache
 ---&gt; 83db90327db8
Step 2/13 : ENV MARIADB_USER admin
 ---&gt; Using cache
 ---&gt; da1cc91e2cc6
Step 3/13 : ENV MARIADB_PASS admin
 ---&gt; Using cache
 ---&gt; 0ef8ceb967bf
Step 4/13 : ENV MARIADB_HOST servidor_mysql2
 ---&gt; Using cache
 ---&gt; 9caececadc71
Step 5/13 : RUN apt-get update
 ---&gt; Using cache
 ---&gt; 2b798bee671c
Step 6/13 : RUN docker-php-ext-install pdo pdo_mysql mysqli json
 ---&gt; Using cache
 ---&gt; ffd14ce4443f
Step 7/13 : RUN a2enmod rewrite
 ---&gt; Using cache
 ---&gt; 53e31ffd7ab6
Step 8/13 : EXPOSE 80
 ---&gt; Using cache
 ---&gt; 2f62894a39a8
Step 9/13 : WORKDIR /var/www/html
 ---&gt; Using cache
 ---&gt; 5fdc0294f850
Step 10/13 : COPY bookmedik/ /var/www/html
 ---&gt; b360b294cf3d
Step 11/13 : ADD script.sh /usr/local/bin/script.sh
 ---&gt; cf45198aa12d
Step 12/13 : RUN chmod +x /usr/local/bin/script.sh
 ---&gt; Running in 05b958caea59
Removing intermediate container 05b958caea59
 ---&gt; 651b463266a8
Step 13/13 : CMD ["script.sh"]
 ---&gt; Running in 2df65d082273
Removing intermediate container 2df65d082273
 ---&gt; 5b857f8a175a
Successfully built 5b857f8a175a
Successfully tagged sergioib94/bookmedik-php:v1
</code></pre></div></div>

<p>Una vez que tengamos la imagen preparada, configuramos el docker-compose y lo desplegamos:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.1'

services:

 app:
    container_name: bookmedik-php
    image: sergioib94/bookmedik-php:v1
    restart: always
    ports:
      - 8081:80
    volumes:
      - /home/sergio/docker-bookmedik/Tarea2/vol-app:/var/log/apache2
 
db:
    container_name: servidor_mysql2
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: bookmedik
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: bookmedik_admin
    volumes:
- /home/sergio/docker-bookmedik/Tarea2/vol-maria:/var/lib/mysql
</code></pre></div></div>

<p>Comprobamos su funcionamiento despues de desplegarlo:</p>

<p><img src="/images/tarea-docker/Tarea2.png" alt="bookmedik_2" /></p>

<h3 id="tarea-4-ejecución-de-un-cms-en-docker">Tarea 4: Ejecución de un CMS en docker</h3>

<ul>
  <li>
    <p>A partir de una imagen base (que no sea una imagen con el CMS), genera una imagen que despliegue un CMS PHP (que no sea wordpress).</p>
  </li>
  <li>
    <p>Crea los volúmenes necesarios para que la información que se guarda sea persistente.</p>
  </li>
</ul>

<p>Para este caso sera necesario descargar drupal y poner el directorio con todo su contenido en el directorio build.</p>

<p>Configuracion de dockerfile:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>FROM debian

RUN apt-get update &amp;&amp; apt-get install -y apache2 libapache2-mod-php7.3 php7.3 php7.3-mysql php-xml php-gd php-mysql php-mbstring php7.3-pdo php7.3-mysqli &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/*
RUN rm /var/www/html/index.html &amp;&amp; a2enmod rewrite

EXPOSE 80

COPY ./drupal-9.1.4 /var/www/html

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]
</code></pre></div></div>

<p>Como podemos ver, en este caso no sera necesario crear un fichero script.sh. Por lo que una vez creada la imagen, podemos desplegar el docker compose para comprobar su funcionamiento.</p>

<p>Configuracion de docker-compose:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: "3.1"

services:
  db:
    container_name: servidor_mysql_drupal
    image: mariadb
    restart: always
    environment:
      MYSQL_DATABASE: drupal
      MYSQL_USER: admin
      MYSQL_PASSWORD: admin
      MYSQL_ROOT_PASSWORD: drupal_admin
    volumes:
      - /home/sergio/docker-bookmedik/Tarea4/vol-maria:/var/lib/mysql

  drupal:
    container_name: drupal
    image: sergioib94/drupal:v1
    restart: always
    ports:
      - 8083:80
    volumes:
      - /home/sergio/docker-bookmedik/Tarea4/vol-app:/var/log/apache2
</code></pre></div></div>

<p>Comprobamos su funcionamiento:</p>

<p><img src="/images/tarea-docker/Tarea4.png" alt="drupal" /></p>

<h3 id="tarea-5-ejecución-de-un-cms-en-docker">Tarea 5: Ejecución de un CMS en docker</h3>

<ul>
  <li>Busca una imagen oficial de un CMS PHP en docker hub (distinto al que has instalado en la tarea anterior, ni wordpress), y crea los contenedores necesarios para servir el CMS, siguiendo la documentación de docker hub.</li>
</ul>

<p>En este caso como cogemos la imagen de joomla de dockerhub, no es necesario tener un directorio build, solo sera necesario un fichero dockerfile.</p>

<p>Configuracion docker-compose:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>version: '3.1'

services:
  joomla:
    image: joomla
    restart: always
    links:
      - joomladb:mysql
    ports:
      - 8080:80
    volumes:
      - "../:/var/www/html"
    environment:
      JOOMLA_DB_HOST: joomladb
      JOOMLA_DB_PASSWORD: example

  joomladb:
    image: mysql:5.6
    ports:
      - 3306
    restart: always
    volumes:
      - "./data:/var/lib/mysql"
    environment:
      MYSQL_ROOT_PASSWORD: example
</code></pre></div></div>

<p>Comprobacion del funcionamiento:</p>

<p><img src="/images/tarea-docker/Tarea5.png" alt="joomla" /></p>]]></content><author><name>Sergio Ibáñez Núñez</name></author><category term="Aplicaciones web" /><summary type="html"><![CDATA[En esta practica haciendo uso de docker, vamos a desplegar distintas aplicaciones en contenedores, en los primeros ejercicios se trabajara con bookmedik (aplicacion para organizar citas medicas) y en las dos ultimas se usara drupal y joomla.]]></summary></entry></feed>